

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Czyszczenie danych &#8212; Silky Coders Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '10. Czyszczenie_danych/Czyszczenie danych';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Klasteryzacja w Python" href="../7.%20Klasteryzacja/7_Klasteryzacja.html" />
    <link rel="prev" title="Inżynieria cech" href="../6.%20Inzynieria_cech/6_Inzynieria%20cech.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/silky-logo.png" class="logo__image only-light" alt="Silky Coders Data Science - Home"/>
    <img src="../_static/silky-logo.png" class="logo__image only-dark pst-js-only" alt="Silky Coders Data Science - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Laboratorium specjalistyczne: Data Science w branży modowej, 1 semestr studiów magisterskich Matematyki na Wydziale Fizyki Technicznej i Matematyki Stosowanej na Politechnice Gdańskiej
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Fundamenty Pythona</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../0.%20Wst%C4%99p/TutorialBasicsPython.html">Podstawy Python</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wprowadzenie do pakietów numpy i pandas</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../1.%20Tutorial%20pandas/1_Tutorial%20pandas.html">Pakiet pandas - tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.%20Numpy_tutorial/2_Tutorial%20numpy.html">Pakiet NumPy - tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wizualizacja danych</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../3.%20Wizualizacja_danych/3_Wizualizacja%20danych.html">Wizualizacja danych w Python</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Analiza statystyczna</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../4.%20Analiza_statystyczna/4_Analiza%20statystyczna.html">Analiza statystyczna - tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wykrywanie anomalii</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../5.%20Wykrywanie_anomalii/Wykrywanie_anomalii_teoria.html">Wykrywanie anomalii - definicje</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5.%20Wykrywanie_anomalii/5_Wykrywanie%20anomalii%20tutorial.html">Wykrywanie anomalii - tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Inżynieria cech</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../6.%20Inzynieria_cech/6_Inzynieria%20cech.html">Inżynieria cech</a></li>











</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Czyszczenie danych</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Czyszczenie danych</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Klasteryzacja</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../7.%20Klasteryzacja/7_Klasteryzacja.html">Klasteryzacja w Python</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Klasyfikacja</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../12.%20Klasyfikacja/Klasyfikacja.html">Klasyfikacja w Python</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Regresja</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../11.%20Regresja/Regresja_lin.html">Liniowe modele regresji</a></li>
<li class="toctree-l1"><a class="reference internal" href="../11.%20Regresja/Regresja_trees.html">Regresja oparta o modele drzewiaste</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wyjaśnialność modeli</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../8.%20Wyjasnialnosc/8_Tutorial%20metryki%20statystyczne.html">Wyjaśnialność modeli - metryki statystyczne - tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9.%20XAI/Wyjasnialnosc_modeli_definicje.html">Wyjaśnialność modeli - definicje</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9.%20XAI/9_Wyjasnialnosc%20modeli.html">Wyjaśnialność modeli - XAI - tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Przetwarzanie języka naturalnego</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../13.%20NLP/TutorialNLP.html">NLP</a></li>





</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/kikonPL/studia_PG/blob/main/10. Czyszczenie_danych/Czyszczenie danych.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/kikonPL/studia_PG" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kikonPL/studia_PG/issues/new?title=Issue%20on%20page%20%2F10. Czyszczenie_danych/Czyszczenie danych.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/10. Czyszczenie_danych/Czyszczenie danych.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Czyszczenie danych</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Czyszczenie danych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#wygenerowanie-danych">Wygenerowanie danych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#czyszczenie-danych-tabularycznych">Czyszczenie danych tabularycznych</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#formaty-danych">Formaty danych</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#atrybuty-zmiennych-kategorycznych">Atrybuty zmiennych kategorycznych</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#weryfikacja-duplikatow">Weryfikacja duplikatów</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sprawdzanie-zmiennych-numerycznych">Sprawdzanie zmiennych numerycznych</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relacje-pomiedzy-zmiennymi">Relacje pomiędzy zmiennymi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-wartosci-brakujacych">Imputacja wartości brakujących</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metody-imputacji-brakujacych-wartosci">Metody imputacji brakujących wartości</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklady-imputacji">Przykłady imputacji</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-wartoscia-specjalna">Imputacja wartością specjalną</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-wartoscia-stala">Imputacja wartością stałą</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-zmiennych-kategorycznych">Imputacja zmiennych kategorycznych</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-zmiennych-numerycznych">Imputacja zmiennych numerycznych</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#laczenie-roznych-metod-imputacji-z-wykorzystaniem-pipeline">Łączenie różnych metod imputacji z wykorzystaniem pipeline</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-wg-grupy">Imputacja wg grupy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-z-wykorzystaniem-modelu">Imputacja z wykorzystaniem modelu</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metody-usuwania-brakujacych-wartosci">Metody usuwania brakujących wartości</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#czyszczenie-szeregow-czasowych">Czyszczenie szeregów czasowych</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="czyszczenie-danych">
<h1>Czyszczenie danych<a class="headerlink" href="#czyszczenie-danych" title="Permalink to this heading">#</a></h1>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>Czyszczenie danych</b> jest to proces polegający na identyfikacji i naprawie różnego rodzaju błędów w danych.</p>
</div><div class="alert alert-block alert-info">
<b>Info</b> 
<p>Czyszczenie danych obejmuje zazwyczaj następujące elementy:</p>
<ul class="simple">
<li><p>czyszczenie formatów danych</p></li>
<li><p>czyszczenie kodowania zmiennych kategorycznych</p></li>
<li><p>czyszczenie nieprawidłowych wartości zmiennych numerycznych</p></li>
<li><p>czyszczenie wartości odstających</p></li>
<li><p>usuwanie duplikatów</p></li>
<li><p>imputacja wartości brakujących</p></li>
</ul>
</div><div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p><b>Czyszczenie danych</b> stanowi jeden z ważniejszych etapów w procesie budowy modeli uczenia maszynowego, dlatego należy mu poświęcić dużo uwagi. Zazwyczaj stanowi też jedną z najbardziej czasochłonnych faz i może wymagać czasem wielu iteracji polegających na identyfikacji i naprawie kolejnych nieprawidłowości, a następnie analizy impaktu zmian na wyniki modelu.
Należy również pamiętać, że czyszczenie danych musi być poprzedzone ich dobrym zrozumieniem, inaczej nie będzie możliwe uzyskanie danych poprawnych pod kątem logiki biznesowej.</p>
</div><p>W tym notebooku przedstawione zostaną 2 przypadki - czyszczenie danych tabularycznych oraz czyszczenie szeregu czasowego. Najpierw jednak import bibliotek i wygenerowanie danych.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="wygenerowanie-danych">
<h1>Wygenerowanie danych<a class="headerlink" href="#wygenerowanie-danych" title="Permalink to this heading">#</a></h1>
<p>Posłużymy się tutaj dwoma przykładami danych wymagających wyczyszczenia - danymi tabularycznymi reprezentującymi dane pacjentów oraz szeregiem czasowym pokazującym sprzedaż produktu o silnej sezonowości.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_ts_data</span><span class="p">(</span><span class="n">month_coef</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">week_coef</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">day_coef</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_coef</span> <span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;2016-01-01&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2020-12-31&quot;</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SalesDate</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SalesDate</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SalesDate</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;WeekDay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SalesDate</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">6.5</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">Month</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">month_coef</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">26.5</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">Week</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">week_coef</span> <span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">WeekDay</span><span class="o">*</span><span class="n">day_coef</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="s2">&quot;2019-11-01&quot;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">]</span><span class="o">&lt;=</span><span class="s2">&quot;2020-03-01&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]))</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">0.2</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.998</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">,</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_tabular_data</span><span class="p">(</span><span class="n">len_data</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_data</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">)</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">))</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">))</span>
    <span class="n">bmi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">weight</span><span class="o">/</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;Gdańsk&quot;</span><span class="p">,</span><span class="s2">&quot;Gdynia&quot;</span><span class="p">,</span> <span class="s2">&quot;Wejherowo&quot;</span><span class="p">,</span> <span class="s2">&quot;Kościerzyna&quot;</span><span class="p">,</span><span class="s2">&quot;Gdansk&quot;</span><span class="p">,</span> <span class="s2">&quot;Koscierzyna&quot;</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">)</span>
    <span class="n">num_covid_tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">)</span>
    <span class="n">num_positive_tests</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_covid_tests</span> <span class="o">-</span> <span class="n">num_covid_tests</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">sex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">dict_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;unique_id&quot;</span><span class="p">:</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="n">age</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span><span class="n">weight</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="n">height</span><span class="p">,</span> <span class="s2">&quot;bmi&quot;</span><span class="p">:</span><span class="n">bmi</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">:</span><span class="n">city</span><span class="p">,</span>
                <span class="s2">&quot;num_covid_tests&quot;</span><span class="p">:</span><span class="n">num_covid_tests</span><span class="p">,</span> <span class="s2">&quot;num_positive_tests&quot;</span><span class="p">:</span><span class="n">num_positive_tests</span><span class="p">,</span> <span class="s2">&quot;sex&quot;</span><span class="p">:</span><span class="n">sex</span><span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_data</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_covid_tests&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_covid_tests&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_covid_tests&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span> <span class="o">=</span><span class="p">[</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;bmi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;bmi&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()],</span> <span class="n">p</span> <span class="o">=</span><span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">len_data</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bmi&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">30</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bmi&quot;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">20</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;bmi&quot;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">30</span><span class="p">],[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="czyszczenie-danych-tabularycznych">
<h1>Czyszczenie danych tabularycznych<a class="headerlink" href="#czyszczenie-danych-tabularycznych" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span><span class="n">generate_tabular_data</span><span class="p">(</span><span class="n">len_data</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Pierwszym krokiem w czyszczeniu danych powinno zawsze być przyjrzenie się wycinkowi danych oraz podstawowym informacjom o naszej ramce danych:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unique_id</th>
      <th>age</th>
      <th>weight</th>
      <th>height</th>
      <th>bmi</th>
      <th>city</th>
      <th>num_covid_tests</th>
      <th>num_positive_tests</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>65.0</td>
      <td>44.0</td>
      <td>163.0</td>
      <td>13.315037</td>
      <td>WEJHEROWO</td>
      <td>4.0</td>
      <td>4</td>
      <td>M</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>46.0</td>
      <td>55.0</td>
      <td>154.0</td>
      <td>23.200000</td>
      <td>Gdansk</td>
      <td>3.0</td>
      <td>-6</td>
      <td>N</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>44.0</td>
      <td>53.0</td>
      <td>158.0</td>
      <td>21.200000</td>
      <td>Wejherowo</td>
      <td>3.0</td>
      <td>3</td>
      <td>M</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>14.0</td>
      <td>65.0</td>
      <td>165.0</td>
      <td>23.900000</td>
      <td>Koscierzyna</td>
      <td>3.0</td>
      <td>3</td>
      <td>N</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>37.0</td>
      <td>52.0</td>
      <td>146.0</td>
      <td>24.400000</td>
      <td>Gdańsk</td>
      <td>3.0</td>
      <td>0</td>
      <td>N</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 315 entries, 0 to 196
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           315 non-null    int64  
 1   age                 193 non-null    float64
 2   weight              315 non-null    object 
 3   height              315 non-null    float64
 4   bmi                 315 non-null    float64
 5   city                315 non-null    object 
 6   num_covid_tests     243 non-null    float64
 7   num_positive_tests  315 non-null    int32  
 8   sex                 315 non-null    object 
dtypes: float64(4), int32(1), int64(1), object(3)
memory usage: 23.4+ KB
</pre></div>
</div>
</div>
</div>
<section id="formaty-danych">
<h2>Formaty danych<a class="headerlink" href="#formaty-danych" title="Permalink to this heading">#</a></h2>
<p>Najczęściej występującym problemem jest formatowanie zmiennych numerycznych jako kategorycznych, tutaj widzimy to np. dla zmiennej weight, może to wynikać również z nieprawidłowych wartości występujących w takich kolumnach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weight</th>
      <th>city</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>44.0</td>
      <td>WEJHEROWO</td>
      <td>M</td>
    </tr>
    <tr>
      <th>1</th>
      <td>55.0</td>
      <td>Gdansk</td>
      <td>N</td>
    </tr>
    <tr>
      <th>2</th>
      <td>53.0</td>
      <td>Wejherowo</td>
      <td>M</td>
    </tr>
    <tr>
      <th>3</th>
      <td>65.0</td>
      <td>Koscierzyna</td>
      <td>N</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52.0</td>
      <td>Gdańsk</td>
      <td>N</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>207</th>
      <td>71.0</td>
      <td>Gdańsk</td>
      <td>F</td>
    </tr>
    <tr>
      <th>250</th>
      <td>56.0</td>
      <td>GDANSK</td>
      <td>M</td>
    </tr>
    <tr>
      <th>111</th>
      <td>48.0</td>
      <td>Gdańsk</td>
      <td>M</td>
    </tr>
    <tr>
      <th>291</th>
      <td>64.0</td>
      <td>Gdynia</td>
      <td>F</td>
    </tr>
    <tr>
      <th>196</th>
      <td>55.0</td>
      <td>WEJHEROWO</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
<p>315 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>height</th>
      <th>bmi</th>
      <th>num_covid_tests</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>65.0</td>
      <td>163.0</td>
      <td>13.315037</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>46.0</td>
      <td>154.0</td>
      <td>23.200000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>44.0</td>
      <td>158.0</td>
      <td>21.200000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>14.0</td>
      <td>165.0</td>
      <td>23.900000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>37.0</td>
      <td>146.0</td>
      <td>24.400000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>207</th>
      <td>NaN</td>
      <td>171.0</td>
      <td>24.300000</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>250</th>
      <td>NaN</td>
      <td>168.0</td>
      <td>19.800000</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>111</th>
      <td>50.0</td>
      <td>145.0</td>
      <td>22.800000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>291</th>
      <td>25.0</td>
      <td>170.0</td>
      <td>22.100000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>196</th>
      <td>NaN</td>
      <td>155.0</td>
      <td>18.368334</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>315 rows × 4 columns</p>
</div></div></div>
</div>
<p>Ponadto niektóre z powyższych zmiennych np. num_covid_tests wydają się bardziej pasować do formatu int niż float, jednak należy pamiętać, że zmienne zawierające brakujące wartości są automatycznie konwertowane na format float, dlatego na razie ograniczymy się do konwersji dla zmiennej weight.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns_to_convert</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="n">columns_to_convert</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns_to_convert</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 315 entries, 0 to 196
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           315 non-null    int64  
 1   age                 193 non-null    float64
 2   weight              315 non-null    float64
 3   height              315 non-null    float64
 4   bmi                 315 non-null    float64
 5   city                315 non-null    object 
 6   num_covid_tests     243 non-null    float64
 7   num_positive_tests  315 non-null    int32  
 8   sex                 315 non-null    object 
dtypes: float64(5), int32(1), int64(1), object(2)
memory usage: 23.4+ KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="atrybuty-zmiennych-kategorycznych">
<h2>Atrybuty zmiennych kategorycznych<a class="headerlink" href="#atrybuty-zmiennych-kategorycznych" title="Permalink to this heading">#</a></h2>
<p>Zmienne kategoryczne są szczególnie narażone na błędy wynikające z literówek lub nieprawidłowego kodowania, co prowadzi do błędnego zwiększenia liczby ich unikalnych atrybutów. Można to zaobserwować dla przedstawionych poniżej zmiennych:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>********************
CITY
********************
city
Gdańsk         80
Gdynia         46
GDAŃSK         38
Gdansk         28
Koscierzyna    23
GDYNIA         17
Kościerzyna    17
Wejherowo      15
WEJHEROWO      11
gdańsk         10
GDANSK          9
wejherowo       5
KOŚCIERZYNA     4
gdansk          3
KOSCIERZYNA     3
gdynia          3
koscierzyna     3
Name: count, dtype: int64
********************
SEX
********************
sex
M    156
F    132
N     27
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Jak widać zmienna city jest obarczona licznymi błędami wynikającymi z literówek oraz używania róznej wielkości liter. Tutaj błędy mogą stosunkowo łatwo zostać naprawione, jednak najczęściej do takiej poprawy niezbędna jest wiedza biznesowa odnośnie tego jakie atrybuty powinna dana zmienna posiadać i co one oznaczają.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;Gdansk&quot;</span><span class="p">:</span><span class="s2">&quot;Gdańsk&quot;</span><span class="p">,</span> <span class="s2">&quot;Koscierzyna&quot;</span><span class="p">:</span><span class="s2">&quot;Kościerzyna&quot;</span><span class="p">})</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>city
Gdańsk         168
Gdynia          66
Kościerzyna     50
Wejherowo       31
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>W przypadku zmiennej oznaczającej płeć pacjenta poza oczekiwanymi atrybutami M i F występuje jeszcze jedno oznaczenie - N. Przy założeniu, że nie ma żadnych wytycznych biznesowych określających, że taka wartość w tej kolumnie oznacza np. brak danych, musimy potraktować tą wartość jako błędną i oznaczyć jako brakującą. Tutaj zamienimy tę wartość na pustą, a wypełnieniem jej zajmiemy się w kolejnych sekcjach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;N&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sex
M      156
F      132
NaN     27
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="weryfikacja-duplikatow">
<h2>Weryfikacja duplikatów<a class="headerlink" href="#weryfikacja-duplikatow" title="Permalink to this heading">#</a></h2>
<p>Kolejnym istotnym krokiem jest weryfikacja czy w danych nie występują duplikaty. Aby zbadać występowanie duplikatów dla danych niezbędna jest wiedza jakie kolumny wyznaczają unikalne kombinacje. W tym wypadku zakładamy, że odpowiada za to kolumna unique_id, zatem wystarczy porównać liczbę jej unikalnych wartości z liczebnością ramki danych.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;unique_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(300, 315)
</pre></div>
</div>
</div>
</div>
<p>Jak widać w danych występują duplikaty, do ich usunięcia najprościej wykorzystać funkcję drop_duplicates, wybierając jako subset unique_id. Funkcja daje również możliwość wyboru, który rekord zachować przy wykryciu duplikatów, załóżmy, że tutaj interesuje nas ostatni rekord bo reprezentuje np. najnowszy wpis w danych.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;unique_id&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 300 entries, 0 to 196
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           300 non-null    int64  
 1   age                 186 non-null    float64
 2   weight              300 non-null    float64
 3   height              300 non-null    float64
 4   bmi                 300 non-null    float64
 5   city                300 non-null    object 
 6   num_covid_tests     232 non-null    float64
 7   num_positive_tests  300 non-null    int32  
 8   sex                 274 non-null    object 
dtypes: float64(5), int32(1), int64(1), object(2)
memory usage: 22.3+ KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="sprawdzanie-zmiennych-numerycznych">
<h2>Sprawdzanie zmiennych numerycznych<a class="headerlink" href="#sprawdzanie-zmiennych-numerycznych" title="Permalink to this heading">#</a></h2>
<p>Kolejnym krokiem jest czyszczenie zmiennych numerycznych, co obejmować będzie identyfikację i naprawianie wartości nieprawidłowych z punktu widzenia logiki biznesowej oraz wartości odstających.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unique_id</th>
      <th>age</th>
      <th>weight</th>
      <th>height</th>
      <th>bmi</th>
      <th>num_covid_tests</th>
      <th>num_positive_tests</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>300.000000</td>
      <td>186.000000</td>
      <td>300.000000</td>
      <td>300.000000</td>
      <td>300.000000</td>
      <td>232.000000</td>
      <td>300.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>149.500000</td>
      <td>36.026882</td>
      <td>60.540000</td>
      <td>161.336667</td>
      <td>23.300035</td>
      <td>2.581897</td>
      <td>1.043333</td>
    </tr>
    <tr>
      <th>std</th>
      <td>86.746758</td>
      <td>17.898643</td>
      <td>10.135952</td>
      <td>17.180431</td>
      <td>5.169336</td>
      <td>1.101836</td>
      <td>2.372104</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>5.000000</td>
      <td>34.000000</td>
      <td>128.000000</td>
      <td>12.000000</td>
      <td>1.000000</td>
      <td>-9.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>74.750000</td>
      <td>21.000000</td>
      <td>55.000000</td>
      <td>153.750000</td>
      <td>19.993139</td>
      <td>2.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>149.500000</td>
      <td>36.000000</td>
      <td>61.000000</td>
      <td>160.000000</td>
      <td>23.200000</td>
      <td>3.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>224.250000</td>
      <td>51.000000</td>
      <td>68.000000</td>
      <td>168.000000</td>
      <td>26.225000</td>
      <td>4.000000</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>299.000000</td>
      <td>65.000000</td>
      <td>92.000000</td>
      <td>322.000000</td>
      <td>40.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Analizując powyższe statystyki dla zmiennych numerycznych możemy łatwo zauważyć występowanie wartości nieprawidłowych w postaci ujemnych wartości dla zmiennej num_positive_tests, która z założenia powinna być nieujemna. Ponadto można tutaj łatwo zauważyć występowanie wartości odstających dla zmiennej height. Dokładny proces identyfikacji wartości odstających został bardziej szczegółowo omówiony w osobnym notebooku, zatem tutaj ograniczymy się do oznaczenia takich wartosci jako brakujące, przyjmując arbitralnie wielkość progu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">230</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_positive_tests&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_positive_tests&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_positive_tests&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unique_id</th>
      <th>age</th>
      <th>weight</th>
      <th>height</th>
      <th>bmi</th>
      <th>num_covid_tests</th>
      <th>num_positive_tests</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>300.000000</td>
      <td>186.000000</td>
      <td>300.000000</td>
      <td>298.000000</td>
      <td>300.000000</td>
      <td>232.000000</td>
      <td>270.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>149.500000</td>
      <td>36.026882</td>
      <td>60.540000</td>
      <td>160.265101</td>
      <td>23.300035</td>
      <td>2.581897</td>
      <td>1.607407</td>
    </tr>
    <tr>
      <th>std</th>
      <td>86.746758</td>
      <td>17.898643</td>
      <td>10.135952</td>
      <td>11.150343</td>
      <td>5.169336</td>
      <td>1.101836</td>
      <td>1.585700</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>5.000000</td>
      <td>34.000000</td>
      <td>128.000000</td>
      <td>12.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>74.750000</td>
      <td>21.000000</td>
      <td>55.000000</td>
      <td>153.250000</td>
      <td>19.993139</td>
      <td>2.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>149.500000</td>
      <td>36.000000</td>
      <td>61.000000</td>
      <td>160.000000</td>
      <td>23.200000</td>
      <td>3.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>224.250000</td>
      <td>51.000000</td>
      <td>68.000000</td>
      <td>167.750000</td>
      <td>26.225000</td>
      <td>4.000000</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>299.000000</td>
      <td>65.000000</td>
      <td>92.000000</td>
      <td>191.000000</td>
      <td>40.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="relacje-pomiedzy-zmiennymi">
<h2>Relacje pomiędzy zmiennymi<a class="headerlink" href="#relacje-pomiedzy-zmiennymi" title="Permalink to this heading">#</a></h2>
<p>Oprócz analizy pojedynczych zmiennych czyszczenie danych powinno obejmować również analizę relacji logicznych pomiędzy poszczególnymi zmiennymi, wynikające z logiki biznesowej. Takie relacje mogą obejmować zarówno zestawienie wartości pojedynczych zmiennych jak i weryfikacje zmiennych wyliczanych na ich podstawie.</p>
<p>Przykładem takiej relacji w poniższych danych są zmienne num_covid_tests i num_positive_tests, za nieprawidłowe należy uznać wszystkie rekordy, dla których ta pierwsza zmienna jest mniejsza od drugiej.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_covid_tests&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_positive_tests&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unique_id</th>
      <th>age</th>
      <th>weight</th>
      <th>height</th>
      <th>bmi</th>
      <th>city</th>
      <th>num_covid_tests</th>
      <th>num_positive_tests</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>79</th>
      <td>79</td>
      <td>47.0</td>
      <td>58.0</td>
      <td>149.0</td>
      <td>26.100000</td>
      <td>Gdańsk</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>106</th>
      <td>106</td>
      <td>32.0</td>
      <td>61.0</td>
      <td>148.0</td>
      <td>27.800000</td>
      <td>Kościerzyna</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>128</th>
      <td>128</td>
      <td>19.0</td>
      <td>60.0</td>
      <td>166.0</td>
      <td>21.800000</td>
      <td>Gdańsk</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>132</th>
      <td>132</td>
      <td>NaN</td>
      <td>51.0</td>
      <td>160.0</td>
      <td>19.900000</td>
      <td>Gdynia</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>146</th>
      <td>146</td>
      <td>18.0</td>
      <td>34.0</td>
      <td>168.0</td>
      <td>12.000000</td>
      <td>Kościerzyna</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>151</th>
      <td>151</td>
      <td>NaN</td>
      <td>55.0</td>
      <td>172.0</td>
      <td>18.600000</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>157</th>
      <td>157</td>
      <td>7.0</td>
      <td>74.0</td>
      <td>138.0</td>
      <td>38.900000</td>
      <td>Wejherowo</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>160</th>
      <td>160</td>
      <td>26.0</td>
      <td>78.0</td>
      <td>181.0</td>
      <td>23.800000</td>
      <td>Kościerzyna</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>226</th>
      <td>226</td>
      <td>65.0</td>
      <td>56.0</td>
      <td>152.0</td>
      <td>24.200000</td>
      <td>Gdynia</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>249</th>
      <td>249</td>
      <td>NaN</td>
      <td>81.0</td>
      <td>175.0</td>
      <td>26.400000</td>
      <td>Gdańsk</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>256</th>
      <td>256</td>
      <td>NaN</td>
      <td>69.0</td>
      <td>159.0</td>
      <td>27.300000</td>
      <td>Gdynia</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>263</th>
      <td>263</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>159.0</td>
      <td>28.100000</td>
      <td>Gdańsk</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>270</th>
      <td>270</td>
      <td>NaN</td>
      <td>56.0</td>
      <td>154.0</td>
      <td>18.929812</td>
      <td>Kościerzyna</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>298</th>
      <td>298</td>
      <td>47.0</td>
      <td>64.0</td>
      <td>165.0</td>
      <td>23.500000</td>
      <td>Gdynia</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Przy założeniu, że wiemy iż bardziej wiarygodne są zapisy wartości zmiennej num_covid_tests można dokonać poprawy jak poniżej, alternatywą byłoby przypisanie takim przypadkom wartości pustej dla zmiennej num_positive_tests, ewentualnie usunięcie takich rekordów.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_positive_tests&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_positive_tests&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_covid_tests&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_covid_tests&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_positive_tests&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_covid_tests&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_positive_tests&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unique_id</th>
      <th>age</th>
      <th>weight</th>
      <th>height</th>
      <th>bmi</th>
      <th>city</th>
      <th>num_covid_tests</th>
      <th>num_positive_tests</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<p>Zmienną wyliczoną na podstawie innych zmiennych reprezentuje tutaj bmi, znając formułę można zweryfikować czy wszędzie jest ona wyliczona prawidłowo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bmi&quot;</span><span class="p">])</span><span class="o">!=</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unique_id</th>
      <th>age</th>
      <th>weight</th>
      <th>height</th>
      <th>bmi</th>
      <th>city</th>
      <th>num_covid_tests</th>
      <th>num_positive_tests</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>65.0</td>
      <td>44.0</td>
      <td>163.0</td>
      <td>13.315037</td>
      <td>Wejherowo</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>13</th>
      <td>13</td>
      <td>30.0</td>
      <td>71.0</td>
      <td>152.0</td>
      <td>24.624797</td>
      <td>Gdańsk</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>15</th>
      <td>15</td>
      <td>23.0</td>
      <td>39.0</td>
      <td>170.0</td>
      <td>13.500000</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>47</th>
      <td>47</td>
      <td>NaN</td>
      <td>48.0</td>
      <td>153.0</td>
      <td>20.500000</td>
      <td>Kościerzyna</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>M</td>
    </tr>
    <tr>
      <th>54</th>
      <td>54</td>
      <td>17.0</td>
      <td>47.0</td>
      <td>159.0</td>
      <td>14.919258</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>56</th>
      <td>56</td>
      <td>30.0</td>
      <td>66.0</td>
      <td>167.0</td>
      <td>19.010023</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>68</th>
      <td>68</td>
      <td>64.0</td>
      <td>52.0</td>
      <td>161.0</td>
      <td>16.122424</td>
      <td>Gdańsk</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>81</th>
      <td>81</td>
      <td>30.0</td>
      <td>58.0</td>
      <td>159.0</td>
      <td>18.368334</td>
      <td>Gdynia</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>96</th>
      <td>96</td>
      <td>NaN</td>
      <td>58.0</td>
      <td>157.0</td>
      <td>18.849601</td>
      <td>Gdynia</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>112</th>
      <td>112</td>
      <td>30.0</td>
      <td>60.0</td>
      <td>165.0</td>
      <td>17.646435</td>
      <td>Kościerzyna</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>119</th>
      <td>119</td>
      <td>51.0</td>
      <td>62.0</td>
      <td>161.0</td>
      <td>19.170445</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>135</th>
      <td>135</td>
      <td>29.0</td>
      <td>61.0</td>
      <td>133.0</td>
      <td>27.672818</td>
      <td>Gdańsk</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>142</th>
      <td>142</td>
      <td>27.0</td>
      <td>72.0</td>
      <td>NaN</td>
      <td>27.800000</td>
      <td>Wejherowo</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>143</th>
      <td>143</td>
      <td>NaN</td>
      <td>66.0</td>
      <td>184.0</td>
      <td>19.500000</td>
      <td>Gdańsk</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>158</th>
      <td>158</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>171.0</td>
      <td>17.245379</td>
      <td>Kościerzyna</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>167</th>
      <td>167</td>
      <td>NaN</td>
      <td>53.0</td>
      <td>185.0</td>
      <td>15.500000</td>
      <td>Gdynia</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>168</th>
      <td>168</td>
      <td>45.0</td>
      <td>51.0</td>
      <td>143.0</td>
      <td>19.972556</td>
      <td>Gdynia</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>170</th>
      <td>170</td>
      <td>50.0</td>
      <td>66.0</td>
      <td>167.0</td>
      <td>19.010023</td>
      <td>Gdynia</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>F</td>
    </tr>
    <tr>
      <th>171</th>
      <td>171</td>
      <td>53.0</td>
      <td>57.0</td>
      <td>160.0</td>
      <td>17.887068</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>177</th>
      <td>177</td>
      <td>33.0</td>
      <td>72.0</td>
      <td>155.0</td>
      <td>24.063320</td>
      <td>Gdańsk</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>178</th>
      <td>178</td>
      <td>NaN</td>
      <td>51.0</td>
      <td>141.0</td>
      <td>20.614244</td>
      <td>Gdynia</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>184</th>
      <td>184</td>
      <td>NaN</td>
      <td>58.0</td>
      <td>168.0</td>
      <td>20.500000</td>
      <td>Kościerzyna</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>197</th>
      <td>197</td>
      <td>NaN</td>
      <td>50.0</td>
      <td>146.0</td>
      <td>23.500000</td>
      <td>Gdańsk</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>199</th>
      <td>199</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>145.0</td>
      <td>19.812133</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>204</th>
      <td>204</td>
      <td>54.0</td>
      <td>46.0</td>
      <td>152.0</td>
      <td>15.962002</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>209</th>
      <td>209</td>
      <td>NaN</td>
      <td>41.0</td>
      <td>156.0</td>
      <td>13.475459</td>
      <td>Wejherowo</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>M</td>
    </tr>
    <tr>
      <th>213</th>
      <td>213</td>
      <td>63.0</td>
      <td>63.0</td>
      <td>156.0</td>
      <td>20.774666</td>
      <td>Gdańsk</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>216</th>
      <td>216</td>
      <td>58.0</td>
      <td>58.0</td>
      <td>152.0</td>
      <td>20.132978</td>
      <td>Wejherowo</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>223</th>
      <td>223</td>
      <td>23.0</td>
      <td>66.0</td>
      <td>164.0</td>
      <td>24.500000</td>
      <td>Gdańsk</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>225</th>
      <td>225</td>
      <td>NaN</td>
      <td>77.0</td>
      <td>NaN</td>
      <td>30.100000</td>
      <td>Gdynia</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>227</th>
      <td>227</td>
      <td>46.0</td>
      <td>52.0</td>
      <td>170.0</td>
      <td>14.437992</td>
      <td>Kościerzyna</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>232</th>
      <td>232</td>
      <td>NaN</td>
      <td>53.0</td>
      <td>145.0</td>
      <td>20.213189</td>
      <td>Gdynia</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>233</th>
      <td>233</td>
      <td>51.0</td>
      <td>47.0</td>
      <td>164.0</td>
      <td>14.036937</td>
      <td>Gdynia</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>F</td>
    </tr>
    <tr>
      <th>235</th>
      <td>235</td>
      <td>16.0</td>
      <td>57.0</td>
      <td>159.0</td>
      <td>22.500000</td>
      <td>Gdańsk</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>M</td>
    </tr>
    <tr>
      <th>236</th>
      <td>236</td>
      <td>16.0</td>
      <td>64.0</td>
      <td>178.0</td>
      <td>16.202635</td>
      <td>Gdynia</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>M</td>
    </tr>
    <tr>
      <th>239</th>
      <td>239</td>
      <td>42.0</td>
      <td>56.0</td>
      <td>171.0</td>
      <td>15.400525</td>
      <td>Gdynia</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>240</th>
      <td>240</td>
      <td>49.0</td>
      <td>49.0</td>
      <td>165.0</td>
      <td>14.437992</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>243</th>
      <td>243</td>
      <td>45.0</td>
      <td>58.0</td>
      <td>148.0</td>
      <td>21.255933</td>
      <td>Gdańsk</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>251</th>
      <td>251</td>
      <td>9.0</td>
      <td>66.0</td>
      <td>164.0</td>
      <td>19.651711</td>
      <td>Gdynia</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>262</th>
      <td>262</td>
      <td>NaN</td>
      <td>55.0</td>
      <td>168.0</td>
      <td>19.500000</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>270</th>
      <td>270</td>
      <td>NaN</td>
      <td>56.0</td>
      <td>154.0</td>
      <td>18.929812</td>
      <td>Kościerzyna</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>273</th>
      <td>273</td>
      <td>41.0</td>
      <td>63.0</td>
      <td>166.0</td>
      <td>18.368334</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>280</th>
      <td>280</td>
      <td>38.0</td>
      <td>47.0</td>
      <td>148.0</td>
      <td>21.500000</td>
      <td>Gdańsk</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>286</th>
      <td>286</td>
      <td>5.0</td>
      <td>60.0</td>
      <td>143.0</td>
      <td>23.501843</td>
      <td>Gdańsk</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>F</td>
    </tr>
    <tr>
      <th>287</th>
      <td>287</td>
      <td>NaN</td>
      <td>60.0</td>
      <td>171.0</td>
      <td>20.500000</td>
      <td>Gdańsk</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>293</th>
      <td>293</td>
      <td>38.0</td>
      <td>65.0</td>
      <td>156.0</td>
      <td>21.416355</td>
      <td>Gdańsk</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>296</th>
      <td>296</td>
      <td>65.0</td>
      <td>60.0</td>
      <td>152.0</td>
      <td>20.854877</td>
      <td>Gdańsk</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>F</td>
    </tr>
    <tr>
      <th>260</th>
      <td>260</td>
      <td>NaN</td>
      <td>48.0</td>
      <td>150.0</td>
      <td>17.084957</td>
      <td>Gdańsk</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>M</td>
    </tr>
    <tr>
      <th>196</th>
      <td>196</td>
      <td>NaN</td>
      <td>55.0</td>
      <td>155.0</td>
      <td>18.368334</td>
      <td>Wejherowo</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Jak widać istnieją rekordy, dla których wartość nie zgadza się z formułą, wprowadzamy zatem poprawki:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bmi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="imputacja-wartosci-brakujacych">
<h2>Imputacja wartości brakujących<a class="headerlink" href="#imputacja-wartosci-brakujacych" title="Permalink to this heading">#</a></h2>
<div class="alert alert-block alert-info">
<b>Info</b> 
<p>Rodzaje wartości brakujących</p>
<ul class="simple">
<li><p>MCAR - Missing Completely At Random</p></li>
<li><p>MAR - Missing At Random</p></li>
<li><p>MNAR - Missing Not At Random</p></li>
</ul>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>MCAR</b> wartości brakujące powstały w sposób całkowicie losowy, co oznacza, że nie istnieje związek pomiędzy występowaniem wartości brakujących w danej zmiennej, a ich występowaniem w pozostałych zmiennych ani pomiędzy wartościami jakiejkolwiek zmiennej, a wartościami brakującymi rozważanej zmiennej.</p>
</div>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>MAR</b>
wartości brakujące występują losowo, ale można się dopatrzeć związków pomiędzy ich występowaniem, a wartościami którejś z pozostałych zmiennych.</p>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>MNAR</b> wartości brakujące występują w sposób systematyczny, co ma związek np. ze sposobem zbierania danych, pozostałe zmienne nie mówią nic na podstawie czego można by dokonać imputacji tych wartości, natomiast prawdopodobieństwo wystąpienia braku danych jest wprost związane z wartościami omawianej zmiennej.</p>
<p>Na początek importujemy bibliotekę missingno, która posiada szereg przydatnych wizualizacji do zrozumienia natury wartości brakujących.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">missingno</span>
</pre></div>
</div>
</div>
</div>
<p>Podstawowa wizualizacja daje intuicję na temat liczby wartości brakujących, a co więcej pokazuje też relacje pomiędzy ich występowanie w poszczególnych zmiennych.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missingno</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/ceee83f06f3bedcacbc77b74850c05f8e57dffdaae20013a5cbdad04666996c4.png" src="../_images/ceee83f06f3bedcacbc77b74850c05f8e57dffdaae20013a5cbdad04666996c4.png" />
</div>
</div>
<p>Tutaj można zauważyć relację między zmiennymi height i bmi, co jest oczywiście konsekwencją tego, że bmi jest liczone w oparciu o height. Ponadto widać też, że wartości brakujące zdecydowanie najczęściej występują dla zmiennej age.</p>
<p>Można również zaobserwować, że dla zmiennej age nie występują wartości wyższe niż 65 lat, zatem sposób potraktowania wartości brakujących zależy od istnienia informacji o maksymalnym wieku pacejentów w tym zbiorze danych - gdyby np okazało, że próba obejmuje również starsze osoby, ale przez jakiś błąd przy wprowadzaniu danych ich wiek się nie zapisał, należałoby potraktować taki przypadek jako MNAR i zastąpić wartością specjalną lub oznaczyć w osobnej kolumnie, w przeciwnym razie będzie to MCAR lub MAR.</p>
<p>Lepszemu wglądowi w to czy wartości brakujące dla danej zmiennej zależą od innych zmiennych może służyć również przedstawienie powyższej wizualizacji po posortowaniu wg wybranej zmiennej</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missingno</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/72d8689ff052b0d1dad4d42e39b757d47e3d9a85980cfbb52688873dfbe5e9b8.png" src="../_images/72d8689ff052b0d1dad4d42e39b757d47e3d9a85980cfbb52688873dfbe5e9b8.png" />
</div>
</div>
<p>Znalezieniu relacji może służyć również heatmap macierzy korelacji.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missingno</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/3c41554160ab78ce96329ffe62d2f7d6fcb6658d79fb41064ac297247381f1c9.png" src="../_images/3c41554160ab78ce96329ffe62d2f7d6fcb6658d79fb41064ac297247381f1c9.png" />
</div>
</div>
<p>Przyjmijmy, że faktycznie wystąpił systematyczny błąd przy zapisywaniu zmiennej age zatem reprezentuje ona MNAR, zmienna bmi w oczywisty sposób będzie MAR jako, że odwołuje się teraz wprost do innej zmiennej, pozostałe zmienne jeśli nie mamy jakiejś dodatkowej informacji co do natury powstania wartości brakujących należy uznać za MCAR</p>
</section>
<section id="metody-imputacji-brakujacych-wartosci">
<h2>Metody imputacji brakujących wartości<a class="headerlink" href="#metody-imputacji-brakujacych-wartosci" title="Permalink to this heading">#</a></h2>
<div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p>Wszystkie przekształcenia wykorzystujące informacje o rozkładach cech należy implementować najpierw na zbiorze treningowym, a następnie w oparciu o rozkład ze zbioru treningowego - na zbiorze testowym. Inaczej wykorzystujemy informacje ze zbioru testowego i przestaje on być niezależny.</p>
</div><div class="alert alert-block alert-info">
<b>imputacja wartością specjalną</b> 
<ul class="simple">
<li><p>każdej brakującej obserwacji danej zmiennej przypisujemy np -1, -999 lub “N/A”, świadomie stosując wartość niewystępującą w obserwacjach bez brakującej wartości</p></li>
<li><p>przede wszystkim dla typu MNAR, gdzie zazwyczaj jest to jedyne prawidłowe podejście</p></li>
<li><p>można zastosować tutaj również 0 jeśli w naturalny sposób oznacza ono brak danego zjawiska i logika biznesowa nakazuje tak interpretować wartość brakującą</p></li>
</ul>
</div>
<div class="alert alert-block alert-info">
<b>imputacja wartością stałą</b> 
<ul class="simple">
<li><p>każdej brakującej obserwacji danej zmiennej przypisujemy tę samą wartość, w odróżnieniu od poprzedniej metody jest ona wyliczona w oparciu o dane treningowe</p></li>
<li><p>imputacja średnią - zachowuje średnią z danych, ale zaniża wariancję, może być narażona na wpływ wartości odstających</p></li>
<li><p>imputacja medianą - wolna od wpływu wartości odstających, ale wpływa na średnią i wariancję</p></li>
<li><p>imputacja modą - najczęściej stosowana dla zmiennych kategorycznych, jeśli nie mają charakteru MNAR</p></li>
</ul>
</div>
<div class="alert alert-block alert-info">
<b>imputacja wg grup</b> 
<ul class="simple">
<li><p>podobna do opisanej wyżej imputacji wartością stałą lecz realizowana osobno dla każdej zdefiniowanej w danych grupy</p></li>
<li><p>to jak dobrać grupy może wynikać z wiedzy biznesowej lub z EDA</p></li>
</ul>
</div><div class="alert alert-block alert-info">
<b>Imputacja wartością losową</b> 
<ul class="simple">
<li><p>w odróżnieniu od omówienych wcześniej metod, nie używamy tu tej samej wartości do wypełniania wszystkich obserwacji</p></li>
<li><p>może polegać na losowaniu wartości spośród niepustych obserwacji danej zmiennej lub dopasowaniu do niej rozkładu statystycznego i losowaniu z rozkładu</p></li>
</ul>
</div><div class="alert alert-block alert-info">
<b>Imputacja na podstawie kolejności</b> 
<ul class="simple">
<li><p>do stosowania w szeregach czasowych</p></li>
<li><p>może obejmować zastąpienie brakujących obserwacji za pomocą poprzedniej wartości lub kolejnej wartości</p></li>
<li><p>można stosować również metody oparte o większą liczbę poprzednich obserwacji np średnia krocząca</p></li>
<li><p>dobrze może się sprawdzać również interpolacja</p></li>
</ul>
</div><div class="alert alert-block alert-info">
<b>imputacja wartością specjalną</b> 
<p>Imputacja z wykorzystaniem modelu</p>
<ul class="simple">
<li><p>obejmuje przewidywanie brakujących wartości zmiennej na podstawie pozostałych zmiennych lub ich podgrupy</p></li>
<li><p>stosowane są tu zarówno algorytmy regresji jak i KNN lub modele drzewiaste</p></li>
</ul>
</div><section id="przyklady-imputacji">
<h3>Przykłady imputacji<a class="headerlink" href="#przyklady-imputacji" title="Permalink to this heading">#</a></h3>
<section id="imputacja-wartoscia-specjalna">
<h4>Imputacja wartością specjalną<a class="headerlink" href="#imputacja-wartoscia-specjalna" title="Permalink to this heading">#</a></h4>
<p>Zmienną age uznaliśmy za MNAR, co sugeruje, że nie można się posłużyć statystykami z próbki, tylko należy użyć wartości specjalnej. Jeśli wiemy, że wartości brakujące reprezentują starsze osoby wstawienie tutaj wartości np. -1 może nie być najlepszym rozwiązaniem, ponieważ takie podejście może zaburzyć monotoniczność relacji tej zmiennej ze zmienną celu, zamiast tego można spróbować wartości większej niż maksimum z obecnych danych np 70</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 300 entries, 0 to 196
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           300 non-null    int64  
 1   age                 300 non-null    float64
 2   weight              300 non-null    float64
 3   height              298 non-null    float64
 4   bmi                 298 non-null    float64
 5   city                300 non-null    object 
 6   num_covid_tests     232 non-null    float64
 7   num_positive_tests  270 non-null    float64
 8   sex                 274 non-null    object 
dtypes: float64(6), int64(1), object(2)
memory usage: 23.4+ KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="imputacja-wartoscia-stala">
<h4>Imputacja wartością stałą<a class="headerlink" href="#imputacja-wartoscia-stala" title="Permalink to this heading">#</a></h4>
<p>Pozostałe zmienne z brakującymi wartościami należy wypełnić w oparciu o wartości z danych treningowych, zanim do tego przystąpimy należy podzielić próbkę, co będzie reprezentowało rzeczywistą sytuację, gdy na podstawie dostępnych danych będziemy uzupełniać te przyszłe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Tutaj dla uproszczenia stosujemy tylko prosty podział na zbiór treningowy i testowy, generalnie najlepszą praktyką jest wydzielenie osobnego zbioru testowego reprezentującego zdolność modelu do generalizacji na nowych, niewidzianych wcześniej danych i dobór najlepszego zestawu parametrów i transformacji stosując crosswalidację na zbiorze treningowym.</p>
<section id="imputacja-zmiennych-kategorycznych">
<h5>Imputacja zmiennych kategorycznych<a class="headerlink" href="#imputacja-zmiennych-kategorycznych" title="Permalink to this heading">#</a></h5>
<p>W przypadku zmiennych kategorycznych, gdy nie stosujemy imputacji wartością specjalną najczęściej spotykaną strategią jest wypełnianie najczęściej występującą wartością w danych treningowych.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_sex_mode</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_train_sex_mode</span><span class="p">)</span>
<span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_train_sex_mode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatywnie można też skorzystać z klasy SimpleImputer z biblioteki sklearn. Użycie tego typu transformerów stanowi dobrą praktykę, ponieważ można je potem łączyć w pipeline co ułatwia development i zmniejsza ryzyko popełnienia błędów takich jak np. data leakage. Poniżej zaprezentujemy ponowny podział na zbiór treningowy i testowy oraz wypełnienie tej samej zmiennej z użyciem klasy SimpleImputer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">si_mode</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">)</span>
<span class="n">si_mode</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">si_mode</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">si_mode</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 225 entries, 297 to 103
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           225 non-null    int64  
 1   age                 225 non-null    float64
 2   weight              225 non-null    float64
 3   height              224 non-null    float64
 4   bmi                 224 non-null    float64
 5   city                225 non-null    object 
 6   num_covid_tests     176 non-null    float64
 7   num_positive_tests  206 non-null    float64
 8   sex                 225 non-null    object 
dtypes: float64(6), int64(1), object(2)
memory usage: 17.6+ KB
</pre></div>
</div>
</div>
</div>
<p>Powyżej stosujemy SimpleImputer na tylko jednej kolumnie, inaczej wszystkie zmienne z brakującymi wartościami zostałyby wypełnione swoją najczęstszą wartością. Standardową praktyką jest użycie klasy ColumnTransformer do przypisywania odpowiednich transformacji poszczególnym grupom zmiennych, co zostanie zaprezentowane później.</p>
</section>
<section id="imputacja-zmiennych-numerycznych">
<h5>Imputacja zmiennych numerycznych<a class="headerlink" href="#imputacja-zmiennych-numerycznych" title="Permalink to this heading">#</a></h5>
<p>Załóżmy, że chcemy zainputować zmienne numeryczne korzystając z mediany, użycie mediany może być dobrą alternatywą dla używania średniej jeśli obawiamy się wpływu wartości odstających na średnią.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">si_median</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
<span class="n">X_train_num</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
<span class="n">X_test_num</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
<span class="n">si_median</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_num</span><span class="p">)</span>
<span class="n">X_train_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">si_median</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_num</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span><span class="n">X_train_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">si_median</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_num</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span><span class="n">X_test_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_train_num</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_test_num</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 281 entries, 0 to 283
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           225 non-null    float64
 1   age                 225 non-null    float64
 2   weight              225 non-null    float64
 3   height              225 non-null    float64
 4   bmi                 225 non-null    float64
 5   num_covid_tests     225 non-null    float64
 6   num_positive_tests  225 non-null    float64
 7   city                225 non-null    object 
 8   sex                 225 non-null    object 
dtypes: float64(7), object(2)
memory usage: 22.0+ KB
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="laczenie-roznych-metod-imputacji-z-wykorzystaniem-pipeline">
<h4>Łączenie różnych metod imputacji z wykorzystaniem pipeline<a class="headerlink" href="#laczenie-roznych-metod-imputacji-z-wykorzystaniem-pipeline" title="Permalink to this heading">#</a></h4>
<p>Jak już wspomniano najlepszą praktykę przy stosowaniu imputacji stanowi łączenie poszczególnych transformacji w Pipeline będący ciągiem transformacji, który może też na końcu zawierać model predykcyjny. Tutaj pokażemy pipeline łączący wszystkie wcześniej stosowane operacje imputacji danych.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="c1"># przywrócenie danych do postaci sprzed imputacji</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">columns_to_impute_special_value</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span>
<span class="n">columns_to_impute_mode</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">columns_to_impute_median</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">columns_to_impute_special_value</span><span class="p">))</span>

<span class="n">pipeline_sv</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;special_value_imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">70</span><span class="p">))])</span>
<span class="n">pipeline_mode</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;mode_imputer&quot;</span><span class="p">,</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">))])</span>
<span class="n">pipeline_num</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;median_imputer&quot;</span><span class="p">,</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">))])</span>

<span class="n">column_transformer</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
                        <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
                         <span class="p">(</span><span class="s1">&#39;special_value_imputation&#39;</span><span class="p">,</span> <span class="n">pipeline_sv</span><span class="p">,</span> <span class="n">columns_to_impute_special_value</span><span class="p">),</span>
                         <span class="p">(</span><span class="s1">&#39;mode_imputation&#39;</span><span class="p">,</span> <span class="n">pipeline_mode</span><span class="p">,</span> <span class="n">columns_to_impute_mode</span><span class="p">),</span>
                         <span class="p">(</span><span class="s1">&#39;median_imputation&#39;</span><span class="p">,</span> <span class="n">pipeline_num</span><span class="p">,</span> <span class="n">columns_to_impute_median</span><span class="p">)</span>
                         <span class="p">])</span>
<span class="n">imputation_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;imputation&quot;</span><span class="p">,</span> <span class="n">column_transformer</span><span class="p">)])</span>

<span class="n">imputation_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">imputation_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">imputation_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 75 entries, 0 to 74
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype 
---  ------              --------------  ----- 
 0   unique_id           75 non-null     object
 1   age                 75 non-null     object
 2   weight              75 non-null     object
 3   height              75 non-null     object
 4   bmi                 75 non-null     object
 5   city                75 non-null     object
 6   num_covid_tests     75 non-null     object
 7   num_positive_tests  75 non-null     object
 8   sex                 75 non-null     object
dtypes: object(9)
memory usage: 5.4+ KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="imputacja-wg-grupy">
<h4>Imputacja wg grupy<a class="headerlink" href="#imputacja-wg-grupy" title="Permalink to this heading">#</a></h4>
<p>Wróćmy na chwilę do zmiennej age, załóżmy, że jej braki danych nie są jednak wynikiem systematycznego błędu lecz występują losowo, a co więcej wiemy, że każde z miast ze zmiennej city charakteryzuje się specyficznym rozkładem dla zmiennej age. Wówczas imputacja mogłaby tutaj wyglądać następująco</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">mean_age_by_city</span> <span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;city&quot;</span><span class="p">)[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">mean_age_by_city</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span><span class="s2">&quot;city&quot;</span><span class="p">,</span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;_mean&quot;</span><span class="p">))</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">mean_age_by_city</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span><span class="s2">&quot;city&quot;</span><span class="p">,</span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;_mean&quot;</span><span class="p">))</span>
<span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;age_mean&quot;</span><span class="p">])</span>
<span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;age_mean&quot;</span><span class="p">])</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;age_mean&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;age_mean&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 75 entries, 0 to 74
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           75 non-null     int64  
 1   age                 75 non-null     float64
 2   weight              75 non-null     float64
 3   height              74 non-null     float64
 4   bmi                 74 non-null     float64
 5   city                75 non-null     object 
 6   num_covid_tests     56 non-null     float64
 7   num_positive_tests  64 non-null     float64
 8   sex                 70 non-null     object 
dtypes: float64(6), int64(1), object(2)
memory usage: 5.4+ KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="imputacja-z-wykorzystaniem-modelu">
<h4>Imputacja z wykorzystaniem modelu<a class="headerlink" href="#imputacja-z-wykorzystaniem-modelu" title="Permalink to this heading">#</a></h4>
<p>Poniżej pokażemy jeszcze jak można do imputacji wykorzystać model ML na przykładzie klasy KNNImputer, która wykonuje imputację na podstawie wartości najbliższych obserwacji.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_train_num</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
<span class="n">X_test_num</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
<span class="n">knn</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_num</span><span class="p">)</span>
<span class="n">X_train_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">knn</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_num</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span> <span class="n">X_train_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">knn</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_num</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span> <span class="n">X_test_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_train_num</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_test_num</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 281 entries, 0 to 283
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           225 non-null    float64
 1   age                 225 non-null    float64
 2   weight              225 non-null    float64
 3   height              225 non-null    float64
 4   bmi                 225 non-null    float64
 5   num_covid_tests     225 non-null    float64
 6   num_positive_tests  225 non-null    float64
 7   city                225 non-null    object 
 8   sex                 204 non-null    object 
dtypes: float64(7), object(2)
memory usage: 22.0+ KB
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="metody-usuwania-brakujacych-wartosci">
<h2>Metody usuwania brakujących wartości<a class="headerlink" href="#metody-usuwania-brakujacych-wartosci" title="Permalink to this heading">#</a></h2>
<p>Drugim oprócz imputacji sposobem radzenia sobie z wartościami brakującymi jest ich usuwanie. Wybór pomiędzy usuwaniem, a imputacją zależy w dużym stopniu od ilości dostępnych danych oraz poziomu koncentracji wartości brakujących, a także tego jak istotne są dla nas dane zmienne lub obserwacje.</p>
<div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p>Należy pamiętać, żeby w przypadku stosowania usuwania brakujących obserwacji zacząć od usunięcia wszystkich niepotrzebnych kolumn, ponieważ mogą one potem niepotrzebnie wpłynąć na usuwanie obserwacji.</p>
</div><p>Najwygodniejszą opcją usuwania w bibliotece pandas jest funkcja dropna, kilka przykładów poniżej</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># usuwanie wszystkich obserwacji z jakimikolwiek wartościami brakującymi</span>
<span class="n">df_nonull</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
<span class="n">df_nonull</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 115 entries, 0 to 291
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           115 non-null    int64  
 1   age                 115 non-null    float64
 2   weight              115 non-null    float64
 3   height              115 non-null    float64
 4   bmi                 115 non-null    float64
 5   city                115 non-null    object 
 6   num_covid_tests     115 non-null    float64
 7   num_positive_tests  115 non-null    float64
 8   sex                 115 non-null    object 
dtypes: float64(6), int64(1), object(2)
memory usage: 9.0+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># usuwanie wszystkich obserwacji z progiem co najmniej 2 wartości brakujących</span>
<span class="n">df_nonull</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="n">df_nonull</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 297 entries, 0 to 196
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           297 non-null    int64  
 1   age                 186 non-null    float64
 2   weight              297 non-null    float64
 3   height              296 non-null    float64
 4   bmi                 296 non-null    float64
 5   city                297 non-null    object 
 6   num_covid_tests     232 non-null    float64
 7   num_positive_tests  267 non-null    float64
 8   sex                 273 non-null    object 
dtypes: float64(6), int64(1), object(2)
memory usage: 23.2+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># usuwanie wszystkich obserwacji z progiem co najmniej 1 wartością brakującą dla kolumn age, num_covid_tests i num_positive_tests</span>
<span class="n">df_nonull</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;num_covid_tests&quot;</span><span class="p">,</span> <span class="s2">&quot;num_positive_tests&quot;</span><span class="p">])</span>
<span class="n">df_nonull</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 259 entries, 0 to 291
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           259 non-null    int64  
 1   age                 186 non-null    float64
 2   weight              259 non-null    float64
 3   height              258 non-null    float64
 4   bmi                 258 non-null    float64
 5   city                259 non-null    object 
 6   num_covid_tests     215 non-null    float64
 7   num_positive_tests  246 non-null    float64
 8   sex                 235 non-null    object 
dtypes: float64(6), int64(1), object(2)
memory usage: 20.2+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># usuwanie kolumn mających co najmniej 10% wartości brakujących</span>
<span class="n">df_nonull</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mf">0.9</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df_nonull</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 300 entries, 0 to 196
Data columns (total 7 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   unique_id           300 non-null    int64  
 1   weight              300 non-null    float64
 2   height              298 non-null    float64
 3   bmi                 298 non-null    float64
 4   city                300 non-null    object 
 5   num_positive_tests  270 non-null    float64
 6   sex                 274 non-null    object 
dtypes: float64(4), int64(1), object(2)
memory usage: 18.8+ KB
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="czyszczenie-szeregow-czasowych">
<h1>Czyszczenie szeregów czasowych<a class="headerlink" href="#czyszczenie-szeregow-czasowych" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span> <span class="o">=</span> <span class="n">generate_ts_data</span><span class="p">()</span>
<span class="n">df_ts</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/f55ceae164912439395e6de410fc2d795566a613e7b2d42acdeaf22961c4b6dc.png" src="../_images/f55ceae164912439395e6de410fc2d795566a613e7b2d42acdeaf22961c4b6dc.png" />
</div>
</div>
<p>W czyszczeniu danych o charakterze szeregu czasowego bardzo użyteczna jest wizualna analiza danych. Analizując powyższy wykres można dostrzec dość regularny szereg czasowy z rocznym okresem sezonowości i trendem rosnącym. Widać również zaburzenia w postaci nieregularnie rozlokowanych pików w pojedynczych dniach oraz silnie zaburzony okres na przełomie 2019 i 2020.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1827 entries, 0 to 1826
Data columns (total 2 columns):
 #   Column     Non-Null Count  Dtype         
---  ------     --------------  -----         
 0   SalesDate  1827 non-null   datetime64[ns]
 1   SLSU       1827 non-null   float64       
dtypes: datetime64[ns](1), float64(1)
memory usage: 28.7 KB
</pre></div>
</div>
</div>
</div>
<p>Przed przejściem do dalszej analizy należy jeszcze upewnić się, że dane mają prawidłowe formaty i są odpowiednio posortowane, inaczej łatwo o błędne wnioski.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<span class="n">df_ts</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1827 entries, 0 to 1826
Data columns (total 2 columns):
 #   Column     Non-Null Count  Dtype         
---  ------     --------------  -----         
 0   SalesDate  1827 non-null   datetime64[ns]
 1   SLSU       1827 non-null   float64       
dtypes: datetime64[ns](1), float64(1)
memory usage: 28.7 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span> <span class="o">=</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">)</span>
<span class="n">df_ts</span> <span class="o">=</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/f55ceae164912439395e6de410fc2d795566a613e7b2d42acdeaf22961c4b6dc.png" src="../_images/f55ceae164912439395e6de410fc2d795566a613e7b2d42acdeaf22961c4b6dc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1827, 1827)
</pre></div>
</div>
</div>
</div>
<p>Dane nie mają duplikatów, są posortowane a formaty są już poprawne, możemy się zatem skupić na oznaczaniu i imputacji wartości zaburzonych.</p>
<div class="alert alert-block alert-info">
<b>Info</b> 
<p>Podstawą do oznaczenia danego zjawiska jako zaburzonego, a następnie jego imputacji powinna być zawsze wiedza biznesowa odnośnie tego czy dane zjawisko ma charakter jednorazowy i już się nie powtórzy w analogicznym okresie.</p>
</div><p>Istnieje wiele metod oznaczania anomalii w szeregach czasowych, mogą one też być mocno zależne od wiedzy na tematy powodu wystąpienia takiej anomali. Tutaj najpierw spróbujemy automatycznie wykryć pojedyncze zaburzenia w oparciu o porównanie z medianą z sąsiednich obserwacji.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">df_ts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/455a293503cb2dd83647f576f6e88e1eb8d57a6b9e773b173f5a3753747404a5.png" src="../_images/455a293503cb2dd83647f576f6e88e1eb8d57a6b9e773b173f5a3753747404a5.png" />
</div>
</div>
<p>jak widać takie podejście dobrze oddziela naturalne obserwacje od pojedynczych zaburzeń, można za jego pomocą oznaczyć wartości odstające jeśli np zauważymy, że różnica pomiędzy wyliczoną medianą a wartością pierwotną wynosi ponad 15%</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">])</span><span class="o">&gt;</span><span class="mf">0.15</span><span class="o">*</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">])</span><span class="o">&gt;</span><span class="mf">0.15</span><span class="o">*</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">])</span>
<span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/87a2f0b206179a0c7fb4bc2a7d2565f1a5b3d4c4fd970e9477af17d3dbaa91f1.png" src="../_images/87a2f0b206179a0c7fb4bc2a7d2565f1a5b3d4c4fd970e9477af17d3dbaa91f1.png" />
</div>
</div>
<div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p>Należy mieć świadomość, że przedstawiona powyżej metoda może również oznaczyć jako anomalia zupełnie naturalnie występujące obserwacje, wszystko zależy od konkretnej potrzeby przy czyszczeniu szeregu czasowego.</p>
</div><p>Obserwacje oznaczone jako puste można następnie zaimputować za pomocą wyliczonej wcześniej mediany lub dokonać interpolacji liniowej</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
<span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/c678b170389af8c4480a4caced9d1b4458df2076a5371ee11de54adcf9bd7e4b.png" src="../_images/c678b170389af8c4480a4caced9d1b4458df2076a5371ee11de54adcf9bd7e4b.png" />
</div>
</div>
<p>Jak widać z poniższego wykresu, interpolacja liniowa nie będzie jednak użyteczna w celu wypełnienia dłuższych zaburzeń, w szczególności w przypadku gdy przypadają one w okresie sezonowego szczytu. Zamiast tego spróbujmy dokonać prognozy modelem szeregu czasowego w oparciu o wcześniejsze, niezaburzone dane.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">])</span>
<span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/9f9846c2a0a862a5d7af457912616a248c1af5d0badfc9cce42a25bc78acc519.png" src="../_images/9f9846c2a0a862a5d7af457912616a248c1af5d0badfc9cce42a25bc78acc519.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Automatycznym sposobem na oznaczenie wartości odstających przy założeniu, że nie można tutaj po prostu patrzeć na obserwacje z wartością 0 jest porównanie z wartością sprzed roku a jeszcze lepiej z wygładzoną wartością, więc wygodnie jest użyć wyliczonej już wcześniej mediany kroczącej sprzed roku.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3_lag_1y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">365</span><span class="p">)</span>
<span class="n">df_ts</span><span class="p">[[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">,</span> <span class="s2">&quot;moving_SLSU_median_3_lag_1y&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/c084db319c566cd55f0ef629518845d81d0b6cbe6609fc24828eb8b78f4895d2.png" src="../_images/c084db319c566cd55f0ef629518845d81d0b6cbe6609fc24828eb8b78f4895d2.png" />
</div>
</div>
<p>Następnie można wyliczyć różnice pomiędzy wartością SLSU, a medianą i oznaczyć jako puste wartości odstające wyznaczone np metodą IQR, przyjmując dodatkowo warunek, że interesują nas tylko wartości większe od IQR, aby nie wyzerować wartości rok po zaburzeniu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3_lag_1y_DIFF_VS_SLSU&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3_lag_1y&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> 
<span class="n">df_ts</span><span class="p">[[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">,</span> <span class="s2">&quot;moving_SLSU_median_3_lag_1y&quot;</span><span class="p">,</span> <span class="s2">&quot;moving_SLSU_median_3_lag_1y_DIFF_VS_SLSU&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/087ee5e7eb88a1bb29f46a19d17599c3113e6439da6887b0daa60eb8eb418498.png" src="../_images/087ee5e7eb88a1bb29f46a19d17599c3113e6439da6887b0daa60eb8eb418498.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;IQR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3_lag_1y_DIFF_VS_SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span> <span class="o">-</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3_lag_1y_DIFF_VS_SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">))</span><span class="o">*</span><span class="mf">1.5</span>
<span class="n">df_ts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3_lag_1y_DIFF_VS_SLSU&quot;</span><span class="p">]</span> <span class="o">&gt;</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;IQR&quot;</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SLSU</th>
      <th>moving_SLSU_median_3</th>
      <th>moving_SLSU_median_3_lag_1y</th>
      <th>moving_SLSU_median_3_lag_1y_DIFF_VS_SLSU</th>
      <th>IQR</th>
    </tr>
    <tr>
      <th>SalesDate</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-11-01</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>8818.736687</td>
      <td>8818.736687</td>
      <td>2249.224099</td>
    </tr>
    <tr>
      <th>2019-11-02</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>8820.468738</td>
      <td>8820.468738</td>
      <td>2249.224099</td>
    </tr>
    <tr>
      <th>2019-11-03</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>8822.200788</td>
      <td>8822.200788</td>
      <td>2249.224099</td>
    </tr>
    <tr>
      <th>2019-11-04</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>8823.932839</td>
      <td>8823.932839</td>
      <td>2249.224099</td>
    </tr>
    <tr>
      <th>2019-11-05</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>9437.078825</td>
      <td>9437.078825</td>
      <td>2249.224099</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-02-26</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>10179.000000</td>
      <td>10179.000000</td>
      <td>2249.224099</td>
    </tr>
    <tr>
      <th>2020-02-27</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>10181.000000</td>
      <td>10181.000000</td>
      <td>2249.224099</td>
    </tr>
    <tr>
      <th>2020-02-28</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>10181.000000</td>
      <td>10181.000000</td>
      <td>2249.224099</td>
    </tr>
    <tr>
      <th>2020-02-29</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>8587.000000</td>
      <td>8587.000000</td>
      <td>2249.224099</td>
    </tr>
    <tr>
      <th>2020-03-01</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>8587.000000</td>
      <td>8587.000000</td>
      <td>2249.224099</td>
    </tr>
  </tbody>
</table>
<p>122 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;moving_SLSU_median_3_lag_1y_DIFF_VS_SLSU&quot;</span><span class="p">]</span> <span class="o">&gt;</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;IQR&quot;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">])</span>
<span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/554e0c5ecfe78dc74d823fc8e951bf3707b90994c1bd3cdac1ecf44f961eb7bf.png" src="../_images/554e0c5ecfe78dc74d823fc8e951bf3707b90994c1bd3cdac1ecf44f961eb7bf.png" />
</div>
</div>
<p>Następnie można uzupełnić dane dokonując predykcji np. w oparciu od dane do połowy roku 2019, jakość predykcji ocenić można przez porównanie z niezaburzonymi obserwacjami, Do predykcji użyjemy tutaj modelu STLForecast, który dekomponuje szereg czasowy na trend, sezonowość i czynnik losowy i wykonuje predykcję odsezonowionych danych z użyciem modelu ARIMA</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.api</span> <span class="kn">import</span> <span class="n">STLForecast</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="n">test_start</span> <span class="o">=</span> <span class="s2">&quot;2019-07-01&quot;</span>
<span class="n">df_ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">inferred_freq</span><span class="p">)</span> <span class="c1"># ustawienie kroku</span>
<span class="n">df_ts_train</span> <span class="o">=</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="n">test_start</span><span class="p">,</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span>
<span class="n">df_ts_test</span> <span class="o">=</span> <span class="n">df_ts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;=</span><span class="n">test_start</span><span class="p">,</span> <span class="s2">&quot;SLSU&quot;</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">STLForecast</span><span class="p">(</span><span class="n">df_ts_train</span><span class="p">,</span> <span class="n">ARIMA</span><span class="p">,</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;enforce_invertibility&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">period</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
<span class="n">stl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">df_ts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_ts</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;=</span><span class="n">test_start</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">stl</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_ts_test</span><span class="p">))</span>
<span class="n">df_ts</span><span class="p">[[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/cb01f7dafe6702d2170248f8a78db45851283046338436a0fa3601e860f0dfb3.png" src="../_images/cb01f7dafe6702d2170248f8a78db45851283046338436a0fa3601e860f0dfb3.png" />
</div>
</div>
<p>Tym sposobem otrzymujemy oczyszczony szereg czasowy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">])</span>
<span class="n">df_ts</span><span class="p">[</span><span class="s2">&quot;SLSU&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/332d9072ab4655dc738bb3952f9119b2cae0775291e8e3e404ebf2103e0fa094.png" src="../_images/332d9072ab4655dc738bb3952f9119b2cae0775291e8e3e404ebf2103e0fa094.png" />
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./10. Czyszczenie_danych"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../6.%20Inzynieria_cech/6_Inzynieria%20cech.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Inżynieria cech</p>
      </div>
    </a>
    <a class="right-next"
       href="../7.%20Klasteryzacja/7_Klasteryzacja.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Klasteryzacja w Python</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Czyszczenie danych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#wygenerowanie-danych">Wygenerowanie danych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#czyszczenie-danych-tabularycznych">Czyszczenie danych tabularycznych</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#formaty-danych">Formaty danych</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#atrybuty-zmiennych-kategorycznych">Atrybuty zmiennych kategorycznych</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#weryfikacja-duplikatow">Weryfikacja duplikatów</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sprawdzanie-zmiennych-numerycznych">Sprawdzanie zmiennych numerycznych</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relacje-pomiedzy-zmiennymi">Relacje pomiędzy zmiennymi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-wartosci-brakujacych">Imputacja wartości brakujących</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metody-imputacji-brakujacych-wartosci">Metody imputacji brakujących wartości</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#przyklady-imputacji">Przykłady imputacji</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-wartoscia-specjalna">Imputacja wartością specjalną</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-wartoscia-stala">Imputacja wartością stałą</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-zmiennych-kategorycznych">Imputacja zmiennych kategorycznych</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-zmiennych-numerycznych">Imputacja zmiennych numerycznych</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#laczenie-roznych-metod-imputacji-z-wykorzystaniem-pipeline">Łączenie różnych metod imputacji z wykorzystaniem pipeline</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-wg-grupy">Imputacja wg grupy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacja-z-wykorzystaniem-modelu">Imputacja z wykorzystaniem modelu</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metody-usuwania-brakujacych-wartosci">Metody usuwania brakujących wartości</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#czyszczenie-szeregow-czasowych">Czyszczenie szeregów czasowych</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By codersi
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>