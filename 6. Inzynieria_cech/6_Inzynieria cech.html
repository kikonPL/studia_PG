

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Inżynieria cech &#8212; Silky Coders Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '6. Inzynieria_cech/6_Inzynieria cech';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Czyszczenie danych" href="../10.%20Czyszczenie_danych/Czyszczenie%20danych.html" />
    <link rel="prev" title="Wykrywanie anomalii - tutorial" href="../5.%20Wykrywanie_anomalii/5_Wykrywanie%20anomalii%20tutorial.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/silky-logo.png" class="logo__image only-light" alt="Silky Coders Data Science - Home"/>
    <img src="../_static/silky-logo.png" class="logo__image only-dark pst-js-only" alt="Silky Coders Data Science - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Laboratorium specjalistyczne: Data Science w branży modowej, 1 semestr studiów magisterskich Matematyki na Wydziale Fizyki Technicznej i Matematyki Stosowanej na Politechnice Gdańskiej
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Fundamenty Pythona</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../0.%20Wst%C4%99p/TutorialBasicsPython.html">Podstawy Python</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wprowadzenie do pakietów numpy i pandas</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../1.%20Tutorial%20pandas/1_Tutorial%20pandas.html">Pakiet pandas - tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.%20Numpy_tutorial/2_Tutorial%20numpy.html">Pakiet NumPy - tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wizualizacja danych</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../3.%20Wizualizacja_danych/3_Wizualizacja%20danych.html">Wizualizacja danych w Python</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Analiza statystyczna</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../4.%20Analiza_statystyczna/4_Analiza%20statystyczna.html">Analiza statystyczna - tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wykrywanie anomalii</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../5.%20Wykrywanie_anomalii/Wykrywanie_anomalii_teoria.html">Wykrywanie anomalii - definicje</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5.%20Wykrywanie_anomalii/5_Wykrywanie%20anomalii%20tutorial.html">Wykrywanie anomalii - tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Inżynieria cech</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Inżynieria cech</a></li>











</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Czyszczenie danych</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../10.%20Czyszczenie_danych/Czyszczenie%20danych.html">Czyszczenie danych</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Klasteryzacja</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../7.%20Klasteryzacja/7_Klasteryzacja.html">Klasteryzacja w Python</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Klasyfikacja</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../12.%20Klasyfikacja/Klasyfikacja.html">Klasyfikacja w Python</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Regresja</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../11.%20Regresja/Regresja_lin.html">Liniowe modele regresji</a></li>
<li class="toctree-l1"><a class="reference internal" href="../11.%20Regresja/Regresja_trees.html">Regresja oparta o modele drzewiaste</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wyjaśnialność modeli</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../8.%20Wyjasnialnosc/8_Tutorial%20metryki%20statystyczne.html">Wyjaśnialność modeli - metryki statystyczne - tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9.%20XAI/Wyjasnialnosc_modeli_definicje.html">Wyjaśnialność modeli - definicje</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9.%20XAI/9_Wyjasnialnosc%20modeli.html">Wyjaśnialność modeli - XAI - tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Przetwarzanie języka naturalnego</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../13.%20NLP/TutorialNLP.html">NLP</a></li>





</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/kikonPL/studia_PG/blob/main/6. Inzynieria_cech/6_Inzynieria cech.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/kikonPL/studia_PG" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kikonPL/studia_PG/issues/new?title=Issue%20on%20page%20%2F6. Inzynieria_cech/6_Inzynieria cech.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/6. Inzynieria_cech/6_Inzynieria cech.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Inżynieria cech</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Inżynieria cech</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tworzenie-przykladowych-zbiorow-danych">Tworzenie przykładowych zbiorów danych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-tworzone-na-podstawie-danych-czasowych">Cechy tworzone na podstawie danych czasowych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-powstale-przez-przesuniecie-w-czasie">Cechy powstałe przez przesunięcie w czasie</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-kategoryczne-i-ich-transformacje">Cechy kategoryczne i ich transformacje</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#laczenie-atrybutow-cech-kategorycznych">Łączenie atrybutów cech kategorycznych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-oparte-na-wiedzy-domenowej-oraz-cechy-interakcji">Cechy oparte na wiedzy domenowej oraz cechy interakcji</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-oparte-na-transformacji-zmiennych-numerycznych">Cechy oparte na transformacji zmiennych numerycznych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#laczenie-zmiennych-numerycznych-w-przedzialy">Łączenie zmiennych numerycznych w przedziały</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#normalizacja-i-standaryzacja">Normalizacja i Standaryzacja</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#laczenie-roznych-transformacji-w-ramach-pipeline">Łączenie różnych transformacji w ramach pipeline</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#podsumowanie">Podsumowanie</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="inzynieria-cech">
<h1>Inżynieria cech<a class="headerlink" href="#inzynieria-cech" title="Permalink to this heading">#</a></h1>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>Feature Engineering</b> polega na przekształcaniu surowych danych w cechy użyteczne w procesie modelowania.</p>
</div><div class="alert alert-block alert-info">
<b>Info</b> 
<p>Tworzenie zmiennych predykcyjnych zawsze powinno opierać się przede wszystkim na zrozumieniu danych i wiedzy biznesowej związanej z danym problemem. Istnieje jednak kilka standardowych technik, które można stosować do tworzenia cech w większości problemów, można tu wyróżnić:</p>
<ul class="simple">
<li><p>przekształcanie zmiennych kategorycznych</p></li>
<li><p>zmienne na podstawie cech z daty</p></li>
<li><p>zmienne powstałe przez przesunięcie w czasie</p></li>
<li><p>transformacje zmiennych numerycznych</p></li>
<li><p>zmienne interakcji</p></li>
</ul>
</div><div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p><b>Feature Engineering</b> stanowi jeden z ważniejszych etapów w procesie budowy uczenia maszynowego, dlatego należy mu poświęcić dużo uwagi. Często można uzyskać znacznie lepsze wyniki mając prosty model oparty na cechach predykcyjnych dobrze oddających naturę badanego zjawiska niż budując wyrafinowany model w oparciu o zbyt wąski zbiór zmiennych.</p>
</div></section>
<section class="tex2jax_ignore mathjax_ignore" id="tworzenie-przykladowych-zbiorow-danych">
<h1>Tworzenie przykładowych zbiorów danych<a class="headerlink" href="#tworzenie-przykladowych-zbiorow-danych" title="Permalink to this heading">#</a></h1>
<p>Zaprezentujemy tutaj 2 przykładowe zbiory danych o różnym charakterze oraz przykłady zmiennych predykcyjnych, które można wygenerować na ich podstawie</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generateIceCreamSalesData</span><span class="p">(</span><span class="n">month_coef</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">week_coef</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">day_coef</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_coef</span> <span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;2018-01-01&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2020-12-31&quot;</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SalesDate</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SalesDate</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;WeekDay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SalesDate</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;IceCreamSales&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Month</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">month_coef</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Week</span><span class="o">-</span><span class="mi">27</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">week_coef</span> <span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">WeekDay</span><span class="o">*</span><span class="n">day_coef</span> <span class="o">+</span><span class="n">random_coef</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">high</span> <span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">,</span><span class="s2">&quot;IceCreamSales&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IceCream_df</span> <span class="o">=</span> <span class="n">generateIceCreamSalesData</span><span class="p">()</span>
<span class="n">IceCream_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SalesDate</th>
      <th>IceCreamSales</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-01-01</td>
      <td>203100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-01-02</td>
      <td>233200</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-01-03</td>
      <td>213300</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018-01-04</td>
      <td>213400</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-01-05</td>
      <td>243500</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1091</th>
      <td>2020-12-27</td>
      <td>124700</td>
    </tr>
    <tr>
      <th>1092</th>
      <td>2020-12-28</td>
      <td>113100</td>
    </tr>
    <tr>
      <th>1093</th>
      <td>2020-12-29</td>
      <td>143200</td>
    </tr>
    <tr>
      <th>1094</th>
      <td>2020-12-30</td>
      <td>73300</td>
    </tr>
    <tr>
      <th>1095</th>
      <td>2020-12-31</td>
      <td>73400</td>
    </tr>
  </tbody>
</table>
<p>1096 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_used_cars_data</span><span class="p">(</span><span class="n">len_df</span> <span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">conditions</span> <span class="o">=</span><span class="p">{</span><span class="s2">&quot;very_bad&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;bad&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;medium&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;good&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s2">&quot;very_good&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
    <span class="n">brands</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;Fiat&quot;</span><span class="p">,</span><span class="s2">&quot;Renault&quot;</span><span class="p">,</span><span class="s2">&quot;VW&quot;</span><span class="p">,</span> <span class="s2">&quot;Seat&quot;</span><span class="p">,</span> <span class="s2">&quot;Skoda&quot;</span><span class="p">,</span><span class="s2">&quot;Toyota&quot;</span><span class="p">,</span> <span class="s2">&quot;Audi&quot;</span><span class="p">,</span><span class="s2">&quot;BMW&quot;</span><span class="p">,</span><span class="s2">&quot;Mercedes&quot;</span><span class="p">,</span> <span class="s2">&quot;Bugatti&quot;</span><span class="p">]</span>
    <span class="n">standard_brands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Fiat&quot;</span><span class="p">,</span><span class="s2">&quot;Renault&quot;</span><span class="p">,</span><span class="s2">&quot;VW&quot;</span><span class="p">,</span> <span class="s2">&quot;Seat&quot;</span><span class="p">,</span> <span class="s2">&quot;Skoda&quot;</span><span class="p">,</span><span class="s2">&quot;Toyota&quot;</span><span class="p">]</span>
    <span class="n">premium_brands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Audi&quot;</span><span class="p">,</span><span class="s2">&quot;BMW&quot;</span><span class="p">,</span><span class="s2">&quot;Mercedes&quot;</span><span class="p">]</span>
    <span class="n">luxury_brands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Bugatti&quot;</span><span class="p">]</span>
    <span class="n">dict_data</span> <span class="o">=</span><span class="p">{</span><span class="s2">&quot;condition&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">conditions</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="n">size</span><span class="o">=</span><span class="n">len_df</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span><span class="mf">0.2</span> <span class="p">]),</span>
                <span class="s2">&quot;brand&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">brands</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">len_df</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span> <span class="p">),</span>
                <span class="s2">&quot;year_manufactured&quot;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span><span class="mi">2020</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span><span class="n">len_df</span><span class="p">)</span>
               <span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_data</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span><span class="mi">2021</span><span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">year_manufactured</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;mileage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span> <span class="n">len_df</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span> <span class="n">len_df</span><span class="p">)</span>
    
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;selling_price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100000</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">standard_brands</span><span class="p">)</span><span class="o">+</span><span class="mi">300000</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">premium_brands</span><span class="p">)</span><span class="o">+</span><span class="mi">600000</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">luxury_brands</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;selling_price&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mileage</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;condition_num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">conditions</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;selling_price&quot;</span><span class="p">]</span> <span class="o">*=</span>  <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;condition_num&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">luxury_brands</span><span class="p">))</span><span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">year_manufactured</span><span class="o">&lt;=</span><span class="mi">1970</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;condition_num&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">),</span><span class="s2">&quot;selling_price&quot;</span><span class="p">]</span> <span class="o">*=</span>\
    <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">luxury_brands</span><span class="p">))</span><span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">year_manufactured</span><span class="o">&lt;=</span><span class="mi">1970</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;condition_num&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">),</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;selling_price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;selling_price&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s2">&quot;selling_price&quot;</span><span class="p">,</span><span class="s2">&quot;condition&quot;</span><span class="p">,</span><span class="s2">&quot;mileage&quot;</span><span class="p">,</span><span class="s2">&quot;brand&quot;</span><span class="p">,</span><span class="s2">&quot;year_manufactured&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UsedCars_df</span> <span class="o">=</span><span class="n">generate_used_cars_data</span><span class="p">()</span>
<span class="n">UsedCars_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>selling_price</th>
      <th>condition</th>
      <th>mileage</th>
      <th>brand</th>
      <th>year_manufactured</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11847.0</td>
      <td>very_good</td>
      <td>142420</td>
      <td>Fiat</td>
      <td>1996</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7565.0</td>
      <td>bad</td>
      <td>75113</td>
      <td>VW</td>
      <td>1995</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9227.0</td>
      <td>medium</td>
      <td>128923</td>
      <td>Fiat</td>
      <td>1996</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9528.0</td>
      <td>good</td>
      <td>442577</td>
      <td>Skoda</td>
      <td>1973</td>
    </tr>
    <tr>
      <th>4</th>
      <td>35619.0</td>
      <td>good</td>
      <td>38546</td>
      <td>BMW</td>
      <td>2002</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>995</th>
      <td>29364.0</td>
      <td>good</td>
      <td>238655</td>
      <td>BMW</td>
      <td>1964</td>
    </tr>
    <tr>
      <th>996</th>
      <td>8055.0</td>
      <td>bad</td>
      <td>55871</td>
      <td>Seat</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>997</th>
      <td>31455.0</td>
      <td>good</td>
      <td>178409</td>
      <td>BMW</td>
      <td>1996</td>
    </tr>
    <tr>
      <th>998</th>
      <td>9428.0</td>
      <td>good</td>
      <td>447080</td>
      <td>Fiat</td>
      <td>1964</td>
    </tr>
    <tr>
      <th>999</th>
      <td>4125.0</td>
      <td>very_bad</td>
      <td>405574</td>
      <td>Fiat</td>
      <td>1973</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 5 columns</p>
</div></div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cechy-tworzone-na-podstawie-danych-czasowych">
<h1>Cechy tworzone na podstawie danych czasowych<a class="headerlink" href="#cechy-tworzone-na-podstawie-danych-czasowych" title="Permalink to this heading">#</a></h1>
<p>Pierwszy zbiór danych nazwany tutaj IceCream_df de facto ma charakter szeregu czasowego i patrząc na poniższy wykres mógłby być z powodzeniem przewidywany dedykowanymi metodami do predykcji szeregów czasowych, jednak dla celów pokazania tworzenia zmiennych na podstawie danych o charakterze czasowym potraktujemy to zagadnienie jako problem regresyjny, w którym naszą zmienną celu będzie IceCreamSales.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IceCream_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;IceCream Sales&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: title={&#39;center&#39;: &#39;IceCream Sales&#39;}, xlabel=&#39;SalesDate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/eb2ad638ac5052243cbb72974b9a0594452acc8ed74065b9ff317e143842fa50.png" src="../_images/eb2ad638ac5052243cbb72974b9a0594452acc8ed74065b9ff317e143842fa50.png" />
</div>
</div>
<p>Wyraźnie widać tutaj, że sprzedaż lodów ma silnie sezonowy charakter, stąd cechy wyciągnięte z daty powinny znacznie ułatwić dobrą predykcję. Funkcję generującą takie cechy zaprezentowano poniżej:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_date_features</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">date_column</span><span class="p">):</span>
    <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span> <span class="o">+</span> <span class="s1">&#39;Quarter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">quarter</span>
    <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span> <span class="o">+</span> <span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span> <span class="o">+</span> <span class="s1">&#39;Week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span>
    <span class="c1"># poniżej zwracany rozkład to 0-6, dodajemy 1 aby przejsc na bardziej intuicyjne wartości 1-7</span>
    <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span> <span class="o">+</span> <span class="s1">&#39;WeekDay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span> <span class="o">+</span> <span class="mi">1</span> 
    <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span> <span class="o">+</span> <span class="s1">&#39;YearDay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_year</span>
    <span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span> <span class="o">+</span> <span class="s1">&#39;isWeekend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df_temp</span><span class="p">[</span><span class="n">date_column</span> <span class="o">+</span> <span class="s1">&#39;WeekDay&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_temp</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IceCream_df_extended</span> <span class="o">=</span> <span class="n">extract_date_features</span><span class="p">(</span><span class="n">IceCream_df</span><span class="p">,</span><span class="s2">&quot;SalesDate&quot;</span><span class="p">)</span>
<span class="n">IceCream_df_extended</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SalesDate</th>
      <th>IceCreamSales</th>
      <th>SalesDateQuarter</th>
      <th>SalesDateMonth</th>
      <th>SalesDateWeek</th>
      <th>SalesDateWeekDay</th>
      <th>SalesDateYearDay</th>
      <th>SalesDateisWeekend</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-01-01</td>
      <td>203100</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-01-02</td>
      <td>233200</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-01-03</td>
      <td>213300</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018-01-04</td>
      <td>213400</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-01-05</td>
      <td>243500</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>5</td>
      <td>5</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1091</th>
      <td>2020-12-27</td>
      <td>124700</td>
      <td>4</td>
      <td>12</td>
      <td>52</td>
      <td>7</td>
      <td>362</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1092</th>
      <td>2020-12-28</td>
      <td>113100</td>
      <td>4</td>
      <td>12</td>
      <td>53</td>
      <td>1</td>
      <td>363</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1093</th>
      <td>2020-12-29</td>
      <td>143200</td>
      <td>4</td>
      <td>12</td>
      <td>53</td>
      <td>2</td>
      <td>364</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1094</th>
      <td>2020-12-30</td>
      <td>73300</td>
      <td>4</td>
      <td>12</td>
      <td>53</td>
      <td>3</td>
      <td>365</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1095</th>
      <td>2020-12-31</td>
      <td>73400</td>
      <td>4</td>
      <td>12</td>
      <td>53</td>
      <td>4</td>
      <td>366</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>1096 rows × 8 columns</p>
</div></div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cechy-powstale-przez-przesuniecie-w-czasie">
<h1>Cechy powstałe przez przesunięcie w czasie<a class="headerlink" href="#cechy-powstale-przez-przesuniecie-w-czasie" title="Permalink to this heading">#</a></h1>
<p>Analizując wykres można zaobserwować, że sprzedaż lodów nie jest liniowo zależna od zmiennych takich jak numer kwartału, numer miesiąca czy numer tygodnia, aby uzyskać lepsze wyniki warto zbudować cechy w oparciu o przesunięte w czasie wartości zmiennej celu.</p>
<div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p>Przy korzystaniu ze zmiennych przesuniętych w czasie, w szczególności opartych o wcześniejsze wartości zmiennej celu należy zawsze wziąć pod uwagę jakie dane będziemy mieli dostępne na moment predykcji, inaczej możemy popełnić jeden z najczęstszych błędów czyli <b>data leakage</b>.
Przy założeniu, że mamy przewidywać sprzedaż lodów np na rok do przodu wykorzystanie sprzedaży lodów z dnia poprzedniego stanowi data leakage, ponieważ ta informacja nie będzie dostępna na moment predykcji w tej samej formie. Moglibyśmy natomiast uwzględnić sprzedaż lodów sprzed roku, jako, że ta informacja będzie dostępna w tej samej formie.</p>
</div><p>Tutaj dla uproszczenia zakładamy chwilowo, że horyzont predykcji to tylko 1 dzień do przodu, co pozwoli zaprezentować większy zakres zmiennych przesuniętych w czasie.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_shifted_target_values</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">lag_values</span><span class="p">,</span> <span class="n">date_column</span><span class="p">,</span> <span class="n">target_column</span><span class="p">):</span>
    <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df_temp</span> <span class="o">=</span><span class="n">df_temp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">date_column</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lag_values</span><span class="p">:</span>
        <span class="n">df_temp</span><span class="p">[</span><span class="n">target_column</span> <span class="o">+</span><span class="s2">&quot;_lagged_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lag</span><span class="p">)]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_temp</span>
</pre></div>
</div>
</div>
</div>
<p>Uwzględniając, że przewidujemy z horyzontem czasowym tylko na dzień w przód, pierwszym kandydatem na wartość przesunięcia jest 1 dzień, jako, że w danych o charakterze szeregu czasowego podobieństwo kolejnych obserwacji będzie siłą rzeczy relatywnie wysokie. Z analizy wykresu można łatwo wywnioskować, że wartośc przesunięcia 365 dni również będzie miała dużą siłę predykcyjną. Ponadto można tutaj wypróbować 7 dni co powinno być przydatne w przypadku tygodniowej sezonowości danych</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IceCream_df_extended</span> <span class="o">=</span> <span class="n">get_shifted_target_values</span><span class="p">(</span><span class="n">IceCream_df_extended</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">365</span><span class="p">],</span> <span class="s2">&quot;SalesDate&quot;</span><span class="p">,</span><span class="s2">&quot;IceCreamSales&quot;</span><span class="p">)</span>
<span class="n">IceCream_df_extended</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SalesDate</th>
      <th>IceCreamSales</th>
      <th>SalesDateQuarter</th>
      <th>SalesDateMonth</th>
      <th>SalesDateWeek</th>
      <th>SalesDateWeekDay</th>
      <th>SalesDateYearDay</th>
      <th>SalesDateisWeekend</th>
      <th>IceCreamSales_lagged_1</th>
      <th>IceCreamSales_lagged_7</th>
      <th>IceCreamSales_lagged_365</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-01-01</td>
      <td>203100</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-01-02</td>
      <td>233200</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>203100</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-01-03</td>
      <td>213300</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>233200</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018-01-04</td>
      <td>213400</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>213300</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-01-05</td>
      <td>243500</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>5</td>
      <td>5</td>
      <td>0</td>
      <td>213400</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1091</th>
      <td>2020-12-27</td>
      <td>124700</td>
      <td>4</td>
      <td>12</td>
      <td>52</td>
      <td>7</td>
      <td>362</td>
      <td>1</td>
      <td>134600</td>
      <td>213700</td>
      <td>134600</td>
    </tr>
    <tr>
      <th>1092</th>
      <td>2020-12-28</td>
      <td>113100</td>
      <td>4</td>
      <td>12</td>
      <td>53</td>
      <td>1</td>
      <td>363</td>
      <td>0</td>
      <td>124700</td>
      <td>114100</td>
      <td>114700</td>
    </tr>
    <tr>
      <th>1093</th>
      <td>2020-12-29</td>
      <td>143200</td>
      <td>4</td>
      <td>12</td>
      <td>53</td>
      <td>2</td>
      <td>364</td>
      <td>0</td>
      <td>113100</td>
      <td>164200</td>
      <td>93100</td>
    </tr>
    <tr>
      <th>1094</th>
      <td>2020-12-30</td>
      <td>73300</td>
      <td>4</td>
      <td>12</td>
      <td>53</td>
      <td>3</td>
      <td>365</td>
      <td>0</td>
      <td>143200</td>
      <td>134300</td>
      <td>133200</td>
    </tr>
    <tr>
      <th>1095</th>
      <td>2020-12-31</td>
      <td>73400</td>
      <td>4</td>
      <td>12</td>
      <td>53</td>
      <td>4</td>
      <td>366</td>
      <td>0</td>
      <td>73300</td>
      <td>114400</td>
      <td>213300</td>
    </tr>
  </tbody>
</table>
<p>1096 rows × 11 columns</p>
</div></div></div>
</div>
<p>Widzimy, że początek zbioru danych zawiera teraz wartości puste, ze względu na fakt, że dla wartości z roku 2018 nie istniały obserwacje cofnięte o rok. Do pokazywania liczby niepustych wartości w ramce danych przydatna jest funkcja info z biblioteki pandas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IceCream_df_extended</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1096 entries, 0 to 1095
Data columns (total 11 columns):
 #   Column                    Non-Null Count  Dtype         
---  ------                    --------------  -----         
 0   SalesDate                 1096 non-null   datetime64[ns]
 1   IceCreamSales             1096 non-null   Int64         
 2   SalesDateQuarter          1096 non-null   int32         
 3   SalesDateMonth            1096 non-null   int32         
 4   SalesDateWeek             1096 non-null   UInt32        
 5   SalesDateWeekDay          1096 non-null   int32         
 6   SalesDateYearDay          1096 non-null   int32         
 7   SalesDateisWeekend        1096 non-null   int32         
 8   IceCreamSales_lagged_1    1095 non-null   Int64         
 9   IceCreamSales_lagged_7    1089 non-null   Int64         
 10  IceCreamSales_lagged_365  731 non-null    Int64         
dtypes: Int64(4), UInt32(1), datetime64[ns](1), int32(5)
memory usage: 74.0 KB
</pre></div>
</div>
</div>
</div>
<p>oczywiście wartości puste należy potem w jakiś sposób obsłużyć, poprzez ich usunięcie lub imputację</p>
<div class="alert alert-block alert-info">
<b>Info</b> 
<p>Tworząc zmienne oparte o cechy przesunięte w czasie warto mieć na uwadze, że dane historyczne mogą zawierać wartości odstające. Dlatego zamiast brać wprost wartość sprzed np. 365 dni można rozważyć wygładzenie wartości stosując medianę z 5 dniowego okna, którego środek stanowi wartość sprzed 365 dni.</p>
</div></section>
<section class="tex2jax_ignore mathjax_ignore" id="cechy-kategoryczne-i-ich-transformacje">
<h1>Cechy kategoryczne i ich transformacje<a class="headerlink" href="#cechy-kategoryczne-i-ich-transformacje" title="Permalink to this heading">#</a></h1>
<p>Dla zilustrowania transformacji na zmiennych kategorycznych posłużymy się drugim z przygotowanych zbiorów danych, gdzie chcemy przewidzieć cenę sprzedaży używanego samochodu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UsedCars_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>selling_price</th>
      <th>condition</th>
      <th>mileage</th>
      <th>brand</th>
      <th>year_manufactured</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11847.0</td>
      <td>very_good</td>
      <td>142420</td>
      <td>Fiat</td>
      <td>1996</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7565.0</td>
      <td>bad</td>
      <td>75113</td>
      <td>VW</td>
      <td>1995</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9227.0</td>
      <td>medium</td>
      <td>128923</td>
      <td>Fiat</td>
      <td>1996</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9528.0</td>
      <td>good</td>
      <td>442577</td>
      <td>Skoda</td>
      <td>1973</td>
    </tr>
    <tr>
      <th>4</th>
      <td>35619.0</td>
      <td>good</td>
      <td>38546</td>
      <td>BMW</td>
      <td>2002</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Jak widzimy występują tutaj 2 cechy kategoryczne condition oraz brand, na podstawie których zaprezentujemy które transformacje danych najlepiej zastosować w którym przypadku. Aby umożliwić wykorzystanie tych cech w predykcji niezbędne jest odpowiednie ich przekształcenie w wartości numeryczne.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UsedCars_df</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;very_good&#39;, &#39;bad&#39;, &#39;medium&#39;, &#39;good&#39;, &#39;very_bad&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>patrząc na atrybuty zmiennej condition widzimy, że ma ona charakter porządkowy - jesteśmy w stanie łatwo ustalić naturalną kolejność jej atrybutów. Stanowi ona zatem dobrego kandydata do zastosowania <b>kodowania porządkowego</b>.</p>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>kodowania porządkowe</b> (ang. <em>Ordinal encoding</em>) - reprezentacja każdego atrybutu kodowanej zmiennej jako kolejnej liczby naturalnej.</p>
</div><p>Poniżej zaprezentujemy kodowanie porządkowe z użyciem transformera OrdinalEncoder, najpierw jednak podzielimy nasze dane na zbiór treningowy i testowy, aby lepiej odwzorować to, że dane treningowe są oddzielone od danych produkcyjnych, na których model będzie potem stosowany.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</pre></div>
</div>
</div>
</div>
<p>Tutaj dla uproszczenia stosujemy podział tylko na zbiór treningowy i testowy, generalnie najlepszą praktyką jest wydzielenie osobnego zbioru testowego reprezentującego zdolność modelu do generalizacji na nowych, niewidzianych wcześniej danych i dobór najlepszego zestawu parametrów i transformacji stosując walidację krzyżową (ang. cross-validation) na zbiorze treningowym.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">UsedCars_df</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Następnie tworzymy obiekt klasy OrdinalEncoder, określamy tutaj porządek cechy atrybutów cechy, którą chcemy przetransformować, inaczej mogą one zostać po prostu posortowane alfabetycznie co najczęściej nie będzie odpowiadało ich znaczeniu biznesowemu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oe</span><span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span> <span class="o">=</span><span class="p">[[</span><span class="s1">&#39;very_bad&#39;</span><span class="p">,</span> <span class="s1">&#39;bad&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;good&#39;</span><span class="p">,</span> <span class="s1">&#39;very_good&#39;</span><span class="p">]],</span>
                   <span class="n">handle_unknown</span> <span class="o">=</span><span class="s1">&#39;use_encoded_value&#39;</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p>Kodując atrybuty należy mieć świadomość, że na nowych danych mogą pojawić się niewidziane wcześniej wartości, które należy w jakiś sposób obsłużyć. Domyślnym zachowaniem OrdinalEncoder w takiej sytuacji jest zwrócenie wyjątku, tutaj skorzystaliśmy z przypisania mu ustalonej wartości, gdzie wybraliśmy  przypisanie wartości pustej. Następnie taką wartość można zastąpić np. dominantą ze zbioru treningowego, lub przypisać jej wartość neutralną, którą tutaj byłoby 2 odpowiadające kategorii medium.</p>
</div><p>Zdecydowanie najlepszym sposobem użycia wszystkich transformerów jest skorzystanie z <b>pipeline</b>, co zostanie zaprezentowane potem. Tutaj zaprezentujemy najprostsze wykorzystanie polegające na skorzystaniu z metod <b>fit</b> i <b>transform</b>. OrdinalEncoder stosujemy tylko do przekształcenia jednej cechy, gdyby było inaczej moglibyśmy wykonać fit na całym zbiorze treningowym a następnie przetransformować zbiory treningowy i testowy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;condition_transformed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;condition_transformed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p>Jeśli nie korzystamy z pipeline należy zwrócić szczególną uwagę żeby metody fit używać tylko na zbiorze treningowym a następnie mając już “nauczony” transformer stosować metodę transform na pozostałych zbiorach. Inaczej może dojść do przecieku informacji ze zbioru testowego.</p>
</div><p>Możemy jeszcze sprawdzić czy przypisanie atrybutów na zbiorach treningowym i testowym jest prawidłowe, a następnie pozbyć się pierwotnej kolumny, wartości pierwotne mogą być łatwo odzyskane z przetransformowanych danych stosując metodę <b>inverse_transform</b>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;condition&quot;</span><span class="p">,</span><span class="s2">&quot;condition_transformed&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;condition_transformed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>condition</th>
      <th>condition_transformed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>211</th>
      <td>very_bad</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>357</th>
      <td>bad</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>916</th>
      <td>medium</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>789</th>
      <td>good</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>82</th>
      <td>very_good</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test</span><span class="p">[[</span><span class="s2">&quot;condition&quot;</span><span class="p">,</span><span class="s2">&quot;condition_transformed&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;condition_transformed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>condition</th>
      <th>condition_transformed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>328</th>
      <td>very_bad</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>740</th>
      <td>bad</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>521</th>
      <td>medium</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>411</th>
      <td>good</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>859</th>
      <td>very_good</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>selling_price</th>
      <th>mileage</th>
      <th>brand</th>
      <th>year_manufactured</th>
      <th>condition_transformed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>12139.0</td>
      <td>116901</td>
      <td>Renault</td>
      <td>2000</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>991</th>
      <td>10573.0</td>
      <td>457862</td>
      <td>Seat</td>
      <td>1972</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>789</th>
      <td>29760.0</td>
      <td>327051</td>
      <td>Audi</td>
      <td>1988</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>894</th>
      <td>9795.0</td>
      <td>204118</td>
      <td>Skoda</td>
      <td>1955</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>398</th>
      <td>10183.0</td>
      <td>261323</td>
      <td>Fiat</td>
      <td>1994</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>106</th>
      <td>28269.0</td>
      <td>443565</td>
      <td>Mercedes</td>
      <td>1963</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>270</th>
      <td>7058.0</td>
      <td>169384</td>
      <td>Skoda</td>
      <td>1988</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>860</th>
      <td>9161.0</td>
      <td>56590</td>
      <td>Renault</td>
      <td>1956</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>435</th>
      <td>49006.0</td>
      <td>479739</td>
      <td>Bugatti</td>
      <td>1973</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>102</th>
      <td>30353.0</td>
      <td>197530</td>
      <td>Audi</td>
      <td>1981</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
<p>750 rows × 5 columns</p>
</div></div></div>
</div>
<p>Widzimy, że do zakodowania pozostała nam jeszcze cecha - brand, w odróżnieniu od poprzednio rozważanej cechy tutaj nie ma oczywistego naturalnego porządku, dlatego należy tutaj zastosować inne podejście.</p>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>kodowania 1 z n</b> (ang. <em>One-hot encoding</em>) - reprezentacja każdego atrybutu kodowanej zmiennej jako osobnej zmiennej binarnej, gdzie występowanie rozważanego atrybutu dla danej obserwacji oznaczane jest jako 1, a wszystkie pozostałe atrybuty oznaczane są jako 0.</p>
</div><p>Kodowanie 1 z n stanowi jeden z najczęściej używanych i najbardziej intuicyjnych sposobów kodowania, jednak jego główną wadą jest zwiększanie wymiarowości danych, co zaraz zaprezentujemy.</p>
<p>Najpierw pokażemy jak posługiwać się transformerem OneHotEncoder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
</pre></div>
</div>
</div>
</div>
<p>Tworzymy obiekt klasy OneHotEncoder, podobnie jak w przypadku poprzedniego transformera, tu także domyślnym sposobem obsługi nieznanych atrybutów jest zwracanie wyjątku, my wybieramy handle_unknown=”ignore” co sprawi, że nieznane atrybuty reprezentowane będą po prostu jako 0 we wszystkich zakodowanych kolumnach.</p>
<p>Natomiast ustawienie sparse_output=False sprawia, że zwracane dane będą typu np.array zamiast domyślnego sparse matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Należy zwrócić uwagę, że we wszystkich transformerach z biblioteki sklearn stosowane jest to samo API, w związku z tym tutaj analogicznie jak w poprzednim przypadku możemy skorzystać z metod <b>fit</b> i <b>transform</b>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">brand</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">brand_transformed_train</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">brand</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">brand_transformed_test</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">brand</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rozmiar zakodowanej kolumny brand na danych treningowych to: </span><span class="si">{</span><span class="n">brand_transformed_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rozmiar zakodowanej kolumny brand na danych testowych to: </span><span class="si">{</span><span class="n">brand_transformed_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">brand_transformed_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rozmiar zakodowanej kolumny brand na danych treningowych to: (750, 10)
rozmiar zakodowanej kolumny brand na danych testowych to: (250, 10)
[[0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 [1. 0. 0. ... 0. 0. 0.]
 ...
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 1. ... 0. 0. 0.]
 [1. 0. 0. ... 0. 0. 0.]]
</pre></div>
</div>
</div>
</div>
<p>Jak widzimy kolumna brand reprezentowana jest teraz jako array gdzie każdy atrybut ze zbioru treningowego zaprezentowany jest w osobnej kolumnie binarnej. Można to sprawdzić zliczając liczbę unikalnych atrybutów tej kolumny na zbiorze treningowym.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">brand</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<p>Kolejność atrybutów odpowiadających kolumnom wynikowego arraya można zobaczyć korzystając z atrybutu categories_</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe</span><span class="o">.</span><span class="n">categories_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[array([&#39;Audi&#39;, &#39;BMW&#39;, &#39;Bugatti&#39;, &#39;Fiat&#39;, &#39;Mercedes&#39;, &#39;Renault&#39;, &#39;Seat&#39;,
        &#39;Skoda&#39;, &#39;Toyota&#39;, &#39;VW&#39;], dtype=object)]
</pre></div>
</div>
</div>
</div>
<p>Całą transformację wraz z dodaniem przetransformowanej zmiennej do zbioru treningowego można zrealizować za pomocą prostej funkcji.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OneHotEncode</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">encoded_column_name</span><span class="p">,</span> <span class="o">**</span><span class="n">encoder_kwargs</span><span class="p">):</span>
    
    <span class="n">ohe</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="o">**</span><span class="n">encoder_kwargs</span><span class="p">)</span>
    <span class="n">ohe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">encoded_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">transformed_train</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">encoded_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">transformed_test</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">encoded_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">encoded_column_name</span> <span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">category</span> <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ohe</span><span class="o">.</span><span class="n">categories_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">]</span>
    <span class="n">df_transformed_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transformed_train</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">column_names</span><span class="p">)</span>
    <span class="n">df_transformed_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transformed_test</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">column_names</span><span class="p">)</span>
    
    <span class="n">df_out_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">encoded_column_name</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_out_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">encoded_column_name</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_out_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_out_train</span><span class="p">,</span> <span class="n">df_transformed_train</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_out_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_out_test</span><span class="p">,</span> <span class="n">df_transformed_test</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df_out_train</span><span class="p">,</span> <span class="n">df_out_test</span>
</pre></div>
</div>
</div>
</div>
<p>Powyższa funkcja zwraca zbiór treningowy i testowy po dodaniu odpowiednio nazwanych kolumn powstałych po transformacji obiektem OneHotEncoder i usunięciu pierwotnej zmiennej. Argumenty do OneHotEncoder przekazywane są z pomocą  **encoder_kwargs</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_ohe</span><span class="p">,</span> <span class="n">X_test_ohe</span> <span class="o">=</span> <span class="n">OneHotEncode</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="s2">&quot;brand&quot;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">X_train_ohe</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>selling_price</th>
      <th>mileage</th>
      <th>year_manufactured</th>
      <th>condition_transformed</th>
      <th>brand_Audi</th>
      <th>brand_BMW</th>
      <th>brand_Bugatti</th>
      <th>brand_Fiat</th>
      <th>brand_Mercedes</th>
      <th>brand_Renault</th>
      <th>brand_Seat</th>
      <th>brand_Skoda</th>
      <th>brand_Toyota</th>
      <th>brand_VW</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12139.0</td>
      <td>116901</td>
      <td>2000</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10573.0</td>
      <td>457862</td>
      <td>1972</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>29760.0</td>
      <td>327051</td>
      <td>1988</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9795.0</td>
      <td>204118</td>
      <td>1955</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10183.0</td>
      <td>261323</td>
      <td>1994</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="alert alert-block alert-info">
<b>Info</b> 
<p>Alternatywnie zamiast OneHotEncoder można wykorzystać funkcję <b>get_dummies</b> z biblioteki pandas, która jest nieco prostsza w użyciu, jednak OneHotEncoder jest lepiej dostosowany do obsługi niewidzianych wartości, a ponadto znacznie łatwiej go zastosować w ramach pipeline.</p>
</div><p>Jak widzimy nawet przy tak niskiej liczbie atrybutów wymiarowość naszych danych znacznie wzrosła. W prawdziwych zastosowaniach możemy się spotkać ze zbiorami danych mającymi wiele zmiennych kategorycznych o dziesiątkach lub setkach unikalnych atrybutów, więc metodę OneHotEncoder zaleca się stosować tylko tam, gdzie atrybuty są niezbyt liczne, w pozostałych sytuacjach lepiej skorzystać z <b>kodowania zmienną celu</b></p>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>kodowanie zmienną celu</b> (ang. <em>Target encoding</em>) - reprezentacja każdego atrybutu kodowanej zmiennej jako estymata średniej wartości zmiennej celu na danych treningowych.</p>
<p>Kodowanie zmienną celu stanowi jedną z najbardziej uniwersalnych metod kodowania zmiennych kategorycznych, nie wymaga naturalnego porządku w danych jak kodowanie porządkowe i nie zwiększa wymiarowości danych jak kodowanie 1 z n.</p>
<p>Istnieje wiele różnych sposobów kodowania zmiennej celu, my tutaj posłużymy się metodą James-Stein Encoder dostępną w bibliotece category_encoders.</p>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p>Formuła na zakodowaną wartość k-tego atrybutu kodowanej zmiennej:
$<span class="math notranslate nohighlight">\(
X_{k} = (1-B) *Avg(Y_{k}) +B*Avg(Y)
\)</span>$</p>
<p>gdzie:</p>
<p><span class="math notranslate nohighlight">\(X_{k}\)</span> - wartość przypisana k-temu atrybutowi kodowanej zmiennej kategorycznej</p>
<p><span class="math notranslate nohighlight">\(Avg(Y_{k})\)</span> - średnia wartości zmiennej celu dla k-tego atrybutu zmiennej kategorycznej</p>
<p><span class="math notranslate nohighlight">\(Avg(Y)\)</span> - globalna średnia zmiennej celu na zbiorze treningowym</p>
<p><span class="math notranslate nohighlight">\(B\)</span> -waga globalnej średniej, wyliczona według formuły:
$<span class="math notranslate nohighlight">\(
B = \frac{Var(Y_{k})}{Var(Y) + Var(Y_{k})}
\)</span>$
gdzie:</p>
<p><span class="math notranslate nohighlight">\(Var(Y_{k})\)</span> - wariancja zmiennej celu dla k-tego atrybutu zmiennej kategorycznej</p>
<p><span class="math notranslate nohighlight">\(Var(Y)\)</span> - wariancja zmiennej celu dla całego zbioru treningowego</p>
<p>Importujemy potrzebną klasę.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">category_encoders.james_stein</span> <span class="kn">import</span> <span class="n">JamesSteinEncoder</span>
</pre></div>
</div>
</div>
</div>
<p>Tworzymy obiekt klasy JamesSteinEncoder, wybierając kolumnę brand do przekształcenia. Domyślnie przekształcone zostaną wszystkie kolumny kategoryczne.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jse</span> <span class="o">=</span> <span class="n">JamesSteinEncoder</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Tak jak w transformerach z biblioteki sklearn także tutaj posługujemy się metodami <b>fit</b> i <b>transform</b>, jednak jako, że jest to kodowanie zmienną celu niezbędne jest jej podanie do metody fit, dlatego najpierw wydzielimy zmienną celu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">selling_price</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">selling_price</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;selling_price&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;selling_price&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jse</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">X_train_jse</span> <span class="o">=</span> <span class="n">jse</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_jse</span> <span class="o">=</span> <span class="n">jse</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">X_train_jse</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>brand</th>
      <th>year_manufactured</th>
      <th>condition_transformed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>116901</td>
      <td>10147.714654</td>
      <td>2000</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>991</th>
      <td>457862</td>
      <td>9743.130539</td>
      <td>1972</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>789</th>
      <td>327051</td>
      <td>29529.917436</td>
      <td>1988</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>894</th>
      <td>204118</td>
      <td>10014.361025</td>
      <td>1955</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>398</th>
      <td>261323</td>
      <td>9857.124555</td>
      <td>1994</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Jak widzimy zmienna brand została teraz zastąpiona estymatami średniej wartości zmiennej celu w zależności od brandu.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="laczenie-atrybutow-cech-kategorycznych">
<h1>Łączenie atrybutów cech kategorycznych<a class="headerlink" href="#laczenie-atrybutow-cech-kategorycznych" title="Permalink to this heading">#</a></h1>
<p>Oprócz standardowych metod transformacji zmiennych kategorycznych opisanych w poprzedniej sekcji można też stosować różne przekształcenia polegające na łączeniu pierwotnych atrybutów w podgrupy. Takie łączenie może być oparte na podobieństwie atrybutów pod katęm statystycznym np. zbliżony poziom średniej wartości zmiennej celu lub, co bardziej zalecane - na wiedzy domenowej.</p>
<p>Tutaj zaprezentujemy prosty przykład łączenia atrybutów oparty na wiedzy domenowej - załóżmy, że znamy podział wszystkich marek samochodów ze zmiennej brand na 3 relatywnie jednolite podgrupy - marki podstawowe, marki premium i marki luksusowe. Na tej podstawie stworzymy nową zmienną korzystając z prostej funkcji:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">brand_binning</span><span class="p">(</span><span class="n">brand</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span><span class="s2">&quot;standard&quot;</span>
    <span class="n">standard_brands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Fiat&quot;</span><span class="p">,</span><span class="s2">&quot;Renault&quot;</span><span class="p">,</span><span class="s2">&quot;VW&quot;</span><span class="p">,</span> <span class="s2">&quot;Seat&quot;</span><span class="p">,</span> <span class="s2">&quot;Skoda&quot;</span><span class="p">,</span><span class="s2">&quot;Toyota&quot;</span><span class="p">]</span>
    <span class="n">premium_brands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Audi&quot;</span><span class="p">,</span><span class="s2">&quot;BMW&quot;</span><span class="p">,</span><span class="s2">&quot;Mercedes&quot;</span><span class="p">]</span>
    <span class="n">luxury_brands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Bugatti&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">brand</span> <span class="ow">in</span> <span class="n">luxury_brands</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;luxury&quot;</span>
    <span class="k">elif</span> <span class="n">brand</span> <span class="ow">in</span> <span class="n">premium_brands</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;premium&quot;</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;brand_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">brand_binning</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;brand_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">brand_binning</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>brand</th>
      <th>year_manufactured</th>
      <th>condition_transformed</th>
      <th>brand_binned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>116901</td>
      <td>Renault</td>
      <td>2000</td>
      <td>4.0</td>
      <td>standard</td>
    </tr>
    <tr>
      <th>991</th>
      <td>457862</td>
      <td>Seat</td>
      <td>1972</td>
      <td>4.0</td>
      <td>standard</td>
    </tr>
    <tr>
      <th>789</th>
      <td>327051</td>
      <td>Audi</td>
      <td>1988</td>
      <td>3.0</td>
      <td>premium</td>
    </tr>
    <tr>
      <th>894</th>
      <td>204118</td>
      <td>Skoda</td>
      <td>1955</td>
      <td>3.0</td>
      <td>standard</td>
    </tr>
    <tr>
      <th>398</th>
      <td>261323</td>
      <td>Fiat</td>
      <td>1994</td>
      <td>3.0</td>
      <td>standard</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Możemy też sprawdzić jak wygląda unikalne przypisanie pomiędzy pierwotną, a zgrupowaną zmienną:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;brand&quot;</span><span class="p">,</span><span class="s2">&quot;brand_binned&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;brand_binned&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>brand</th>
      <th>brand_binned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>Bugatti</td>
      <td>luxury</td>
    </tr>
    <tr>
      <th>789</th>
      <td>Audi</td>
      <td>premium</td>
    </tr>
    <tr>
      <th>323</th>
      <td>Mercedes</td>
      <td>premium</td>
    </tr>
    <tr>
      <th>266</th>
      <td>BMW</td>
      <td>premium</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Renault</td>
      <td>standard</td>
    </tr>
    <tr>
      <th>991</th>
      <td>Seat</td>
      <td>standard</td>
    </tr>
    <tr>
      <th>894</th>
      <td>Skoda</td>
      <td>standard</td>
    </tr>
    <tr>
      <th>398</th>
      <td>Fiat</td>
      <td>standard</td>
    </tr>
    <tr>
      <th>916</th>
      <td>Toyota</td>
      <td>standard</td>
    </tr>
    <tr>
      <th>731</th>
      <td>VW</td>
      <td>standard</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>jak widzimy przypisanie zostało przeprowadzone poprawnie, nowa zmienna niesie mniej informacji niż zmienna pierwotna, dlatego zastąpienie nią pierwotnej zmiennej może być pomocne jeśli mamy problem z przeuczeniem modelu. Oczywiście tak powstałą zmienną należy potem jeszcze przetransformować zgodnie z wytycznymi z poprzedniej sekcji.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cechy-oparte-na-wiedzy-domenowej-oraz-cechy-interakcji">
<h1>Cechy oparte na wiedzy domenowej oraz cechy interakcji<a class="headerlink" href="#cechy-oparte-na-wiedzy-domenowej-oraz-cechy-interakcji" title="Permalink to this heading">#</a></h1>
<p>Zaprezentowane powyżej grupowanie marek polegało na przekształceniu zmiennej kategorycznej w oparciu o wiedzę domenową. Tutaj pokażemy przykłady zastosowania wiedzy domenowej na zmiennych numerycznych i interakcji cech numerycznych i katgorycznych.</p>
<p>Przykładem prostej cechy opartej na wiedzy domenowej może być wiek samochodu w momencie sprzedaży. Nie mamy tutaj informacji o dacie transakcji, dlatego można dla ułatwienia założyć, że wszystkie transakcje odbyły się w bieżącym roku.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2021</span> <span class="o">-</span> <span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;year_manufactured&quot;</span><span class="p">]</span>
<span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2021</span> <span class="o">-</span> <span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;year_manufactured&quot;</span><span class="p">]</span>
<span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>brand</th>
      <th>year_manufactured</th>
      <th>condition_transformed</th>
      <th>brand_binned</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>116901</td>
      <td>Renault</td>
      <td>2000</td>
      <td>4.0</td>
      <td>standard</td>
      <td>21</td>
    </tr>
    <tr>
      <th>991</th>
      <td>457862</td>
      <td>Seat</td>
      <td>1972</td>
      <td>4.0</td>
      <td>standard</td>
      <td>49</td>
    </tr>
    <tr>
      <th>789</th>
      <td>327051</td>
      <td>Audi</td>
      <td>1988</td>
      <td>3.0</td>
      <td>premium</td>
      <td>33</td>
    </tr>
    <tr>
      <th>894</th>
      <td>204118</td>
      <td>Skoda</td>
      <td>1955</td>
      <td>3.0</td>
      <td>standard</td>
      <td>66</td>
    </tr>
    <tr>
      <th>398</th>
      <td>261323</td>
      <td>Fiat</td>
      <td>1994</td>
      <td>3.0</td>
      <td>standard</td>
      <td>27</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>106</th>
      <td>443565</td>
      <td>Mercedes</td>
      <td>1963</td>
      <td>3.0</td>
      <td>premium</td>
      <td>58</td>
    </tr>
    <tr>
      <th>270</th>
      <td>169384</td>
      <td>Skoda</td>
      <td>1988</td>
      <td>1.0</td>
      <td>standard</td>
      <td>33</td>
    </tr>
    <tr>
      <th>860</th>
      <td>56590</td>
      <td>Renault</td>
      <td>1956</td>
      <td>2.0</td>
      <td>standard</td>
      <td>65</td>
    </tr>
    <tr>
      <th>435</th>
      <td>479739</td>
      <td>Bugatti</td>
      <td>1973</td>
      <td>2.0</td>
      <td>luxury</td>
      <td>48</td>
    </tr>
    <tr>
      <th>102</th>
      <td>197530</td>
      <td>Audi</td>
      <td>1981</td>
      <td>3.0</td>
      <td>premium</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
<p>750 rows × 6 columns</p>
</div></div></div>
</div>
<p>Zmienne interakcji można wygenerować stosując np. iloczyny poszczególnych zmiennych numerycznych, tutaj wydaje się to nie być najlepszy pomysł, ponieważ intuicyjnie czujemy, że np mnożenie przebiegu * rok produkcji nie będzie zbyt dobrą cechą predykcyjną. Można natomiast wyliczyć np. średni roczny przebieg dzieląc przebieg przez dodany powyżej wiek samochodu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;avg_yearly_mileage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;avg_yearly_mileage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;mileage&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>brand</th>
      <th>year_manufactured</th>
      <th>condition_transformed</th>
      <th>brand_binned</th>
      <th>age</th>
      <th>avg_yearly_mileage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>116901</td>
      <td>Renault</td>
      <td>2000</td>
      <td>4.0</td>
      <td>standard</td>
      <td>21</td>
      <td>5567.0</td>
    </tr>
    <tr>
      <th>991</th>
      <td>457862</td>
      <td>Seat</td>
      <td>1972</td>
      <td>4.0</td>
      <td>standard</td>
      <td>49</td>
      <td>9344.0</td>
    </tr>
    <tr>
      <th>789</th>
      <td>327051</td>
      <td>Audi</td>
      <td>1988</td>
      <td>3.0</td>
      <td>premium</td>
      <td>33</td>
      <td>9911.0</td>
    </tr>
    <tr>
      <th>894</th>
      <td>204118</td>
      <td>Skoda</td>
      <td>1955</td>
      <td>3.0</td>
      <td>standard</td>
      <td>66</td>
      <td>3093.0</td>
    </tr>
    <tr>
      <th>398</th>
      <td>261323</td>
      <td>Fiat</td>
      <td>1994</td>
      <td>3.0</td>
      <td>standard</td>
      <td>27</td>
      <td>9679.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>106</th>
      <td>443565</td>
      <td>Mercedes</td>
      <td>1963</td>
      <td>3.0</td>
      <td>premium</td>
      <td>58</td>
      <td>7648.0</td>
    </tr>
    <tr>
      <th>270</th>
      <td>169384</td>
      <td>Skoda</td>
      <td>1988</td>
      <td>1.0</td>
      <td>standard</td>
      <td>33</td>
      <td>5133.0</td>
    </tr>
    <tr>
      <th>860</th>
      <td>56590</td>
      <td>Renault</td>
      <td>1956</td>
      <td>2.0</td>
      <td>standard</td>
      <td>65</td>
      <td>871.0</td>
    </tr>
    <tr>
      <th>435</th>
      <td>479739</td>
      <td>Bugatti</td>
      <td>1973</td>
      <td>2.0</td>
      <td>luxury</td>
      <td>48</td>
      <td>9995.0</td>
    </tr>
    <tr>
      <th>102</th>
      <td>197530</td>
      <td>Audi</td>
      <td>1981</td>
      <td>3.0</td>
      <td>premium</td>
      <td>40</td>
      <td>4938.0</td>
    </tr>
  </tbody>
</table>
<p>750 rows × 7 columns</p>
</div></div></div>
</div>
<p>Innym przykładem zmiennej opartej stricte na wiedzy domenowej łączącej ze sobą informacje ze zmiennych numerycznych i kategorycznych mogła by być informacja o klasycznych modelach. Załóżmy, że modele luksusowych marek wyprodukowane przed 1970 rokiem są modelami klasycznymi i jeśli ich stan jest co najmniej dobry to ich cena jest znacznie wyższa niż by to wynikało z wieku auta, gdzie normalnie spodziewamy się ujemnej relacji z ceną sprzedaży.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">X_train</span><span class="o">.</span><span class="n">brand_binned</span><span class="o">==</span><span class="s2">&quot;luxury&quot;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">year_manufactured</span><span class="o">&lt;=</span><span class="mi">1970</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">condition_transformed</span><span class="o">&gt;</span><span class="mf">2.0</span><span class="p">),</span><span class="s2">&quot;is_classic&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;is_classic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;is_classic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">X_test</span><span class="o">.</span><span class="n">brand_binned</span><span class="o">==</span><span class="s2">&quot;luxury&quot;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">year_manufactured</span><span class="o">&lt;=</span><span class="mi">1970</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">condition_transformed</span><span class="o">&gt;</span><span class="mf">2.0</span><span class="p">),</span><span class="s2">&quot;is_classic&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;is_classic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;is_classic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;is_classic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>is_classic
0.0    737
1.0     13
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Takie przypadki są stosunkowo rzadkie, ale tego typu zmienna może pomóc w dokładniejszym przewidzeniu tych obserwacji.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cechy-oparte-na-transformacji-zmiennych-numerycznych">
<h1>Cechy oparte na transformacji zmiennych numerycznych<a class="headerlink" href="#cechy-oparte-na-transformacji-zmiennych-numerycznych" title="Permalink to this heading">#</a></h1>
<p>Dość powszechnie spotykaną praktyką jest stosowanie nieliniowych transformacji zmiennych numerycznych, co zazwyczaj sprzyja uzyskaniu lepszej jakości predykcji ze względu na fakt, że modele najlepiej radzą sobie gdy rozkłady zmiennych są zbliżone do rozkładu normalnego.</p>
<p>Często spotykaną jest po prostu logarytmowanie zmiennych numerycznych, tutaj natomiast posłużymy się gotowym transformerem z biblioteki sklearn, a mianowicie <b>PowerTransformer</b></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PowerTransformer</span>
</pre></div>
</div>
</div>
</div>
<p>Zanim dokonamy transformacji sprawdźmy jak wyglądają rozkłady zmiennych numerycznych, ograniczymy się tutaj do przebiegu, wieku i średniego przebiegu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mileage&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="s2">&quot;avg_yearly_mileage&quot;</span><span class="p">]</span>
<span class="n">X_train</span><span class="p">[</span><span class="n">num_columns</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[&lt;Axes: title={&#39;center&#39;: &#39;mileage&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;age&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;avg_yearly_mileage&#39;}&gt;, &lt;Axes: &gt;]],
      dtype=object)
</pre></div>
</div>
<img alt="../_images/46f6c7742eded858bda9320ed45cd573cdd3f818e32fbda3b95cb39382f845ec.png" src="../_images/46f6c7742eded858bda9320ed45cd573cdd3f818e32fbda3b95cb39382f845ec.png" />
</div>
</div>
<p>Można tu zaobserwować, że rozkład przebiegu jest silnie skośny, pozostałe 2 zmienne mają rozkład zbliżony do jednostajnego.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pt</span><span class="o">=</span><span class="n">PowerTransformer</span><span class="p">(</span><span class="n">standardize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Tworzymy obiekt klasy PowerTransformer, korzystamy tutaj z domyślnej transformacji Yeo-Johnson, zmieniamy natomiast ustawienie o sprowadzeniu do rozkładu o średniej równej 0 i odchyleniu standardowym równym 1, które domyślnie jest ustawione na True.</p>
<div class="alert alert-block alert-info">
<b>Info</b> 
<p>Domyślna transformacja czyli metoda Yeo-Johnsona może być stosowana niezależnie od znaku transformowanych zmiennych, natomiast alternatywna transformacja Box-Cox wymaga ściśle dodatnich zmiennych na wejściu.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">num_columns</span><span class="p">])</span>
<span class="n">X_train_num_transformed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">num_columns</span><span class="p">]),</span> <span class="n">columns</span> <span class="o">=</span><span class="n">num_columns</span><span class="p">)</span>
<span class="n">X_test_num_transformed</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">num_columns</span><span class="p">]),</span> <span class="n">columns</span> <span class="o">=</span><span class="n">num_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Analogicznie jak przy poprzednio stosowanych transformerach korzystamy tutaj z metod fit i transform, a następnie konwertujemy wynik na ramkę danych.</p>
<p>Przeanalizujmy jak mocno zmieniły się rozkłady poszczególnych zmiennych:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_num_transformed</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[&lt;Axes: title={&#39;center&#39;: &#39;mileage&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;age&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;avg_yearly_mileage&#39;}&gt;, &lt;Axes: &gt;]],
      dtype=object)
</pre></div>
</div>
<img alt="../_images/fdaf20813cb503fbae248e4d4b4a42f0dc6359d620070eb770d3bb73b19331c9.png" src="../_images/fdaf20813cb503fbae248e4d4b4a42f0dc6359d620070eb770d3bb73b19331c9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test_num_transformed</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[&lt;Axes: title={&#39;center&#39;: &#39;mileage&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;age&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;avg_yearly_mileage&#39;}&gt;, &lt;Axes: &gt;]],
      dtype=object)
</pre></div>
</div>
<img alt="../_images/dc55836721826f795411606e31200397774db9c9149d24c1e55bb52450bcc14e.png" src="../_images/dc55836721826f795411606e31200397774db9c9149d24c1e55bb52450bcc14e.png" />
</div>
</div>
<p>Zmienna mileage na zbiorze treningowym z silnie skośnej nabrała cech rozkładu normalnego, pozostałe przypadki nie wyglądają jednak na rozkład normalny.</p>
<p>Wypróbujmy inny sposób modyfikacji rozkładu - <b>QuantileTransformer</b></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">QuantileTransformer</span>
</pre></div>
</div>
</div>
</div>
<p>tworzymy obiekt klasy QuantileTransformer, zamiast bazowego rozkładu jednostajnego wybierając rozkład normalny</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qt</span> <span class="o">=</span> <span class="n">QuantileTransformer</span><span class="p">(</span><span class="n">n_quantiles</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">output_distribution</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">num_columns</span><span class="p">])</span>
<span class="n">X_train_num_transformed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">num_columns</span><span class="p">]),</span> <span class="n">columns</span> <span class="o">=</span><span class="n">num_columns</span><span class="p">)</span>
<span class="n">X_test_num_transformed</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">num_columns</span><span class="p">]),</span> <span class="n">columns</span> <span class="o">=</span><span class="n">num_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_num_transformed</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[&lt;Axes: title={&#39;center&#39;: &#39;mileage&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;age&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;avg_yearly_mileage&#39;}&gt;, &lt;Axes: &gt;]],
      dtype=object)
</pre></div>
</div>
<img alt="../_images/d50c91c7fe2d5e2aea39b33395e982416f0050e03bf800aeff18dcaf7747a82a.png" src="../_images/d50c91c7fe2d5e2aea39b33395e982416f0050e03bf800aeff18dcaf7747a82a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test_num_transformed</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[&lt;Axes: title={&#39;center&#39;: &#39;mileage&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;age&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;avg_yearly_mileage&#39;}&gt;, &lt;Axes: &gt;]],
      dtype=object)
</pre></div>
</div>
<img alt="../_images/7ea93e43a96e988c420ee9e4a702e118aa47fe00e8961d5517855705d4bd4695.png" src="../_images/7ea93e43a96e988c420ee9e4a702e118aa47fe00e8961d5517855705d4bd4695.png" />
</div>
</div>
<p>Jak widzimy rozkłady są teraz zupełnie inne, na zbiorze treningowym bardzo zbliżone do rozkładu normalnego, jednak na zbiorze testowym juz dość znacznie się różnią, co może wynikać po części z niewielkiego rozmiaru próby.</p>
<div class="alert alert-block alert-info">
<b>Info</b> 
<p>To jaki dokładnie zestaw transformacji ostatecznie wybrać powinno wynikać przede wszystkim z obserwacji ustalonej wcześniej metryki jakości modelu.</p>
</div></section>
<section class="tex2jax_ignore mathjax_ignore" id="laczenie-zmiennych-numerycznych-w-przedzialy">
<h1>Łączenie zmiennych numerycznych w przedziały<a class="headerlink" href="#laczenie-zmiennych-numerycznych-w-przedzialy" title="Permalink to this heading">#</a></h1>
<p>Podobnie jak w przypadku zmiennych kategorycznych, zmienne numeryczne również można przekształcać grupując razem pewne ich wartości. Proces taki nazywamy <b>kubełkowaniem</b>.</p>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>Kubełkowanie</b> (ang. <em>binning</em>) polega na łączeniu wartości zmiennych numerycznych w przedziały, ma to na celu zmniejszenie możliwości przeuczenia modelu.</p>
</div><p>Wybór takich przedziałów może występować zarówno na podstawie cech rozkładu zmiennych (np wartości kwartyli) jak i wiedzy domenowej, tutaj zaprezentujemy obie możliwości.</p>
<p>Do podziału wg statystyk pozycyjnych z rozkładu wykorzystamy funkcję <b>qcut</b> z biblioteki pandas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage_binned_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage&quot;</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage_binned_10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage&quot;</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;mileage&quot;</span><span class="p">,</span><span class="s2">&quot;mileage_binned_4&quot;</span><span class="p">,</span><span class="s2">&quot;mileage_binned_10&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>mileage_binned_4</th>
      <th>mileage_binned_10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>116901</td>
      <td>(63834.75, 148699.5]</td>
      <td>(112892.6, 148699.5]</td>
    </tr>
    <tr>
      <th>991</th>
      <td>457862</td>
      <td>(284548.5, 691615.0]</td>
      <td>(430863.6, 691615.0]</td>
    </tr>
    <tr>
      <th>789</th>
      <td>327051</td>
      <td>(284548.5, 691615.0]</td>
      <td>(324864.4, 430863.6]</td>
    </tr>
    <tr>
      <th>894</th>
      <td>204118</td>
      <td>(148699.5, 284548.5]</td>
      <td>(196476.6, 243348.0]</td>
    </tr>
    <tr>
      <th>398</th>
      <td>261323</td>
      <td>(148699.5, 284548.5]</td>
      <td>(243348.0, 324864.4]</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>106</th>
      <td>443565</td>
      <td>(284548.5, 691615.0]</td>
      <td>(430863.6, 691615.0]</td>
    </tr>
    <tr>
      <th>270</th>
      <td>169384</td>
      <td>(148699.5, 284548.5]</td>
      <td>(148699.5, 196476.6]</td>
    </tr>
    <tr>
      <th>860</th>
      <td>56590</td>
      <td>(4628.999, 63834.75]</td>
      <td>(52066.6, 77633.8]</td>
    </tr>
    <tr>
      <th>435</th>
      <td>479739</td>
      <td>(284548.5, 691615.0]</td>
      <td>(430863.6, 691615.0]</td>
    </tr>
    <tr>
      <th>102</th>
      <td>197530</td>
      <td>(148699.5, 284548.5]</td>
      <td>(196476.6, 243348.0]</td>
    </tr>
  </tbody>
</table>
<p>750 rows × 3 columns</p>
</div></div></div>
</div>
<p>Stworzyliśmy tutaj 2 nowe cechy na zbiorze treningowym w oparciu o kwartyle i decyle rozkładu zmiennej mileage. Jak widzimy poszczególnym wartościom przypisane zostały wartości przedziałów do których one wpadają w danym podziale na kubełki.</p>
<p>Jeśli chcemy samodzielnie określić etykiety przedziałów można posłużyć się parametrem labels</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage_binned_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage&quot;</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage_binned_10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage&quot;</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">))</span>
<span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;mileage&quot;</span><span class="p">,</span><span class="s2">&quot;mileage_binned_4&quot;</span><span class="p">,</span><span class="s2">&quot;mileage_binned_10&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>mileage_binned_4</th>
      <th>mileage_binned_10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>116901</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <th>991</th>
      <td>457862</td>
      <td>4</td>
      <td>10</td>
    </tr>
    <tr>
      <th>789</th>
      <td>327051</td>
      <td>4</td>
      <td>9</td>
    </tr>
    <tr>
      <th>894</th>
      <td>204118</td>
      <td>3</td>
      <td>7</td>
    </tr>
    <tr>
      <th>398</th>
      <td>261323</td>
      <td>3</td>
      <td>8</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>106</th>
      <td>443565</td>
      <td>4</td>
      <td>10</td>
    </tr>
    <tr>
      <th>270</th>
      <td>169384</td>
      <td>3</td>
      <td>6</td>
    </tr>
    <tr>
      <th>860</th>
      <td>56590</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>435</th>
      <td>479739</td>
      <td>4</td>
      <td>10</td>
    </tr>
    <tr>
      <th>102</th>
      <td>197530</td>
      <td>3</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
<p>750 rows × 3 columns</p>
</div></div></div>
</div>
<div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p>Wszystkie przekształcenia wykorzystujące informacje o rozkładach cech należy implementować najpierw na zbiorze treningowym, a następnie w oparciu o rozkład ze zbioru treningowego - na zbiorze testowym. Inaczej wykorzystujemy informacje ze zbioru testowego i przestaje on być niezależny.</p>
</div><p>Tutaj możemy skorzystać z parametru <b>retbins</b> i dostać granice kubełków, a następnie w oparciu o te granice dokonać identycznego podziału na zbiorze testowym.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;mileage&quot;</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bins</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  4629.  ,  63834.75, 148699.5 , 284548.5 , 691615.  ])
</pre></div>
</div>
</div>
</div>
<p>Alternatywnym podejściem jest użycie funkcji <b>cut</b> z biblioteki pandas, która pozwala podzielić wartości zmiennej na zdefiniowaną liczbę przedziałów o identycznej szerokości lub przypisać je do zdefiniowanych samodzielnie przedziałów.</p>
<p>Załóżmy, że jeśli chodzi o wiek samochodu znaczenie mają przedziały do 3 lat, od 3 do 7, od 7 do 12, 12-25 oraz ponad 25. Możemy łatwo dokonać takiego przypisania przydzielając poszczególnym kubełkom odpowiednie nazwy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;age_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">,</span><span class="s2">&quot;middle_age&quot;</span><span class="p">,</span><span class="s2">&quot;old&quot;</span><span class="p">,</span><span class="s2">&quot;very_old&quot;</span><span class="p">,</span><span class="s2">&quot;extremely_old&quot;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="s2">&quot;age_binned&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>age_binned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>21</td>
      <td>very_old</td>
    </tr>
    <tr>
      <th>991</th>
      <td>49</td>
      <td>extremely_old</td>
    </tr>
    <tr>
      <th>789</th>
      <td>33</td>
      <td>extremely_old</td>
    </tr>
    <tr>
      <th>894</th>
      <td>66</td>
      <td>extremely_old</td>
    </tr>
    <tr>
      <th>398</th>
      <td>27</td>
      <td>extremely_old</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>106</th>
      <td>58</td>
      <td>extremely_old</td>
    </tr>
    <tr>
      <th>270</th>
      <td>33</td>
      <td>extremely_old</td>
    </tr>
    <tr>
      <th>860</th>
      <td>65</td>
      <td>extremely_old</td>
    </tr>
    <tr>
      <th>435</th>
      <td>48</td>
      <td>extremely_old</td>
    </tr>
    <tr>
      <th>102</th>
      <td>40</td>
      <td>extremely_old</td>
    </tr>
  </tbody>
</table>
<p>750 rows × 2 columns</p>
</div></div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="normalizacja-i-standaryzacja">
<h1>Normalizacja i Standaryzacja<a class="headerlink" href="#normalizacja-i-standaryzacja" title="Permalink to this heading">#</a></h1>
<p>Załóżmy, że finalnie mamy zbiór danych złożony stricte ze zmiennych numerycznych:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s2">&quot;mileage&quot;</span><span class="p">,</span><span class="s2">&quot;condition_transformed&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="s2">&quot;avg_yearly_mileage&quot;</span><span class="p">,</span><span class="s2">&quot;is_classic&quot;</span><span class="p">]]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s2">&quot;mileage&quot;</span><span class="p">,</span><span class="s2">&quot;condition_transformed&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="s2">&quot;avg_yearly_mileage&quot;</span><span class="p">,</span><span class="s2">&quot;is_classic&quot;</span><span class="p">]]</span>
<span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>condition_transformed</th>
      <th>age</th>
      <th>avg_yearly_mileage</th>
      <th>is_classic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>116901</td>
      <td>4.0</td>
      <td>21</td>
      <td>5567.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>991</th>
      <td>457862</td>
      <td>4.0</td>
      <td>49</td>
      <td>9344.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>789</th>
      <td>327051</td>
      <td>3.0</td>
      <td>33</td>
      <td>9911.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>894</th>
      <td>204118</td>
      <td>3.0</td>
      <td>66</td>
      <td>3093.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>398</th>
      <td>261323</td>
      <td>3.0</td>
      <td>27</td>
      <td>9679.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>106</th>
      <td>443565</td>
      <td>3.0</td>
      <td>58</td>
      <td>7648.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>270</th>
      <td>169384</td>
      <td>1.0</td>
      <td>33</td>
      <td>5133.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>860</th>
      <td>56590</td>
      <td>2.0</td>
      <td>65</td>
      <td>871.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>435</th>
      <td>479739</td>
      <td>2.0</td>
      <td>48</td>
      <td>9995.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>102</th>
      <td>197530</td>
      <td>3.0</td>
      <td>40</td>
      <td>4938.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>750 rows × 5 columns</p>
</div></div></div>
</div>
<p>Możemy łatwo zaobserwować, że zmienne znacznie różnią się pod względem średniej czy wariancji:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>condition_transformed</th>
      <th>age</th>
      <th>avg_yearly_mileage</th>
      <th>is_classic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>750.00</td>
      <td>750.00</td>
      <td>750.00</td>
      <td>750.00</td>
      <td>750.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>190640.68</td>
      <td>2.49</td>
      <td>36.77</td>
      <td>5284.90</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>std</th>
      <td>154973.63</td>
      <td>1.10</td>
      <td>19.44</td>
      <td>2881.19</td>
      <td>0.13</td>
    </tr>
    <tr>
      <th>min</th>
      <td>4629.00</td>
      <td>0.00</td>
      <td>2.00</td>
      <td>171.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>63834.75</td>
      <td>2.00</td>
      <td>21.00</td>
      <td>2932.75</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>148699.50</td>
      <td>3.00</td>
      <td>37.00</td>
      <td>5156.50</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>284548.50</td>
      <td>3.00</td>
      <td>53.00</td>
      <td>7696.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>max</th>
      <td>691615.00</td>
      <td>4.00</td>
      <td>71.00</td>
      <td>11827.00</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Niektóre metody modelowania są zależne od odległości bądź wariancji zmiennych, więc chcąc aby wpływ danej zmiennej na predykcje wynikał przede wszystkim z jej związku ze zmienną celu, a nie ze skali, powinniśmy zastosować <b>normalizację</b> lub <b>standaryzację</b></p>
<p>zacznijmy od normalizacji, zrealizujemy ją za pomocą kolejnego transformera z biblioteki sklearn: MinMaxScaler</p>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>Normalizacja</b> polega na przekształcaniu zmiennej do zakresu wartości &lt;0,1&gt; poprzez odjęcie minumum i podzielenie przez różnicę pomiędzy maksimum, a minimum z rozkładu.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
</pre></div>
</div>
</div>
</div>
<p>Tworzymy obiekt klasy MinMaxScaler korzystając z bazowych ustawień, możliwa jest zmiana docelowego zakresu wartości z bazowego &lt;0,1&gt; na dowolnie wybrany poprzez użycie parametru <b>feature_range</b></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Metody są oczywiście analogiczne jak w poprzednich przypadkach, konwertujemy wyniki z powrotem na ramki danych aby łatwiej było je oglądać.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_mm_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_mm_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">X_train_mm_scaled</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>condition_transformed</th>
      <th>age</th>
      <th>avg_yearly_mileage</th>
      <th>is_classic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>750.00</td>
      <td>750.00</td>
      <td>750.00</td>
      <td>750.00</td>
      <td>750.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.27</td>
      <td>0.62</td>
      <td>0.50</td>
      <td>0.44</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.23</td>
      <td>0.27</td>
      <td>0.28</td>
      <td>0.25</td>
      <td>0.13</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.09</td>
      <td>0.50</td>
      <td>0.28</td>
      <td>0.24</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.21</td>
      <td>0.75</td>
      <td>0.51</td>
      <td>0.43</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.41</td>
      <td>0.75</td>
      <td>0.74</td>
      <td>0.65</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Jak widzimy wszystkie cechy zostały teraz przeniesione do tego samego zakresu wartości &lt;0,1&gt;, ale ich średnia i odchylenie standardowe nie są identyczne. Oczywiście nie mamy gwarancji, że na nowych danych nie pojawią się wartości spoza wykresu widzianego na zbiorze treningowym. Jeśli chcemy być pewni, że znormalizowane zmienne zachowają swój zakres wartości należy tworząc obiekt klasy MinMaxScaler ustawić parametr <b>clip</b> na True.</p>
<div class="alert alert-block alert-danger">
<b>Uwaga!</b> 
<p>Nie zaleca się korzystania z MinMaxScaler dla zmiennych posiadających <b>wartości odstające</b>. Jeśli takie wartości nie zostaną wcześniej prawidłowo obsłużone, to większość “normalnych” wartości zmiennej będzie “upchana” w małym zakresie wartości co nie będzie sprzyjać jej wartości dla predykcji.</p>
</div><p>Zaprezentujemy teraz przykład standaryzacji z wykorzystaniem transformera StandardScaler z biblioteki sklearn.</p>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>Standaryzacja</b> polega na przekształcaniu zmiennej do rozkładu o wartości oczekiwanej 0 i odchyleniu standardowym 1 poprzez odjęcie średniej i podzielenie przez odchylenie standardowe.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
</pre></div>
</div>
</div>
</div>
<p>Tworzymy obiekt klasy StandardScaler korzystając z bazowych ustawień.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span> <span class="o">=</span><span class="n">StandardScaler</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Metody rownież są analogiczne jak w poprzednich przypadkach, konwertujemy wyniki z powrotem na ramki danych aby łatwiej było je oglądać.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_ss_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_ss_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">X_train_ss_scaled</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mileage</th>
      <th>condition_transformed</th>
      <th>age</th>
      <th>avg_yearly_mileage</th>
      <th>is_classic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>750.00</td>
      <td>750.00</td>
      <td>750.00</td>
      <td>750.00</td>
      <td>750.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-1.20</td>
      <td>-2.27</td>
      <td>-1.79</td>
      <td>-1.78</td>
      <td>-0.13</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.82</td>
      <td>-0.45</td>
      <td>-0.81</td>
      <td>-0.82</td>
      <td>-0.13</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-0.27</td>
      <td>0.47</td>
      <td>0.01</td>
      <td>-0.04</td>
      <td>-0.13</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.61</td>
      <td>0.47</td>
      <td>0.84</td>
      <td>0.84</td>
      <td>-0.13</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3.23</td>
      <td>1.38</td>
      <td>1.76</td>
      <td>2.27</td>
      <td>7.53</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>W przeciwieństwie do poprzedniego przekształcenia zmienne mają identyczną średnią i odchylenie standardowe, za to różnią sie zakresami wartości.</p>
<div class="alert alert-block alert-info">
<b>Info</b> 
<p>Jako że StandardScaler opiera się na użyciu średniej i odchylenia standardowego z transformowanej zmiennej, również nie jest on wolny od wpływu wartości odstających. Jeśli chcemy być pewni, że wartości odstające nie będą miały wpływu na skalę przekształconej zmiennej można skorzystać z klasy <b>RobustScaler</b></p>
</div></section>
<section class="tex2jax_ignore mathjax_ignore" id="laczenie-roznych-transformacji-w-ramach-pipeline">
<h1>Łączenie różnych transformacji w ramach pipeline<a class="headerlink" href="#laczenie-roznych-transformacji-w-ramach-pipeline" title="Permalink to this heading">#</a></h1>
<p>Cofnijmy się teraz na chwilę do etapu generowania danych i zobaczmy jak można w łatwy i niezawodny sposób łączyć ze sobą różne transformacje z wykorzystaniem obiektów Pipeline oraz ColumnTransformer.</p>
<div class="alert alert-block alert-success">
<b>Definicja</b> 
<p><b>Pipeline</b> jest to przepływ danych przez ułożone w kolejności moduły wykonujące ustalone transformacje, zazwyczaj ostatnim elementem jest model predykcyjny.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UsedCars_df</span> <span class="o">=</span><span class="n">generate_used_cars_data</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">UsedCars_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;selling_price&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">UsedCars_df</span><span class="p">[</span><span class="s2">&quot;selling_price&quot;</span><span class="p">]</span>
<span class="n">X</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2021</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;year_manufactured&quot;</span><span class="p">]</span>
<span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;year_manufactured&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>condition</th>
      <th>mileage</th>
      <th>brand</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>82</th>
      <td>very_good</td>
      <td>176489</td>
      <td>Toyota</td>
      <td>36</td>
    </tr>
    <tr>
      <th>991</th>
      <td>medium</td>
      <td>154950</td>
      <td>Toyota</td>
      <td>50</td>
    </tr>
    <tr>
      <th>789</th>
      <td>medium</td>
      <td>265687</td>
      <td>Skoda</td>
      <td>37</td>
    </tr>
    <tr>
      <th>894</th>
      <td>bad</td>
      <td>110057</td>
      <td>Skoda</td>
      <td>43</td>
    </tr>
    <tr>
      <th>398</th>
      <td>medium</td>
      <td>179567</td>
      <td>Mercedes</td>
      <td>20</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>106</th>
      <td>very_bad</td>
      <td>145613</td>
      <td>Bugatti</td>
      <td>23</td>
    </tr>
    <tr>
      <th>270</th>
      <td>good</td>
      <td>443149</td>
      <td>Fiat</td>
      <td>59</td>
    </tr>
    <tr>
      <th>860</th>
      <td>very_good</td>
      <td>159046</td>
      <td>Audi</td>
      <td>17</td>
    </tr>
    <tr>
      <th>435</th>
      <td>good</td>
      <td>438951</td>
      <td>VW</td>
      <td>71</td>
    </tr>
    <tr>
      <th>102</th>
      <td>good</td>
      <td>201327</td>
      <td>Audi</td>
      <td>28</td>
    </tr>
  </tbody>
</table>
<p>750 rows × 4 columns</p>
</div></div></div>
</div>
<p>Zdefiniujmy teraz grupy zmiennych, które będziemy poddawać poszczególnym transformacjom.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns_for_ordinal_encoding</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">]</span>
<span class="n">columns_for_target_encoding</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span>
<span class="n">numerical_columns</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="s2">&quot;mileage&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Następnie importujemy niezbędne klasy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
</pre></div>
</div>
</div>
</div>
<p>Definiujemy pipeline do przetwarzania poszczególnych grup kolumn, pipeline mogą zawierać wiele kroków, tutaj dla uproszczenia wykorzystamy jednoelementowe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline_oe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span> <span class="o">=</span><span class="p">[(</span><span class="s2">&quot;OrdinalEncoder&quot;</span><span class="p">,</span>
                            <span class="n">OrdinalEncoder</span><span class="p">(</span>
                               <span class="n">categories</span> <span class="o">=</span><span class="p">[[</span><span class="s1">&#39;very_bad&#39;</span><span class="p">,</span> <span class="s1">&#39;bad&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;good&#39;</span><span class="p">,</span> <span class="s1">&#39;very_good&#39;</span><span class="p">]],</span>
                               <span class="n">handle_unknown</span> <span class="o">=</span><span class="s1">&#39;use_encoded_value&#39;</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">))])</span>

<span class="n">pipeline_jse</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;JamesSteinEncoder&quot;</span><span class="p">,</span><span class="n">JamesSteinEncoder</span><span class="p">())])</span>

<span class="n">pipeline_num</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;PowerTransformer&quot;</span><span class="p">,</span><span class="n">PowerTransformer</span><span class="p">(</span><span class="n">standardize</span><span class="o">=</span><span class="kc">False</span><span class="p">))])</span>
</pre></div>
</div>
</div>
</div>
<p>Następnie przypisujemy zmienne do poszczególnych transformacji, korzystając z obiektu ColumnTransformer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">column_transformer</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
                        <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
                         <span class="p">(</span><span class="s1">&#39;categorical_oe&#39;</span><span class="p">,</span> <span class="n">pipeline_oe</span><span class="p">,</span> <span class="n">columns_for_ordinal_encoding</span><span class="p">),</span>
                         <span class="p">(</span><span class="s1">&#39;categorical_jse&#39;</span><span class="p">,</span> <span class="n">pipeline_jse</span><span class="p">,</span> <span class="n">columns_for_target_encoding</span><span class="p">),</span>
                         <span class="p">(</span><span class="s1">&#39;numerical&#39;</span><span class="p">,</span> <span class="n">pipeline_num</span><span class="p">,</span> <span class="n">numerical_columns</span><span class="p">)</span>
                         <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Sam ColumnTransformer również może być częścią pipeline, przykładowo możemy na koniec zastosować standaryzacje.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="s2">&quot;column_transformer&quot;</span><span class="p">,</span> <span class="n">column_transformer</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span><span class="n">StandardScaler</span><span class="p">())</span>
                    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Jeśli używamy pipeline bez modelu predykcyjnego na końcu to stosujemy te same metody co przy zwykłych transformerach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;column_transformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;categorical_oe&#x27;,
                                                  Pipeline(steps=[(&#x27;OrdinalEncoder&#x27;,
                                                                   OrdinalEncoder(categories=[[&#x27;very_bad&#x27;,
                                                                                               &#x27;bad&#x27;,
                                                                                               &#x27;medium&#x27;,
                                                                                               &#x27;good&#x27;,
                                                                                               &#x27;very_good&#x27;]],
                                                                                  handle_unknown=&#x27;use_encoded_value&#x27;,
                                                                                  unknown_value=nan))]),
                                                  [&#x27;condition&#x27;]),
                                                 (&#x27;categorical_jse&#x27;,
                                                  Pipeline(steps=[(&#x27;JamesSteinEncoder&#x27;,
                                                                   JamesSteinEncoder())]),
                                                  [&#x27;brand&#x27;]),
                                                 (&#x27;numerical&#x27;,
                                                  Pipeline(steps=[(&#x27;PowerTransformer&#x27;,
                                                                   PowerTransformer(standardize=False))]),
                                                  [&#x27;age&#x27;, &#x27;mileage&#x27;])])),
                (&#x27;scaler&#x27;, StandardScaler())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;column_transformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;categorical_oe&#x27;,
                                                  Pipeline(steps=[(&#x27;OrdinalEncoder&#x27;,
                                                                   OrdinalEncoder(categories=[[&#x27;very_bad&#x27;,
                                                                                               &#x27;bad&#x27;,
                                                                                               &#x27;medium&#x27;,
                                                                                               &#x27;good&#x27;,
                                                                                               &#x27;very_good&#x27;]],
                                                                                  handle_unknown=&#x27;use_encoded_value&#x27;,
                                                                                  unknown_value=nan))]),
                                                  [&#x27;condition&#x27;]),
                                                 (&#x27;categorical_jse&#x27;,
                                                  Pipeline(steps=[(&#x27;JamesSteinEncoder&#x27;,
                                                                   JamesSteinEncoder())]),
                                                  [&#x27;brand&#x27;]),
                                                 (&#x27;numerical&#x27;,
                                                  Pipeline(steps=[(&#x27;PowerTransformer&#x27;,
                                                                   PowerTransformer(standardize=False))]),
                                                  [&#x27;age&#x27;, &#x27;mileage&#x27;])])),
                (&#x27;scaler&#x27;, StandardScaler())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;column_transformer: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for column_transformer: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;categorical_oe&#x27;,
                                 Pipeline(steps=[(&#x27;OrdinalEncoder&#x27;,
                                                  OrdinalEncoder(categories=[[&#x27;very_bad&#x27;,
                                                                              &#x27;bad&#x27;,
                                                                              &#x27;medium&#x27;,
                                                                              &#x27;good&#x27;,
                                                                              &#x27;very_good&#x27;]],
                                                                 handle_unknown=&#x27;use_encoded_value&#x27;,
                                                                 unknown_value=nan))]),
                                 [&#x27;condition&#x27;]),
                                (&#x27;categorical_jse&#x27;,
                                 Pipeline(steps=[(&#x27;JamesSteinEncoder&#x27;,
                                                  JamesSteinEncoder())]),
                                 [&#x27;brand&#x27;]),
                                (&#x27;numerical&#x27;,
                                 Pipeline(steps=[(&#x27;PowerTransformer&#x27;,
                                                  PowerTransformer(standardize=False))]),
                                 [&#x27;age&#x27;, &#x27;mileage&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">categorical_oe</label><div class="sk-toggleable__content fitted"><pre>[&#x27;condition&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OrdinalEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.OrdinalEncoder.html">?<span>Documentation for OrdinalEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OrdinalEncoder(categories=[[&#x27;very_bad&#x27;, &#x27;bad&#x27;, &#x27;medium&#x27;, &#x27;good&#x27;, &#x27;very_good&#x27;]],
               handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=nan)</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">categorical_jse</label><div class="sk-toggleable__content fitted"><pre>[&#x27;brand&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">JamesSteinEncoder</label><div class="sk-toggleable__content fitted"><pre>JamesSteinEncoder()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">numerical</label><div class="sk-toggleable__content fitted"><pre>[&#x27;age&#x27;, &#x27;mileage&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;PowerTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.PowerTransformer.html">?<span>Documentation for PowerTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>PowerTransformer(standardize=False)</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div></div>
</div>
<p>Po uruchomieniu metody fit widzimy wszystkie kroki całego pipeline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_transformed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_transformed</span> <span class="o">=</span> <span class="n">preprocessing_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rozmiar zbioru treningowego po transformacji: </span><span class="si">{</span><span class="n">X_train_transformed</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rozmiar zbioru testowego po transformacji: </span><span class="si">{</span><span class="n">X_test_transformed</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_transformed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rozmiar zbioru treningowego po transformacji: (750, 4)
rozmiar zbioru testowego po transformacji: (250, 4)
[[ 1.35745763 -0.75486091  0.08926064  0.20978188]
 [-0.41160097 -0.75486091  0.71778952  0.06979217]
 [-0.41160097 -0.74667046  0.13621146  0.68990766]
 ...
 [ 1.35745763  0.75966683 -0.89436295  0.09738681]
 [ 0.47292833 -0.72782613  1.57354421  1.37242728]
 [ 0.47292833  0.75966683 -0.30088652  0.35749175]]
</pre></div>
</div>
</div>
</div>
<p>Jak widzimy zwrócony zbiór treningowy ma typ danych array, a jego wymiary odpowiadają tym przed transformacją, zgodność wymiarów zależy jednak od zastosowanych transformacji.</p>
<p>Jeśli pipeline jest zakończony modelem predykcyjnym jego metody są identyczne jak metody modelu, czyli korzystamy z fit i predict, tak jak w poniższym przykładzie.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">final_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;preprocessing&quot;</span><span class="p">,</span> <span class="n">preprocessing_pipeline</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">())</span>
                <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Poniżej pokazujemy jak wytrenować pipeline w oparciu o zbiór treningowy, a następnie dokonać predykcji na zbiorze testowym.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">X_test_predicted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">final_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">)</span>
<span class="n">X_test_predicted</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    -1200.475717
1    16445.786555
2     3452.651025
3    46897.291650
4     3512.366326
Name: prediction, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="podsumowanie">
<h1>Podsumowanie<a class="headerlink" href="#podsumowanie" title="Permalink to this heading">#</a></h1>
<p>Powyżej zaprezentowaliśmy kilka różnych przykładów przekształcania surowych danych w cechy predykcyjne przydatne przy modelowaniu. Niektóre transformacje można z powodzeniem stosować przy pracy nad innymi problemami, inne należy raczej potraktować jako inspirację. Ważne aby prace nad Feature Engineering poprzedzone były dobrym zrozumieniem danych. Niezwykle ważne jest tutaj aby już na tym etapie stosować odpowiednią strategię walidacyjną, aby zapobiec korzystaniu z informacji ze zbioru testowego, inaczej nasze wyniki nie będą miarodajne.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./6. Inzynieria_cech"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../5.%20Wykrywanie_anomalii/5_Wykrywanie%20anomalii%20tutorial.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Wykrywanie anomalii - tutorial</p>
      </div>
    </a>
    <a class="right-next"
       href="../10.%20Czyszczenie_danych/Czyszczenie%20danych.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Czyszczenie danych</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Inżynieria cech</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tworzenie-przykladowych-zbiorow-danych">Tworzenie przykładowych zbiorów danych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-tworzone-na-podstawie-danych-czasowych">Cechy tworzone na podstawie danych czasowych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-powstale-przez-przesuniecie-w-czasie">Cechy powstałe przez przesunięcie w czasie</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-kategoryczne-i-ich-transformacje">Cechy kategoryczne i ich transformacje</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#laczenie-atrybutow-cech-kategorycznych">Łączenie atrybutów cech kategorycznych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-oparte-na-wiedzy-domenowej-oraz-cechy-interakcji">Cechy oparte na wiedzy domenowej oraz cechy interakcji</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#cechy-oparte-na-transformacji-zmiennych-numerycznych">Cechy oparte na transformacji zmiennych numerycznych</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#laczenie-zmiennych-numerycznych-w-przedzialy">Łączenie zmiennych numerycznych w przedziały</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#normalizacja-i-standaryzacja">Normalizacja i Standaryzacja</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#laczenie-roznych-transformacji-w-ramach-pipeline">Łączenie różnych transformacji w ramach pipeline</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#podsumowanie">Podsumowanie</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By codersi
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>