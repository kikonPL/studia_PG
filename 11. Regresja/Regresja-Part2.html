
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analiza regresji &#8212; Silky Coders Data Science</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Wyjaśnialność modeli - metryki statystyczne - tutorial" href="../8.%20Wyjasnialnosc/8_Tutorial%20metryki%20statystyczne.html" />
    <link rel="prev" title="Klasyfikacja w Python" href="../12.%20Klasyfikacja/Klasyfikacja.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/silky-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Silky Coders Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Laboratorium specjalistyczne: Data Science w branży modowej, 1 semestr studiów magisterskich Matematyki na Wydziale Fizyki Technicznej i Matematyki Stosowanej na Politechnice Gdańskiej
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Wprowadzenie do pakietów numpy i pandas
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1.%20Tutorial%20pandas/1_Tutorial%20pandas.html">
   Pakiet pandas - tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2.%20Numpy_tutorial/2_Tutorial%20numpy.html">
   Pakiet NumPy - tutorial
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Wizualizacja danych
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../3.%20Wizualizacja_danych/3_Wizualizacja%20danych.html">
   Wizualizacja danych w Python
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Analiza statystyczna
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../4.%20Analiza_statystyczna/4_Analiza%20statystyczna.html">
   Analiza statystyczna - tutorial
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Wykrywanie anomalii
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../5.%20Wykrywanie_anomalii/Wykrywanie_anomalii_teoria.html">
   Wykrywanie anomalii - definicje
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../5.%20Wykrywanie_anomalii/5_Wykrywanie%20anomalii%20tutorial.html">
   Wykrywanie anomalii - tutorial
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Inżynieria cech
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../6.%20Inzynieria_cech/6_Inzynieria%20cech.html">
   Inżynieria cech
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Czyszczenie danych
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../10.%20Czyszczenie_danych/Czyszczenie%20danych.html">
   Czyszczenie danych
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Klasteryzacja
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../7.%20Klasteryzacja/7_Klasteryzacja.html">
   Klasteryzacja w Python
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Klasyfikacja
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../12.%20Klasyfikacja/Klasyfikacja.html">
   Klasyfikacja w Python
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Regresja
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Analiza regresji
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Wyjaśnialność modeli
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../8.%20Wyjasnialnosc/8_Tutorial%20metryki%20statystyczne.html">
   Wyjaśnialność modeli - metryki statystyczne - tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../9.%20XAI/Wyjasnialnosc_modeli_definicje.html">
   Wyjaśnialność modeli - definicje
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../9.%20XAI/9_Wyjasnialnosc%20modeli.html">
   Wyjaśnialność modeli - XAI - tutorial
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/11. Regresja/Regresja-Part2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kikonPL/studia_PG"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/kikonPL/studia_PG/issues/new?title=Issue%20on%20page%20%2F11. Regresja/Regresja-Part2.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kikonPL/studia_PG/main?urlpath=tree/11. Regresja/Regresja-Part2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/kikonPL/studia_PG/blob/main/11. Regresja/Regresja-Part2.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wstep">
   Wstęp
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modele-regresyjne">
   Modele regresyjne
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-regression">
   Linear Regression
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ridge-regression">
   Ridge Regression
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lasso-regression">
   Lasso Regression
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#polynomial-regression">
   Polynomial Regression
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decision-trees">
   Decision Trees
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#random-forest">
   Random forest
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inne-modele">
   Inne modele
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xgboost">
     XGBoost
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lightgbm">
     LightGBM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sieci-neuronowe">
     Sieci neuronowe
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliografia">
   Bibliografia
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="analiza-regresji">
<h1>Analiza regresji<a class="headerlink" href="#analiza-regresji" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="wstep">
<h2>Wstęp<a class="headerlink" href="#wstep" title="Permalink to this headline">¶</a></h2>
<p>Algorytmy regresyjne należą do grupy <em>uczenia nadzorowanego</em> (Supervised Learning), inaczej mówiąc, są to algorytmy mające określoną zmienną celu (target) oraz zdefiniowane zmienne wejściowe. W odróżnieniu od klasyfikacji, w regresji zmienna celu jest liczbą rzeczywistą. Analiza regresji jest jedną z metod analizy statystycznej pozwalających opisać zależność między zmienną objaśnianą <span class="math notranslate nohighlight">\(y \in \mathbb{R}\)</span> (zmienna celu, zmienna zależna) oraz zmienną, bądź kilkoma, zmiennymi objaśniającymi (niezależnymi) <span class="math notranslate nohighlight">\(x \in \mathbb{R}^d\)</span>.</p>
<p>Załóżmy, że chcemy wystawić na sprzedaż dom, ale nie znamy jego wartości. Powinniśmy zatem przyjrzeć się innym domom w okolicy, sprzedanym w niedalekiej przeszłości i na podstawie cen sprzedaży oraz innych czynników, takich jak ilość sypialni czy powierzchnia użytkowa, określić wartość domu, który chcemy sprzedać.</p>
<p>W badanym przypadku, zmienną zależną będzie cena domu, natomiast zmiennymi niezależnymi będą ilość sypialni, ilość łazienek, powierzchnia w m2, rok budowy itd. Znajdując zależność między tymi zmiennymi, będziemy w stanie określić jakie czynniki mają faktyczny wpływ na wartość domu oraz który czynnik jest najbardziej istotny, a także przewidzieć cenę za jaką sprzedamy nasz dom.</p>
</div>
<hr class="docutils" />
<div class="section" id="modele-regresyjne">
<h2>Modele regresyjne<a class="headerlink" href="#modele-regresyjne" title="Permalink to this headline">¶</a></h2>
<p>Zostanie przedstawionych 6 następujących algorytmów regresyjnych:</p>
<ul class="simple">
<li><p>Linear Regression</p></li>
<li><p>Ridge Regression</p></li>
<li><p>Lasso Regression</p></li>
<li><p>Polynomial Regression</p></li>
<li><p>Decision Tree</p></li>
<li><p>Random Forest</p></li>
</ul>
<p>Skrótowo zostaną także przedstawione XGBoost, LightGBM oraz Sieci Neuronowe.</p>
</div>
<div class="section" id="linear-regression">
<h2>Linear Regression<a class="headerlink" href="#linear-regression" title="Permalink to this headline">¶</a></h2>
<p>Załóżmy, że mamy wektor <span class="math notranslate nohighlight">\(X^T = (1, x_1, x_2,\dots, x_p)\)</span> i chcemy przewidzieć wartość zmiennej <span class="math notranslate nohighlight">\(y\)</span>. Model regresji liniowej przedstawia się następująco:</p>
<div class="math notranslate nohighlight">
\[f(X) = \sum_{j=0}^p x_j \beta_j + \epsilon_j,\]</div>
<p>gdzie <span class="math notranslate nohighlight">\(\beta_j\)</span> nazywane są współczynnikami, a <span class="math notranslate nohighlight">\(\epsilon_j\)</span> jest składnikiem losowym.</p>
<p>Model regresji liniowej zakłada, że warunkowa wartość oczekiwana <span class="math notranslate nohighlight">\(E(Y|X)\)</span> jest funkcją liniową.</p>
<p>Najpopularniejszą metodą estymacji liniowej zależności jest <b>metoda najmniejszych kwadratów</b>, która wyznacza współczynniki <span class="math notranslate nohighlight">\(\beta\)</span> funkcji</p>
<div class="math notranslate nohighlight">
\[\hat{f}(X) = \sum_{j=0}^p x_j \beta_j\]</div>
<p>tak, aby zminimalizować błąd kwadratowy</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$$RSS(\beta) = \sum_{i=1}^N \bigg(y_i - \sum_{j=0}^p x_{ij} \beta_j\bigg)^2 = \big(X \beta - y\big)^T \big(X \beta - y\big).$$
</pre></div>
</div>
<p>Matematycznie problem ten można opisać wzorem:</p>
<div class="math notranslate nohighlight">
\[ 	\frac{\partial RSS}{\partial \hat{\beta}} = 0\]</div>
<p>Po zróżniczkowaniu i po przekształceniach otrzymujemy wzór na współczynniki <span class="math notranslate nohighlight">\(\hat{\beta}\)</span>:</p>
<div class="math notranslate nohighlight">
\[ \hat{\beta} = (X^TX)^{-1} X^T y\]</div>
<p>Poniższa ramka danych zawiera informację o cenie sprzedaży domów oraz ich powierzchni.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Załadowanie bibliotek</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span> <span class="k">as</span> <span class="nn">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span><span class="p">,</span> <span class="n">plot_tree</span><span class="p">,</span> <span class="n">export_text</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parametry do wizualizacji</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Stworzenie ramki danych</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(([</span><span class="mi">76</span><span class="p">,</span> <span class="mi">350</span><span class="p">],</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">370</span><span class="p">],</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">540</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">600</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">800</span><span class="p">],</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">490</span><span class="p">],</span> <span class="p">[</span><span class="mi">130</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">700</span><span class="p">],</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">700</span><span class="p">]),</span> 
                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cena&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Wizualizacja danych</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkmagenta&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_12_0.png" src="../_images/Regresja-Part2_12_0.png" />
</div>
</div>
<p>Możemy założyć, że istnieje liniowa zależność pomiędzy ceną domu, a powierzchnią w m2. Czyli, szukamy funkcji <span class="math notranslate nohighlight">\(\hat{f}\)</span> takiej, że:</p>
<div class="math notranslate nohighlight">
\[cena \approx \hat{ \beta}_0 + \hat{\beta}_1 \cdot m2 \\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkmagenta&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">250</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightseagreen&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;B0 = 250, B1 = 3, RSS = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">250</span> <span class="o">-</span> <span class="n">y</span><span class="p">))))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;B0 = 100, B1 = 5, RSS = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">y</span><span class="p">))))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">500</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;B0 = 500, B1 = 1, RSS = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">500</span> <span class="o">-</span> <span class="n">y</span><span class="p">))))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_14_0.png" src="../_images/Regresja-Part2_14_0.png" />
</div>
</div>
<p>Widzimy, że najmniejszy błąd kwadratowy daje nam różowa linia.
Aby znaleźć najlepsze z możliwych rozwiązań, wykorzystamy funkcję LinearRegression z biblioteki scikit-learn do znalezienia wartości współczynników <span class="math notranslate nohighlight">\( \hat{ \beta}_0, \hat{ \beta}_1\)</span> metodą najmniejszych kwadratów.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;M2&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Cena&#39;</span><span class="p">]</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">positive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>        <span class="c1"># positive = True może mieć sens dla np. cen</span>
                       <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    <span class="c1"># jeśli False to brak wyrazu wolnego</span>
<span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Współczynnik</span>
<span class="n">reg</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.83141395])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Wyraz wolny</span>
<span class="n">reg</span><span class="o">.</span><span class="n">intercept_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>264.68330134356995
</pre></div>
</div>
</div>
</div>
<p>Znaleziona funkcja przedstawia się następująco:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkmagenta&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">reg</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_20_0.png" src="../_images/Regresja-Part2_20_0.png" />
</div>
</div>
<p>Błąd kwadratowy w tym przypadku wynosi:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>55928.85476647472
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="ridge-regression">
<h2>Ridge Regression<a class="headerlink" href="#ridge-regression" title="Permalink to this headline">¶</a></h2>
<p><em>Overtfitting</em> to nadmierne dopasowanie modelu do danych, przez co na zbiorze treningowym błąd kwadratowy będzie bliski zeru, natomiast na zbiorze testowym będzie bardzo duży. W regresji liniowej zjawisko to, wystąpić może w przypadku, gdy mamy mniej obserwacji niż predyktorów.</p>
<p><img alt="title" src="../_images/Bias_and_variance_contributing_to_total_error.svg.png" />
<em>Źródło: <a class="reference external" href="https://en.wikipedia.org/wiki/Bias%E2%80%93variance_tradeoff">https://en.wikipedia.org/wiki/Bias–variance_tradeoff</a></em></p>
<p>W celu rozwiązania problemu przeuczenia modelu, należy znaleźć kompromis między wariancją a przeciążeniem. Dokonać tego można dodając regularyzację do modelu.</p>
<p><strong>Norma <span class="math notranslate nohighlight">\(Lp\)</span></strong></p>
<p>Niech <span class="math notranslate nohighlight">\(x = (x_1, x_2, ..., x_n) \in \mathbf{X}\)</span>. Funkcje postaci</p>
<div class="math notranslate nohighlight">
\[||x||_p = (|x_1|^p + |x_2|^p + ... |x_n|^p ) ^{\frac{1}{p}} \]</div>
<p>są normami dla <span class="math notranslate nohighlight">\( 1 \leq p &lt; \infty \)</span>. Normę <span class="math notranslate nohighlight">\(||x||_2 \)</span> nazywa się <em>normą euklidesową</em>.</p>
<p><b> Ridge Regression</b> wykorzystuje normę euklidesową <span class="math notranslate nohighlight">\(L2\)</span>, aby “ukarać” model za wielkość współczynników. Wtedy zamiast minimalizacji błędu resztowych sum kwadratów, minimalizowana jest funkcja:</p>
<div class="math notranslate nohighlight">
\[RSS_{Ridge} (\beta) = \sum_{i=1}^N \bigg(y_i - \sum_{j=0}^p x_{ij} \beta_j\bigg)^2 + \alpha \sum_{j=1}^{p} \beta_j^2, \]</div>
<p>gdzie <span class="math notranslate nohighlight">\(\alpha\)</span> jest hiperparametrem, nazywanym współczynnikiem kary. Przyjmuje wartości <span class="math notranslate nohighlight">\(\alpha \geq 0\)</span>. Im wyższa jego wartość, tym model jest bardziej “karany”.</p>
<hr class="docutils" />
<p>Dla celów edukacyjnych podzielimy zbiór tak, aby w zbiorze treningowym były tylko 2 obserwacje. Jest to zabieg celowy, gdyż chcemy pokazać przykład overtfittingu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span><span class="p">,</span> <span class="n">data_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;M2&#39;</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Cena&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">data_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;M2&#39;</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">data_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Cena&#39;</span><span class="p">]</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;M2&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Cena&#39;</span><span class="p">]</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Często <span class="math notranslate nohighlight">\(\alpha\)</span> wybiera się z przedziału <span class="math notranslate nohighlight">\([0,1]\)</span>. W naszym przypadku wartości te są zbyt małe, więc musieliśmy ją znacznie zwiększyć. Ponieważ <span class="math notranslate nohighlight">\(\alpha\)</span> jest hiperparametrem, w celu znalezienia najlepszej wartości można wykorzystać <em>walidację krzyżową</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge1</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1">#warto zwrócić uwagę, że alpha = 0 daje nam zwykłą regresję liniową</span>
<span class="n">ridge1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ridge(alpha=0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge2</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">ridge2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ridge(alpha=200)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge3</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">ridge3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ridge(alpha=1000)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge4</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">)</span>
<span class="n">ridge4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ridge(alpha=5000)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ridge1</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ridge1</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 0&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ridge2</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ridge2</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightseagreen&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 200&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ridge3</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ridge3</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;plum&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 1000&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ridge4</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ridge4</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;mediumvioletred&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 5000&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Zbiór treningowy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_38_0.png" src="../_images/Regresja-Part2_38_0.png" />
</div>
</div>
<p>Możemy zauważyć, że na zbiorze treningowym regresja liniowa dopasowuje się idealnie do obserwacji, gdzie regresja grzbietowa wraz ze wzrostem parametru <span class="math notranslate nohighlight">\(\alpha\)</span> wydaje się mieć coraz gorsze dopasowanie. Zobaczmy jak to wygląda na zbiorze testowym.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkmagenta&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ridge1</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ridge1</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 0&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ridge2</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ridge2</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightseagreen&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 200&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ridge3</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ridge3</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;plum&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 1000&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ridge4</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ridge4</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;mediumvioletred&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 5000&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Zbiór testowy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_40_0.png" src="../_images/Regresja-Part2_40_0.png" />
</div>
</div>
<p>W przypadku regresji liniowej widoczny jest <strong>overfittting</strong>. Linia przechodzi dokładnie przez dwie obserwacje ze zbioru treningowego, zatem błąd kwadratowy będzie równy zero, natomiast na zbiorze testowym błąd ten będzie bardzo duży. Aby zapobiec takiej sytuacji, została wykorzystana Ridge Regression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wyniki</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RSS&#39;</span><span class="p">:[</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ridge1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)),</span><span class="mi">0</span><span class="p">),</span> 
                                     <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ridge2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)),</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ridge3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)),</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ridge4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)),</span><span class="mi">0</span><span class="p">)</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ridge1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                   <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ridge2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                   <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ridge3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                   <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ridge4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))],</span>
                             <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ridge1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ridge2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ridge3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ridge4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))]},</span> 
                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alpha = 0&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha = 200&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha = 1000&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha = 5000&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">wyniki</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row0_col0,#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row0_col2,#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row3_col1{
            background-color:  #08306b;
            color:  #f1f1f1;
        }#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row0_col1,#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row3_col0,#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row3_col2{
            background-color:  #f7fbff;
            color:  #000000;
        }#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row1_col0{
            background-color:  #1460a8;
            color:  #f1f1f1;
        }#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row1_col1{
            background-color:  #d3e3f3;
            color:  #000000;
        }#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row1_col2{
            background-color:  #084d96;
            color:  #f1f1f1;
        }#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row2_col0{
            background-color:  #99c7e0;
            color:  #000000;
        }#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row2_col1{
            background-color:  #4695c8;
            color:  #000000;
        }#T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row2_col2{
            background-color:  #549fcd;
            color:  #000000;
        }</style><table id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >RSS</th>        <th class="col_heading level0 col1" >R2</th>        <th class="col_heading level0 col2" >MAE</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4level0_row0" class="row_heading level0 row0" >alpha = 0</th>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row0_col0" class="data row0 col0" >1964561.000000</td>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row0_col1" class="data row0 col1" >-10.849875</td>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row0_col2" class="data row0 col2" >403.392857</td>
            </tr>
            <tr>
                        <th id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4level0_row1" class="row_heading level0 row1" >alpha = 200</th>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row1_col0" class="data row1 col0" >1615208.000000</td>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row1_col1" class="data row1 col1" >-8.742643</td>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row1_col2" class="data row1 col2" >369.646226</td>
            </tr>
            <tr>
                        <th id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4level0_row2" class="row_heading level0 row2" >alpha = 1000</th>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row2_col0" class="data row2 col0" >814095.000000</td>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row2_col1" class="data row2 col1" >-3.910474</td>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row2_col2" class="data row2 col2" >273.786232</td>
            </tr>
            <tr>
                        <th id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4level0_row3" class="row_heading level0 row3" >alpha = 5000</th>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row3_col0" class="data row3 col0" >88315.000000</td>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row3_col1" class="data row3 col1" >0.467297</td>
                        <td id="T_2bd92434_8ee2_11ed_81da_5ce42ab500e4row3_col2" class="data row3 col2" >103.296980</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>Widzimy, że im większy współczynnik kary, tym model jest bardziej dopasowany do pozostałych obserwacji.</p>
</div>
<hr class="docutils" />
<div class="section" id="lasso-regression">
<h2>Lasso Regression<a class="headerlink" href="#lasso-regression" title="Permalink to this headline">¶</a></h2>
<p><strong>Lasso Regression</strong> jest kolejną metodą służącą do redukcji overfittingu, ale tym razem wykorzystującą do regularyzacji normę <span class="math notranslate nohighlight">\(L1\)</span>.</p>
<p>Funkcja celu modelu Lasso Regression wygląda następująco:</p>
<div class="math notranslate nohighlight">
\[RSS_{Lasso} (\beta) = \sum_{i=1}^N \bigg(y_i - \sum_{j=0}^p x_{ij} \beta_j\bigg)^2 + \alpha \sum_{j=1}^{p} |\beta_j|, \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso1</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">)</span>
<span class="n">lasso1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lasso(alpha=0.001)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso2</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">lasso2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lasso(alpha=200)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso3</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">lasso3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lasso(alpha=1000)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso4</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">)</span>
<span class="n">lasso4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lasso(alpha=5000)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkmagenta&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;Cena&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lasso1</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lasso1</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 0&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lasso2</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lasso2</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;lightseagreen&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 200&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lasso3</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lasso3</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;plum&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 1000&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lasso4</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lasso4</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;mediumvioletred&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;alpha = 5000&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Zbiór testowy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_52_0.png" src="../_images/Regresja-Part2_52_0.png" />
</div>
</div>
<p>Tutaj również możemy wyciągnąć wniosek, że im większy współczynnik kary, tym dopasowanie modelu jest lepsze.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wyniki2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RSS&#39;</span><span class="p">:[</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">lasso1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)),</span><span class="mi">0</span><span class="p">),</span> 
                                     <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">lasso2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)),</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">lasso3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)),</span><span class="mi">0</span><span class="p">),</span>
                                     <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">lasso4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)),</span><span class="mi">0</span><span class="p">)</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                   <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                   <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                   <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))],</span>
                             <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))]},</span> 
                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alpha = 0&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha = 200&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha = 1000&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha = 5000&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">wyniki2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row0_col0,#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row0_col2,#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row3_col1{
            background-color:  #08306b;
            color:  #f1f1f1;
        }#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row0_col1,#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row3_col0,#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row3_col2{
            background-color:  #f7fbff;
            color:  #000000;
        }#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row1_col0{
            background-color:  #084387;
            color:  #f1f1f1;
        }#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row1_col1{
            background-color:  #e9f2fa;
            color:  #000000;
        }#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row1_col2{
            background-color:  #083a7a;
            color:  #f1f1f1;
        }#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row2_col0{
            background-color:  #3787c0;
            color:  #000000;
        }#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row2_col1{
            background-color:  #abd0e6;
            color:  #000000;
        }#T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row2_col2{
            background-color:  #1764ab;
            color:  #f1f1f1;
        }</style><table id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >RSS</th>        <th class="col_heading level0 col1" >R2</th>        <th class="col_heading level0 col2" >MAE</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4level0_row0" class="row_heading level0 row0" >alpha = 0</th>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row0_col0" class="data row0 col0" >1964561.000000</td>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row0_col1" class="data row0 col1" >-10.849871</td>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row0_col2" class="data row0 col2" >403.392793</td>
            </tr>
            <tr>
                        <th id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4level0_row1" class="row_heading level0 row1" >alpha = 200</th>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row1_col0" class="data row1 col0" >1828182.000000</td>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row1_col1" class="data row1 col1" >-10.027261</td>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row1_col2" class="data row1 col2" >390.617347</td>
            </tr>
            <tr>
                        <th id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4level0_row2" class="row_heading level0 row2" >alpha = 1000</th>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row2_col0" class="data row2 col0" >1332914.000000</td>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row2_col1" class="data row2 col1" >-7.039895</td>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row2_col2" class="data row2 col2" >339.515306</td>
            </tr>
            <tr>
                        <th id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4level0_row3" class="row_heading level0 row3" >alpha = 5000</th>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row3_col0" class="data row3 col0" >62549.000000</td>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row3_col1" class="data row3 col1" >0.622717</td>
                        <td id="T_2c3529f6_8ee2_11ed_b521_5ce42ab500e4row3_col2" class="data row3 col2" >84.005102</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>Używanie normy <span class="math notranslate nohighlight">\(L1\)</span> może także spowodować, że w przypadku modelu o kilku zmiennych objaśniających, współczynniki dla niektórych z nich zostaną wyzerowane.</p>
<p><strong>Interpretacja geometryczna</strong></p>
<p><img alt="title" src="../_images/ridge_lasso.png" /></p>
<p>Źródło: <em>The Elements of Statistical Learning</em> Trevor Hastie, Robert Tibshirani, Jerome Friedman, Second Edition.</p>
<p>Czerwone elipsy odpowiadają za błąd kwadratowy, natomiast niebieskie kolory przedstawiają kulę w metrykach <span class="math notranslate nohighlight">\(L1\)</span> i <span class="math notranslate nohighlight">\(L2\)</span> odpowiednio. W związku z tym, że kula w metryce <span class="math notranslate nohighlight">\(L1\)</span> ma kwadratowy kształt, to kiedy suma resztowa kwadratów znajdzie się w jednym z rogów, współczynnik jest zerowany. W Ridge Regression współczynniki te zbliżają się do zera, ale nigdy nie osiągają wartości równej 0.</p>
<p>Z tego też względu <strong>Lasso Regression</strong> jest często wykorzystywane również do wyboru zmiennych modelu.</p>
</div>
<hr class="docutils" />
<div class="section" id="polynomial-regression">
<h2>Polynomial Regression<a class="headerlink" href="#polynomial-regression" title="Permalink to this headline">¶</a></h2>
<p>Weźmy teraz nowy, nieco bardziej abstrakcyjny zbiór danych, zdefiniowany jako argumenty i wartości pewnej funkcji, przy czym do wartości dodajmy nieco szumu losowego.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">125</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">noise</span>

<span class="n">x_train</span><span class="p">,</span> <span class="n">x_valid</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Zbior treningowy&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_61_0.png" src="../_images/Regresja-Part2_61_0.png" />
</div>
</div>
<p>Spróbujmy dopasować do tych danych model regresji liniowej.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg2</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">positive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>        
                       <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
<span class="n">reg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coefficient: &quot;</span><span class="p">,</span> <span class="n">reg2</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Intercept: &quot;</span><span class="p">,</span> <span class="n">reg2</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient:  [[0.38355249]]
Intercept:  [0.32220545]
</pre></div>
</div>
</div>
</div>
<p>Sprawdźmy dopasowanie modelu do danych treningowych.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_train</span> <span class="o">*</span> <span class="n">reg2</span><span class="o">.</span><span class="n">coef_</span> <span class="o">+</span> <span class="n">reg2</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Zbior treningowy i &quot;dopasowana&quot; regresja liniowa&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_66_0.png" src="../_images/Regresja-Part2_66_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds3</span> <span class="o">=</span> <span class="n">reg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_valid</span><span class="p">)</span>

<span class="n">wyniki3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RSS&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">preds3</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">))</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds3</span><span class="p">)</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds3</span><span class="p">)]},</span> 
                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lin_reg&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">wyniki3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_2c88f067_8ee2_11ed_b6ed_5ce42ab500e4row0_col0,#T_2c88f067_8ee2_11ed_b6ed_5ce42ab500e4row0_col1,#T_2c88f067_8ee2_11ed_b6ed_5ce42ab500e4row0_col2{
            background-color:  #f7fbff;
            color:  #000000;
        }</style><table id="T_2c88f067_8ee2_11ed_b6ed_5ce42ab500e4" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >RSS</th>        <th class="col_heading level0 col1" >R2</th>        <th class="col_heading level0 col2" >MAE</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_2c88f067_8ee2_11ed_b6ed_5ce42ab500e4level0_row0" class="row_heading level0 row0" >lin_reg</th>
                        <td id="T_2c88f067_8ee2_11ed_b6ed_5ce42ab500e4row0_col0" class="data row0 col0" >2.193040</td>
                        <td id="T_2c88f067_8ee2_11ed_b6ed_5ce42ab500e4row0_col1" class="data row0 col1" >0.441041</td>
                        <td id="T_2c88f067_8ee2_11ed_b6ed_5ce42ab500e4row0_col2" class="data row0 col2" >0.246324</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>Jak widzimy, model regresji liniowej nie dał dobrego dopasowania do nowego zbioru danych. Stało się tak dlatego, że relacja pomiędzy zmienną objaśniającą a zmienną objaśnianą po prostu nie jest liniowa, a co za tym idzie, modele liniowe nie będą dawać nam zadowalającej skuteczności. W takim wypadku, siłą rzeczy, powinniśmy posłużyć się modelami nieliniowymi. Pierwszym z nich jest regresja wielomianowa.</p>
<p>Najprostszą formą regresji wielomianowej jest regresja kwadratowa, której równanie jest dane jako</p>
<div class="math notranslate nohighlight">
\[y = \beta_0 + \beta_1 x + \beta_2 x^2 + \epsilon,\]</div>
<p>gdzie oczywiście zakładamy, że mamy jedną zmienną objaśniającą i jedną zmienną objaśnianą. W ogólności, możemy modelować oczekiwaną wartość <span class="math notranslate nohighlight">\(y\)</span> wielomianem n-tego stopnia, uzyskując równanie ogólne postaci</p>
<div class="math notranslate nohighlight">
\[y = \beta_0 + \beta_1 x + \beta_2 x^2 + ... + \beta_n x^n + \epsilon.\]</div>
<p>Można zauważyć, że z punktu widzenia estymacji ten model jest liniowy, gdyż funkcja regresji jest liniowa względem nieznanych parametrów <span class="math notranslate nohighlight">\(\beta_0,\beta_1,...,\beta_n\)</span>. Zatem, stosując metodę najmniejszych kwadratów, taki model może być traktowany jak model regresji liniowej wielu zmiennych, przy założeniu, że <span class="math notranslate nohighlight">\(x,x^2,...x^n\)</span> są różnymi, niezależnymi zmiennymi w takim modelu.</p>
<p>Podobnie jak wcześniej, współczynniki <span class="math notranslate nohighlight">\(\beta\)</span> są dane wzorem</p>
<div class="math notranslate nohighlight">
\[ \hat{\beta} = (X^TX)^{-1} X^T y.\]</div>
<p>Na początek zamodelujemy dane regresją kwadratową.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poly</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">x_train_poly</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
<span class="n">x_valid_poly</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Funkcja PolynomialFeatures wyznacza wielomiany złożone z cech numerycznych zadanej ramki danych. W naszym wypadku, jeśli mamy do dyspozycji jedną cechę <span class="math notranslate nohighlight">\(x\)</span> oraz wyznaczamy cechy wielomianowe drugiego stopnia, powstanie nam nowa cecha <span class="math notranslate nohighlight">\(x^2\)</span> oraz dodatkowa cecha, która dla każdego rekordu przyjmuje wartość <span class="math notranslate nohighlight">\(1\)</span>. Natomiast, jeśli mielibyśmy dwie cechy <span class="math notranslate nohighlight">\([x_1,x_2]\)</span>, to lista nowych cech wyglądałaby następująco: <span class="math notranslate nohighlight">\([1,x_1,x_2,x_1^2,x_1 x_2,x_2^2]\)</span>, gdzie wszystkie cechy trafiłyby do modelu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg3</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">positive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>        
                       <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
<span class="n">reg3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_poly</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coefficient: &quot;</span><span class="p">,</span> <span class="n">reg3</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Intercept: &quot;</span><span class="p">,</span> <span class="n">reg3</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient:  [[0.         0.42997276 1.02119995]]
Intercept:  [-0.01564705]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred_reg3</span> <span class="o">=</span> <span class="n">reg3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_valid_poly</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_plot_squarereg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,)),</span> 
    <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="n">x_train_poly</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">reg3</span><span class="o">.</span><span class="n">coef_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_train_poly</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">reg3</span><span class="o">.</span><span class="n">coef_</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">reg3</span><span class="o">.</span><span class="n">intercept_</span>
    <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_plot_squarereg</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>  <span class="n">df_plot_squarereg</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Zbior treningowy i dopasowana regresja kwadratowa&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_75_0.png" src="../_images/Regresja-Part2_75_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds4</span> <span class="o">=</span> <span class="n">reg3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_valid_poly</span><span class="p">)</span>

<span class="n">wyniki4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RSS&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">preds3</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">preds4</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">))</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds3</span><span class="p">),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">)</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds3</span><span class="p">),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">)]},</span> 
                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lin_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;square_reg&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">wyniki4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row0_col0,#T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row0_col2,#T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row1_col1{
            background-color:  #08306b;
            color:  #f1f1f1;
        }#T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row0_col1,#T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row1_col0,#T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row1_col2{
            background-color:  #f7fbff;
            color:  #000000;
        }</style><table id="T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >RSS</th>        <th class="col_heading level0 col1" >R2</th>        <th class="col_heading level0 col2" >MAE</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4level0_row0" class="row_heading level0 row0" >lin_reg</th>
                        <td id="T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row0_col0" class="data row0 col0" >2.193040</td>
                        <td id="T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row0_col1" class="data row0 col1" >0.441041</td>
                        <td id="T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row0_col2" class="data row0 col2" >0.246324</td>
            </tr>
            <tr>
                        <th id="T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4level0_row1" class="row_heading level0 row1" >square_reg</th>
                        <td id="T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row1_col0" class="data row1 col0" >0.710297</td>
                        <td id="T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row1_col1" class="data row1 col1" >0.818960</td>
                        <td id="T_2cbeabef_8ee2_11ed_9d6f_5ce42ab500e4row1_col2" class="data row1 col2" >0.131138</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>Zgodnie z oczekiwaniami, model regresji kwadratowej dał o wiele lepsze dopasowanie. Teraz sprawdźmy jeszcze co stanie się, gdy znacznie zwiększymy stopień wielomianu dla powyższych danych.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poly100</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_train_poly100</span> <span class="o">=</span> <span class="n">poly100</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
<span class="n">x_valid_poly100</span> <span class="o">=</span> <span class="n">poly100</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg4</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">positive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>        
                       <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    
<span class="n">reg4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_poly100</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coefficient: &quot;</span><span class="p">,</span> <span class="n">reg4</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Intercept: &quot;</span><span class="p">,</span> <span class="n">reg4</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient:  [[-7.15562755e+10 -6.04924150e+00  5.17498454e+01  1.16497512e+03
  -6.55481187e+03 -7.73416858e+04  3.54270354e+05  2.60947476e+06
  -1.06153968e+07 -5.15748797e+07  1.97935959e+08  6.47113715e+08
  -2.44480756e+09 -5.40682430e+09  2.07908420e+10  3.07876364e+10
  -1.24506316e+11 -1.19185324e+11  5.29206690e+11  3.00218957e+11
  -1.58090593e+12 -4.16243830e+11  3.19031616e+12  3.18156635e+10
  -3.87420709e+12  9.08879307e+11  1.64147023e+12 -1.16637376e+12
   2.06101996e+12 -2.85368060e+11 -2.08169773e+12  1.31471694e+12
  -1.56817637e+12  3.06138638e+11  1.54752668e+12 -1.24159351e+12
   1.86220933e+12 -8.00740459e+11 -4.44950761e+11  7.36761622e+11
  -1.93288151e+12  1.29248908e+12 -9.67945021e+11  3.28618281e+11
   8.83288802e+11 -9.59862560e+11  1.66832443e+12 -1.23492612e+12
   8.88758912e+11 -3.79171659e+11 -6.23851346e+11  7.58837455e+11
  -1.46568145e+12  1.25199247e+12 -1.13529910e+12  7.89149855e+11
  -5.22905183e+10 -2.29502460e+11  1.02122440e+12 -1.03888611e+12
   1.35360331e+12 -1.14510624e+12  8.08507137e+11 -5.58382492e+11
  -1.59520359e+11  3.19019961e+11 -1.03050938e+12  1.01752328e+12
  -1.24669536e+12  1.11200930e+12 -7.76974487e+11  6.03977680e+11
   6.99969406e+10 -1.91461478e+11  9.15181861e+11 -8.83511308e+11
   1.23831169e+12 -1.09517370e+12  9.00218897e+11 -7.09562547e+11
   4.87764642e+10  1.30121527e+10 -7.88456681e+11  7.11113943e+11
  -1.25970424e+12  1.04578877e+12 -1.02028821e+12  7.14134016e+11
  -1.08818085e+11 -5.67014732e+10  9.59222688e+11 -8.01201614e+11
   1.47676285e+12 -8.87548710e+11  8.34557044e+11 -9.10072833e+10
  -9.03694115e+11  9.75314675e+11 -2.09595731e+12 -2.65695997e+11
   1.32627740e+12]]
Intercept:  [7.15562755e+10]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">formula</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">101</span><span class="p">):</span>
    <span class="n">formula</span> <span class="o">=</span> <span class="n">formula</span> <span class="o">+</span> <span class="n">x_train_poly100</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">reg4</span><span class="o">.</span><span class="n">coef_</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_plot_squarereg2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,)),</span> 
    <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="n">formula</span> <span class="o">+</span> <span class="n">reg3</span><span class="o">.</span><span class="n">intercept_</span>
    <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_plot_squarereg2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>  <span class="n">df_plot_squarereg2</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Zbior treningowy i dopasowana (?) regresja wielomianowa&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_83_0.png" src="../_images/Regresja-Part2_83_0.png" />
</div>
</div>
<p>Sprawdźmy wartości metryk na zbiorze walidacyjnym.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds5</span> <span class="o">=</span> <span class="n">reg4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_valid_poly100</span><span class="p">)</span>

<span class="n">wyniki5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RSS&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">preds4</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">preds5</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">))</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds5</span><span class="p">)</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span> 
                                     <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds5</span><span class="p">)]},</span> 
                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;square_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;poly_reg&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">wyniki5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row0_col0,#T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row0_col2,#T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row1_col1{
            background-color:  #f7fbff;
            color:  #000000;
        }#T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row0_col1,#T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row1_col0,#T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row1_col2{
            background-color:  #08306b;
            color:  #f1f1f1;
        }</style><table id="T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >RSS</th>        <th class="col_heading level0 col1" >R2</th>        <th class="col_heading level0 col2" >MAE</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4level0_row0" class="row_heading level0 row0" >square_reg</th>
                        <td id="T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row0_col0" class="data row0 col0" >0.710297</td>
                        <td id="T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row0_col1" class="data row0 col1" >0.818960</td>
                        <td id="T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row0_col2" class="data row0 col2" >0.131138</td>
            </tr>
            <tr>
                        <th id="T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4level0_row1" class="row_heading level0 row1" >poly_reg</th>
                        <td id="T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row1_col0" class="data row1 col0" >7767154286.393160</td>
                        <td id="T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row1_col1" class="data row1 col1" >-1979682693.614666</td>
                        <td id="T_2d04e7cb_8ee2_11ed_9a10_5ce42ab500e4row1_col2" class="data row1 col2" >3525.458606</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>Jak można było się spodziewać, model jest teraz mocno przeuczony. Stosując model regresji wielomianowej należy pamiętać o ryzyku przeuczenia modelu, które wzrasta wraz ze wzrostem stopnia wielomianu. Oczywiście, zapobiec temu problemowi może regularyzacja, którą można stosować analogicznie jak w regresji liniowej.</p>
</div>
<hr class="docutils" />
<div class="section" id="decision-trees">
<h2>Decision Trees<a class="headerlink" href="#decision-trees" title="Permalink to this headline">¶</a></h2>
<p>Drzewa decyzyjne to algorytm modelujący dane nieliniowo, nadający się zarówno do klasyfikacji, jak i regresji. Przyjmują one dowolne typy danych, numeryczne i kategoryczne, bez założeń dotyczących rozkładu i bez potrzeby ich wstępnego przetwarzania. Algorytm ten jest względnie łatwy w użyciu, a jego wyniki są w miarę proste w interpretacji. Po dopasowaniu modelu, przewidywanie wyników jest szybkim procesem. Jednak drzewa decyzyjne mają też swoje wady, mają one tendencję do przeuczania (zwłaszcza, gdy nie są przycinane).</p>
<p><strong>Konstrukcja</strong></p>
<p>Drzewa decyzyjnie można podsumować jako serię pytań/warunków dla ustalonego rekordu w danych treningowych, które kończą się zwróceniem przez drzewo informacji o oczekiwanej wartości (klasie) zmiennej objaśnianej dla owego rekordu. Składają się one z węzłów, gałęzi i liści. Konstrukcję zaczyna się od korzenia, czyli pierwszego węzła. Następnie tworzymy gałęzie odpowiadające różnym odpowiedziom na to pytanie, i powtarzamy te czynności do momentu, gdy drzewo zwraca nam oczekiwaną wartość zmiennej objaśnianej. Jeśli w liściu znalazła się więcej niż jedna wartość, wyznaczamy średnią z owych wartości jako wskazaną przez drzewo. Drzewa stosowane w regresji nazywa się czasem drzewami regresyjnymi.</p>
<p><strong>Przycinanie liści</strong></p>
<p>Żeby zapobiec zbyt dużemu rozrostowi drzewa decyzyjnego, który może doprowadzić do małego poziomu generalizacji oraz spowolnienia działania algorytmu, stosuje się tak zwane przycianie drzewa (ang pruning). Polega ono na usuwaniu zbędnych elementów z drzewa po jego utworzeniu. Wyróżnia się dwa podstawowe rodzaje przycinania:</p>
<ol class="simple">
<li><p>przycinanie wsteczne, polegające na wygenerowaniu drzewa, które jest bardzo dobrze dopasowane do zbioru treningowego, a następnie usuwanie od dołu najmniej efektywnych węzłów,</p></li>
<li><p>przycinanie w przód, polegające na wstrzymaniu dalszej rozbudowy danej gałęzi jeśli na węźle znajduje się ilość próbek zaklasyfikowanych do danej klasy, przekracza wyznaczony próg.</p></li>
</ol>
<p><strong>Miary wyboru podziału drzewa regresyjnego</strong></p>
<p>W drzewach decyzyjnych dla klasyfikacji, drzewo musi zadawać właściwe pytania we właściwym momencie, aby dokładnie klasyfikować dane. W tym celu korzysta się z miar entropii, przyrostu informacji lub indeksu Giniego. Jednak ponieważ teraz przewidujemy wartości ciągłych zmiennych, potrzebujemy innej miary. Takiej, która określa odchylenie predykcji od rzeczywistej wartości. Naturalnym wyborem zdaje się być błąd średniokwadratowy, dany dla przypomnienia wzorem</p>
<div class="math notranslate nohighlight">
\[MSE = \frac{1}{n}\sum_{i=1}^{n}(Y_i - \hat{Y})^2,\]</div>
<p>gdzie <span class="math notranslate nohighlight">\(Y\)</span> to wartości znajdujące się w węźle drzewa, który chcemy dzielić, zaś <span class="math notranslate nohighlight">\(\hat{Y}\)</span> jest ich średnią. Wybierając podział należy ten błąd zminimalizować. Alternatywnie korzysta się z następujących kryteriów: MSE Friedmana, MAE oraz Poisson deviance.</p>
<p>Przejdźmy przez przykładowy, ręczny wybór podziału.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_example</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">)),</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.4</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.5</span><span class="p">,</span><span class="mf">6.1</span><span class="p">,</span><span class="mf">6.7</span><span class="p">,</span><span class="mf">6.4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">3.2</span><span class="p">,</span><span class="mf">3.1</span><span class="p">]})</span>
<span class="n">df_example</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>X</th>
      <th>Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1.4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>5.5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>6.7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>6.4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>3.2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>14</td>
      <td>3.1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">df_example</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">df_example</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Zbior treningowy dla przykładowego drzewa decyzyjnego&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_90_0.png" src="../_images/Regresja-Part2_90_0.png" />
</div>
</div>
<p>Początkowa wartość <span class="math notranslate nohighlight">\(MSE\)</span> wynosi</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE =&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">df_example</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_example</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span><span class="o">/</span> <span class="n">df_example</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE = 4.989234693877552
</pre></div>
</div>
</div>
</div>
<p>Dopiero zaczynamy budować drzewo, zatem w aktualnym węźle znajdują się wszystkie wartości <span class="math notranslate nohighlight">\(X\)</span>. Dla takiego zbioru danych, wszystkie możliwe warunki mają postać “Czy <span class="math notranslate nohighlight">\(X\)</span> jest większe/mniejsze niż <span class="math notranslate nohighlight">\(a\)</span>?”, gdzie <span class="math notranslate nohighlight">\(a\)</span> to może być dowolna liczba z przedziału <span class="math notranslate nohighlight">\((0,14)\)</span>. Dla uproszczenia będziemy rozpatrywać liczby <span class="math notranslate nohighlight">\(1.5,2.5,...,13.5\)</span>. Należy podzielić zbiór na każdy z 13 możliwych sposobów, wyznaczyć średnie wartości w węzłach jako aktualne wartości predykcji dla danego <span class="math notranslate nohighlight">\(X\)</span>, wyznaczyć wszystkie wartości <span class="math notranslate nohighlight">\(MSE\)</span> oraz wybrać podział, dla którego ten błąd jest najmniejszy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cut_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mse_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">14</span><span class="p">):</span>
    
    <span class="n">cut</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">cut_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cut</span><span class="p">)</span>
    
    <span class="n">values_below</span> <span class="o">=</span> <span class="n">df_example</span><span class="p">[</span><span class="n">df_example</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cut</span><span class="p">]</span>
    <span class="n">values_above</span> <span class="o">=</span> <span class="n">df_example</span><span class="p">[</span><span class="n">df_example</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cut</span><span class="p">]</span>
    
    <span class="n">pred_below</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values_below</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
    <span class="n">pred_above</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values_above</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
    
    <span class="n">sse</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">values_below</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pred_below</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">((</span><span class="n">values_above</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pred_above</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">sse</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_example</span><span class="p">)</span>
    <span class="n">mse_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_tree_cut</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;cut&#39;</span><span class="p">:</span> <span class="n">cut_list</span><span class="p">,</span> <span class="s1">&#39;mse&#39;</span><span class="p">:</span> <span class="n">mse_list</span><span class="p">})</span>
<span class="n">df_tree_cut</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cut</th>
      <th>mse</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.5</td>
      <td>4.431429</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.5</td>
      <td>3.868750</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.5</td>
      <td>3.294416</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.5</td>
      <td>2.453393</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.5</td>
      <td>1.368635</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6.5</td>
      <td>2.488006</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7.5</td>
      <td>3.497347</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8.5</td>
      <td>4.349167</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9.5</td>
      <td>4.810540</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10.5</td>
      <td>4.982250</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11.5</td>
      <td>4.893377</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12.5</td>
      <td>4.940119</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13.5</td>
      <td>4.962198</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">df_tree_cut</span><span class="p">[</span><span class="s1">&#39;cut&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">df_tree_cut</span><span class="p">[</span><span class="s1">&#39;mse&#39;</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="n">df_tree_cut</span><span class="p">[</span><span class="s1">&#39;mse&#39;</span><span class="p">],</span> <span class="n">palette</span> <span class="o">=</span> <span class="s1">&#39;crest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Możliwe podziały dla pierwszego węzła drzewa decyzyjnego&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Regresja-Part2_96_0.png" src="../_images/Regresja-Part2_96_0.png" />
</div>
</div>
<p>Stąd otrzymujemy, że pierwszy węzeł drzewa powinien zawierać warunek</p>
<p>“Czy <span class="math notranslate nohighlight">\(X\)</span> jest większe/mniejsze niż <span class="math notranslate nohighlight">\(5.5\)</span>?”</p>
<p>Stwórzmy teraz całe drzewo regresyjne na zbiorze danych, z którego korzystaliśmy przy okazji regresji wielomianowej. Tym razem już automatycznie.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt_reg</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">()</span>
<span class="n">dt_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">preds_dt</span> <span class="o">=</span> <span class="n">dt_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wyniki6</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RSS&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">preds4</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">preds_dt</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">))</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_dt</span><span class="p">)</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span> 
                                     <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_dt</span><span class="p">)]},</span> 
                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;square_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;dt_reg&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">wyniki6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row0_col0,#T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row0_col2,#T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row1_col1{
            background-color:  #f7fbff;
            color:  #000000;
        }#T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row0_col1,#T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row1_col0,#T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row1_col2{
            background-color:  #08306b;
            color:  #f1f1f1;
        }</style><table id="T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >RSS</th>        <th class="col_heading level0 col1" >R2</th>        <th class="col_heading level0 col2" >MAE</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4level0_row0" class="row_heading level0 row0" >square_reg</th>
                        <td id="T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row0_col0" class="data row0 col0" >0.710297</td>
                        <td id="T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row0_col1" class="data row0 col1" >0.818960</td>
                        <td id="T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row0_col2" class="data row0 col2" >0.131138</td>
            </tr>
            <tr>
                        <th id="T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4level0_row1" class="row_heading level0 row1" >dt_reg</th>
                        <td id="T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row1_col0" class="data row1 col0" >1.442085</td>
                        <td id="T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row1_col1" class="data row1 col1" >0.632443</td>
                        <td id="T_2d86a8c2_8ee2_11ed_8f3b_5ce42ab500e4row1_col2" class="data row1 col2" >0.197432</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>Wyniki modelu na zbiorze walidacyjnym nie są dobre. Zwizualizujmy stworzone drzewo żeby sprawdzić, co mogło pójść nie tak.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">export_text</span><span class="p">(</span><span class="n">dt_reg</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tree</span><span class="p">(</span><span class="n">dt_reg</span><span class="p">,</span> <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|--- feature_0 &lt;= 0.56
|   |--- feature_0 &lt;= -0.74
|   |   |--- feature_0 &lt;= -0.79
|   |   |   |--- feature_0 &lt;= -0.81
|   |   |   |   |--- feature_0 &lt;= -0.86
|   |   |   |   |   |--- feature_0 &lt;= -0.99
|   |   |   |   |   |   |--- feature_0 &lt;= -1.00
|   |   |   |   |   |   |   |--- value: [0.22]
|   |   |   |   |   |   |--- feature_0 &gt;  -1.00
|   |   |   |   |   |   |   |--- value: [0.36]
|   |   |   |   |   |--- feature_0 &gt;  -0.99
|   |   |   |   |   |   |--- feature_0 &lt;= -0.89
|   |   |   |   |   |   |   |--- feature_0 &lt;= -0.99
|   |   |   |   |   |   |   |   |--- value: [0.49]
|   |   |   |   |   |   |   |--- feature_0 &gt;  -0.99
|   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.95
|   |   |   |   |   |   |   |   |   |--- value: [0.75]
|   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.95
|   |   |   |   |   |   |   |   |   |--- value: [0.67]
|   |   |   |   |   |   |--- feature_0 &gt;  -0.89
|   |   |   |   |   |   |   |--- value: [0.46]
|   |   |   |   |--- feature_0 &gt;  -0.86
|   |   |   |   |   |--- feature_0 &lt;= -0.83
|   |   |   |   |   |   |--- feature_0 &lt;= -0.85
|   |   |   |   |   |   |   |--- value: [0.14]
|   |   |   |   |   |   |--- feature_0 &gt;  -0.85
|   |   |   |   |   |   |   |--- feature_0 &lt;= -0.84
|   |   |   |   |   |   |   |   |--- value: [0.33]
|   |   |   |   |   |   |   |--- feature_0 &gt;  -0.84
|   |   |   |   |   |   |   |   |--- value: [0.23]
|   |   |   |   |   |--- feature_0 &gt;  -0.83
|   |   |   |   |   |   |--- feature_0 &lt;= -0.82
|   |   |   |   |   |   |   |--- value: [0.56]
|   |   |   |   |   |   |--- feature_0 &gt;  -0.82
|   |   |   |   |   |   |   |--- value: [0.38]
|   |   |   |--- feature_0 &gt;  -0.81
|   |   |   |   |--- value: [0.77]
|   |   |--- feature_0 &gt;  -0.79
|   |   |   |--- feature_0 &lt;= -0.75
|   |   |   |   |--- feature_0 &lt;= -0.77
|   |   |   |   |   |--- value: [0.34]
|   |   |   |   |--- feature_0 &gt;  -0.77
|   |   |   |   |   |--- value: [0.09]
|   |   |   |--- feature_0 &gt;  -0.75
|   |   |   |   |--- feature_0 &lt;= -0.74
|   |   |   |   |   |--- value: [0.46]
|   |   |   |   |--- feature_0 &gt;  -0.74
|   |   |   |   |   |--- value: [0.29]
|   |--- feature_0 &gt;  -0.74
|   |   |--- feature_0 &lt;= 0.38
|   |   |   |--- feature_0 &lt;= 0.22
|   |   |   |   |--- feature_0 &lt;= 0.19
|   |   |   |   |   |--- feature_0 &lt;= 0.08
|   |   |   |   |   |   |--- feature_0 &lt;= -0.01
|   |   |   |   |   |   |   |--- feature_0 &lt;= -0.09
|   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.22
|   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.71
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.73
|   |   |   |   |   |   |   |   |   |   |   |--- value: [-0.08]
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.73
|   |   |   |   |   |   |   |   |   |   |   |--- value: [-0.22]
|   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.71
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.69
|   |   |   |   |   |   |   |   |   |   |   |--- value: [0.29]
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.69
|   |   |   |   |   |   |   |   |   |   |   |--- truncated branch of depth 7
|   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.22
|   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.16
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.21
|   |   |   |   |   |   |   |   |   |   |   |--- value: [-0.27]
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.21
|   |   |   |   |   |   |   |   |   |   |   |--- truncated branch of depth 3
|   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.16
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.16
|   |   |   |   |   |   |   |   |   |   |   |--- value: [0.28]
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.16
|   |   |   |   |   |   |   |   |   |   |   |--- truncated branch of depth 4
|   |   |   |   |   |   |   |--- feature_0 &gt;  -0.09
|   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.05
|   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.07
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= -0.08
|   |   |   |   |   |   |   |   |   |   |   |--- value: [0.24]
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.08
|   |   |   |   |   |   |   |   |   |   |   |--- value: [0.24]
|   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.07
|   |   |   |   |   |   |   |   |   |   |--- value: [0.23]
|   |   |   |   |   |   |   |   |--- feature_0 &gt;  -0.05
|   |   |   |   |   |   |   |   |   |--- value: [0.07]
|   |   |   |   |   |   |--- feature_0 &gt;  -0.01
|   |   |   |   |   |   |   |--- feature_0 &lt;= 0.01
|   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.01
|   |   |   |   |   |   |   |   |   |--- value: [-0.08]
|   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.01
|   |   |   |   |   |   |   |   |   |--- value: [-0.06]
|   |   |   |   |   |   |   |--- feature_0 &gt;  0.01
|   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.05
|   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.03
|   |   |   |   |   |   |   |   |   |   |--- value: [-0.30]
|   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.03
|   |   |   |   |   |   |   |   |   |   |--- value: [-0.27]
|   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.05
|   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.06
|   |   |   |   |   |   |   |   |   |   |--- value: [-0.02]
|   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.06
|   |   |   |   |   |   |   |   |   |   |--- value: [-0.12]
|   |   |   |   |   |--- feature_0 &gt;  0.08
|   |   |   |   |   |   |--- feature_0 &lt;= 0.19
|   |   |   |   |   |   |   |--- feature_0 &lt;= 0.18
|   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.15
|   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.11
|   |   |   |   |   |   |   |   |   |   |--- value: [0.17]
|   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.11
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.12
|   |   |   |   |   |   |   |   |   |   |   |--- value: [0.05]
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.12
|   |   |   |   |   |   |   |   |   |   |   |--- value: [-0.00]
|   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.15
|   |   |   |   |   |   |   |   |   |--- value: [0.26]
|   |   |   |   |   |   |   |--- feature_0 &gt;  0.18
|   |   |   |   |   |   |   |   |--- value: [-0.06]
|   |   |   |   |   |   |--- feature_0 &gt;  0.19
|   |   |   |   |   |   |   |--- value: [0.25]
|   |   |   |   |--- feature_0 &gt;  0.19
|   |   |   |   |   |--- feature_0 &lt;= 0.21
|   |   |   |   |   |   |--- feature_0 &lt;= 0.20
|   |   |   |   |   |   |   |--- value: [-0.15]
|   |   |   |   |   |   |--- feature_0 &gt;  0.20
|   |   |   |   |   |   |   |--- value: [-0.09]
|   |   |   |   |   |--- feature_0 &gt;  0.21
|   |   |   |   |   |   |--- value: [-0.30]
|   |   |   |--- feature_0 &gt;  0.22
|   |   |   |   |--- feature_0 &lt;= 0.23
|   |   |   |   |   |--- value: [0.49]
|   |   |   |   |--- feature_0 &gt;  0.23
|   |   |   |   |   |--- feature_0 &lt;= 0.24
|   |   |   |   |   |   |--- value: [-0.01]
|   |   |   |   |   |--- feature_0 &gt;  0.24
|   |   |   |   |   |   |--- feature_0 &lt;= 0.34
|   |   |   |   |   |   |   |--- feature_0 &lt;= 0.30
|   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.25
|   |   |   |   |   |   |   |   |   |--- value: [0.25]
|   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.25
|   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.28
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.27
|   |   |   |   |   |   |   |   |   |   |   |--- value: [0.10]
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.27
|   |   |   |   |   |   |   |   |   |   |   |--- value: [-0.01]
|   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.28
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &lt;= 0.29
|   |   |   |   |   |   |   |   |   |   |   |--- value: [0.13]
|   |   |   |   |   |   |   |   |   |   |--- feature_0 &gt;  0.29
|   |   |   |   |   |   |   |   |   |   |   |--- value: [0.16]
|   |   |   |   |   |   |   |--- feature_0 &gt;  0.30
|   |   |   |   |   |   |   |   |--- value: [0.34]
|   |   |   |   |   |   |--- feature_0 &gt;  0.34
|   |   |   |   |   |   |   |--- feature_0 &lt;= 0.37
|   |   |   |   |   |   |   |   |--- value: [-0.10]
|   |   |   |   |   |   |   |--- feature_0 &gt;  0.37
|   |   |   |   |   |   |   |   |--- value: [0.18]
|   |   |--- feature_0 &gt;  0.38
|   |   |   |--- feature_0 &lt;= 0.41
|   |   |   |   |--- value: [0.63]
|   |   |   |--- feature_0 &gt;  0.41
|   |   |   |   |--- feature_0 &lt;= 0.53
|   |   |   |   |   |--- feature_0 &lt;= 0.48
|   |   |   |   |   |   |--- value: [0.44]
|   |   |   |   |   |--- feature_0 &gt;  0.48
|   |   |   |   |   |   |--- value: [0.49]
|   |   |   |   |--- feature_0 &gt;  0.53
|   |   |   |   |   |--- value: [0.30]
|--- feature_0 &gt;  0.56
|   |--- feature_0 &lt;= 0.80
|   |   |--- feature_0 &lt;= 0.62
|   |   |   |--- feature_0 &lt;= 0.59
|   |   |   |   |--- value: [0.56]
|   |   |   |--- feature_0 &gt;  0.59
|   |   |   |   |--- value: [0.59]
|   |   |--- feature_0 &gt;  0.62
|   |   |   |--- feature_0 &lt;= 0.75
|   |   |   |   |--- feature_0 &lt;= 0.69
|   |   |   |   |   |--- feature_0 &lt;= 0.65
|   |   |   |   |   |   |--- feature_0 &lt;= 0.64
|   |   |   |   |   |   |   |--- value: [0.82]
|   |   |   |   |   |   |--- feature_0 &gt;  0.64
|   |   |   |   |   |   |   |--- value: [0.99]
|   |   |   |   |   |--- feature_0 &gt;  0.65
|   |   |   |   |   |   |--- feature_0 &lt;= 0.66
|   |   |   |   |   |   |   |--- value: [0.75]
|   |   |   |   |   |   |--- feature_0 &gt;  0.66
|   |   |   |   |   |   |   |--- feature_0 &lt;= 0.67
|   |   |   |   |   |   |   |   |--- value: [0.87]
|   |   |   |   |   |   |   |--- feature_0 &gt;  0.67
|   |   |   |   |   |   |   |   |--- value: [0.89]
|   |   |   |   |--- feature_0 &gt;  0.69
|   |   |   |   |   |--- feature_0 &lt;= 0.71
|   |   |   |   |   |   |--- value: [0.36]
|   |   |   |   |   |--- feature_0 &gt;  0.71
|   |   |   |   |   |   |--- value: [0.81]
|   |   |   |--- feature_0 &gt;  0.75
|   |   |   |   |--- feature_0 &lt;= 0.76
|   |   |   |   |   |--- value: [0.91]
|   |   |   |   |--- feature_0 &gt;  0.76
|   |   |   |   |   |--- feature_0 &lt;= 0.78
|   |   |   |   |   |   |--- feature_0 &lt;= 0.77
|   |   |   |   |   |   |   |--- value: [0.95]
|   |   |   |   |   |   |--- feature_0 &gt;  0.77
|   |   |   |   |   |   |   |--- value: [0.96]
|   |   |   |   |   |--- feature_0 &gt;  0.78
|   |   |   |   |   |   |--- value: [0.97]
|   |--- feature_0 &gt;  0.80
|   |   |--- feature_0 &lt;= 0.91
|   |   |   |--- feature_0 &lt;= 0.85
|   |   |   |   |--- feature_0 &lt;= 0.81
|   |   |   |   |   |--- value: [1.15]
|   |   |   |   |--- feature_0 &gt;  0.81
|   |   |   |   |   |--- value: [1.26]
|   |   |   |--- feature_0 &gt;  0.85
|   |   |   |   |--- feature_0 &lt;= 0.89
|   |   |   |   |   |--- value: [0.80]
|   |   |   |   |--- feature_0 &gt;  0.89
|   |   |   |   |   |--- feature_0 &lt;= 0.91
|   |   |   |   |   |   |--- feature_0 &lt;= 0.90
|   |   |   |   |   |   |   |--- value: [1.13]
|   |   |   |   |   |   |--- feature_0 &gt;  0.90
|   |   |   |   |   |   |   |--- value: [1.37]
|   |   |   |   |   |--- feature_0 &gt;  0.91
|   |   |   |   |   |   |--- value: [1.01]
|   |   |--- feature_0 &gt;  0.91
|   |   |   |--- feature_0 &lt;= 0.94
|   |   |   |   |--- feature_0 &lt;= 0.92
|   |   |   |   |   |--- value: [1.48]
|   |   |   |   |--- feature_0 &gt;  0.92
|   |   |   |   |   |--- value: [1.39]
|   |   |   |--- feature_0 &gt;  0.94
|   |   |   |   |--- value: [1.14]
</pre></div>
</div>
<img alt="../_images/Regresja-Part2_102_1.png" src="../_images/Regresja-Part2_102_1.png" />
</div>
</div>
<p>Wygląda na to, że domyślne drzewo regresyjne stworzyło tak dużo węzłów, że model jest mocno przeuczony. Aby temu zapobiec, ograniczymy głębokość drzewa, czyli maksymalną liczbę węzłów od korzenia do liścia włącznie.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt_reg2</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">dt_reg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">preds_dt2</span> <span class="o">=</span> <span class="n">dt_reg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wyniki7</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RSS&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">preds4</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">preds_dt2</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">))</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_dt2</span><span class="p">)</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span> 
                                     <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_dt2</span><span class="p">)]},</span> 
                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;square_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;dt_reg&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">wyniki7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row0_col0,#T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row0_col2,#T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row1_col1{
            background-color:  #08306b;
            color:  #f1f1f1;
        }#T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row0_col1,#T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row1_col0,#T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row1_col2{
            background-color:  #f7fbff;
            color:  #000000;
        }</style><table id="T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >RSS</th>        <th class="col_heading level0 col1" >R2</th>        <th class="col_heading level0 col2" >MAE</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4level0_row0" class="row_heading level0 row0" >square_reg</th>
                        <td id="T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row0_col0" class="data row0 col0" >0.710297</td>
                        <td id="T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row0_col1" class="data row0 col1" >0.818960</td>
                        <td id="T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row0_col2" class="data row0 col2" >0.131138</td>
            </tr>
            <tr>
                        <th id="T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4level0_row1" class="row_heading level0 row1" >dt_reg</th>
                        <td id="T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row1_col0" class="data row1 col0" >0.574310</td>
                        <td id="T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row1_col1" class="data row1 col1" >0.853621</td>
                        <td id="T_353d8ecb_8ee2_11ed_87e0_5ce42ab500e4row1_col2" class="data row1 col2" >0.126859</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>Ograniczenie głębokości drzewa pomogło i model jest teraz skuteczniejszy niż regresja kwadratowa. Przykładowe hiperparametry, które można regulować/optymalizować to:</p>
<ul class="simple">
<li><p>criterion - kryterium wyboru podziału węzła,</p></li>
<li><p>min_samples_split - minimalna liczba wartości do podzielenia węzła,</p></li>
<li><p>min_samples_leaf - minimalna liczba wartości w liściu drzewa,</p></li>
<li><p>max_depth - maksymalna głębokość drzewa.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">export_text</span><span class="p">(</span><span class="n">dt_reg2</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plot_tree</span><span class="p">(</span><span class="n">dt_reg2</span><span class="p">,</span> <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|--- feature_0 &lt;= 0.56
|   |--- feature_0 &lt;= -0.74
|   |   |--- feature_0 &lt;= -0.79
|   |   |   |--- value: [0.45]
|   |   |--- feature_0 &gt;  -0.79
|   |   |   |--- value: [0.29]
|   |--- feature_0 &gt;  -0.74
|   |   |--- feature_0 &lt;= 0.38
|   |   |   |--- value: [0.03]
|   |   |--- feature_0 &gt;  0.38
|   |   |   |--- value: [0.47]
|--- feature_0 &gt;  0.56
|   |--- feature_0 &lt;= 0.80
|   |   |--- feature_0 &lt;= 0.62
|   |   |   |--- value: [0.57]
|   |   |--- feature_0 &gt;  0.62
|   |   |   |--- value: [0.84]
|   |--- feature_0 &gt;  0.80
|   |   |--- feature_0 &lt;= 0.91
|   |   |   |--- value: [1.12]
|   |   |--- feature_0 &gt;  0.91
|   |   |   |--- value: [1.34]
</pre></div>
</div>
<img alt="../_images/Regresja-Part2_107_1.png" src="../_images/Regresja-Part2_107_1.png" />
</div>
</div>
<p>Na koniec tej części, warto wspomnieć o paru istotnych informacjach dotyczących drzew decyzyjnych.</p>
<ol class="simple">
<li><p>Drzewa decyzyjne nie wymagają wcześniejszej standaryzacji danych - co więcej, ewentualna standaryzacja nie wpływa na wyniki oraz predykcję.</p></li>
<li><p>Drzewa decyzyjne mają skłonność do przeuczania się.</p></li>
<li><p>Pracując z drzewami, należy uważać przy detekcji outlierów - jeśli wykluczymy outliery ze zbioru treningowego, a analogiczne znajdą się w zbiorze testowym lub walidacyjnym, drzewo może takich wartości nie obsłużyć i zwrócić mocno niepoprawne predykcje.</p></li>
<li><p>W praktyce, drzewa decyzyjne wykorzystuje się głównie jako algorytm pomocniczy w algorytmach ensemble, takich jak na przykład Random Forest, LightGBM czy XGBoost.</p></li>
</ol>
</div>
<hr class="docutils" />
<div class="section" id="random-forest">
<h2>Random forest<a class="headerlink" href="#random-forest" title="Permalink to this headline">¶</a></h2>
<p>Jak wspomniano wyżej, lasy losowe, bardziej znane pod nazwą random forest, są algorytmem ensemble, czyli wykorzystującym wiele modeli (algorytmów) jednocześnie. W przypadku lasów są to, jak sama nazwa wskazuje, drzewa decyzyjne. Konkretnie, ten algorytm tworzy <span class="math notranslate nohighlight">\(n\)</span> drzew decyzyjnych, a następnie (w regresji) dla ustalonego rekordu ze zbioru testowego/walidacyjnego, zwraca średnią predykcję z tych drzew jako swoją predykcję dla owego rekordu.</p>
<p><strong>Konstrukcja</strong></p>
<p>Oczywiście, aby tworzenie wielu drzew decyzyjnych miało w ogóle sens, nie mogą być one identyczne. Taki efekt uzyskuje się łącząc dwie metody związane z losowaniem. Pierwszą z nich jest bagging, czyli bootstrap aggregating. Ten algorytm polega na tworzeniu nowego zbioru danych przez losowanie rekordów ze zbioru treningowego ze zwracaniem. Dzięki temu, każde drzewo z dużym prawdopodobieństwem będzie wytrenowane na innym zbiorze danych. Drugim elementem baggingu jest agregacja, czyli opisane wcześniej uśrednienie predykcji modeli pomocniczych.</p>
<p>Poza losowaniem danych treningowych dla każdego podmodelu, same drzewa również zawierają w sobie element losowości. Mianowicie, optymalny warunek dla każdego węzła jest determinowany jedynie na podstawie losowego podzbioru zmiennych objaśniających. Taka konstrukcja lasów redukuje skłonność podedynczego drzewa do przeuczania się. Nie ma ona jednak wpływu na problem drzew decyzyjnych z outlierami, a także nie zmienia tego, że standaryzacja nie zmienia wyników algorytmu.</p>
<p><strong>Hiperparametry</strong></p>
<p>Przykładowe hiperparametry lasów losowych:</p>
<ul class="simple">
<li><p>criterion - kryterium wyboru podziału węzła - jak w drzewach decyzyjnych,</p></li>
<li><p>min_samples_split - minimalna liczba wartości do podzielenia węzła - jak w drzewach decyzyjnych,</p></li>
<li><p>min_samples_leaf - minimalna liczba wartości w liściu drzewa - jak w drzewach decyzyjnych,</p></li>
<li><p>max_depth - maksymalna głębokość drzewa - jak w drzewach decyzyjnych,</p></li>
<li><p>max_features - liczba cech do rozpatrzenia w wyborze podziału każdego węzła,</p></li>
<li><p>max_samples - liczba rekordów każdego losowego podzbioru do treningu drzew,</p></li>
<li><p>n_estimators - liczba drzew w lesie.</p></li>
</ul>
<p>Teraz zamodelujemy nasze dane lasem losowym.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf_reg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">()</span>
<span class="n">rf_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,)))</span>
<span class="n">rf_preds</span> <span class="o">=</span> <span class="n">rf_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wyniki8</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RSS&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">preds4</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">preds_dt2</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rf_preds</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_dt2</span><span class="p">),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">rf_preds</span><span class="p">),</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span> 
                                     <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_dt2</span><span class="p">),</span>
                                     <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">rf_preds</span><span class="p">),</span>
                                    <span class="p">]},</span> 
                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;square_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;dt_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rf_reg&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">wyniki8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row0_col0{
            background-color:  #abd0e6;
            color:  #000000;
        }#T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row0_col1{
            background-color:  #3787c0;
            color:  #000000;
        }#T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row0_col2{
            background-color:  #d3e4f3;
            color:  #000000;
        }#T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row1_col0,#T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row1_col2,#T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row2_col1{
            background-color:  #f7fbff;
            color:  #000000;
        }#T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row1_col1,#T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row2_col0,#T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row2_col2{
            background-color:  #08306b;
            color:  #f1f1f1;
        }</style><table id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >RSS</th>        <th class="col_heading level0 col1" >R2</th>        <th class="col_heading level0 col2" >MAE</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4level0_row0" class="row_heading level0 row0" >square_reg</th>
                        <td id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row0_col0" class="data row0 col0" >0.710297</td>
                        <td id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row0_col1" class="data row0 col1" >0.818960</td>
                        <td id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row0_col2" class="data row0 col2" >0.131138</td>
            </tr>
            <tr>
                        <th id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4level0_row1" class="row_heading level0 row1" >dt_reg</th>
                        <td id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row1_col0" class="data row1 col0" >0.574310</td>
                        <td id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row1_col1" class="data row1 col1" >0.853621</td>
                        <td id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row1_col2" class="data row1 col2" >0.126859</td>
            </tr>
            <tr>
                        <th id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4level0_row2" class="row_heading level0 row2" >rf_reg</th>
                        <td id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row2_col0" class="data row2 col0" >0.982969</td>
                        <td id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row2_col1" class="data row2 col1" >0.749462</td>
                        <td id="T_35dfaba6_8ee2_11ed_adb6_5ce42ab500e4row2_col2" class="data row2 col2" >0.150648</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>Domyślne wyniki znowu są słabe, więc znowu spróbujemy dostosować hiperparametr max_depth.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf_reg2</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">max_depth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">rf_reg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,)))</span>
<span class="n">rf_preds2</span> <span class="o">=</span> <span class="n">rf_reg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wyniki9</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RSS&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">preds4</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">preds_dt2</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rf_preds2</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">y_valid</span><span class="p">)),</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_dt2</span><span class="p">),</span>
                                    <span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">rf_preds2</span><span class="p">),</span>
                                    <span class="p">],</span>
                             <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds4</span><span class="p">),</span> 
                                     <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_dt2</span><span class="p">),</span>
                                     <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">rf_preds2</span><span class="p">),</span>
                                    <span class="p">]},</span> 
                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;square_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;dt_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rf_reg&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">wyniki9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row0_col0,#T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row0_col2,#T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row2_col1{
            background-color:  #08306b;
            color:  #f1f1f1;
        }#T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row0_col1,#T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row2_col0,#T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row2_col2{
            background-color:  #f7fbff;
            color:  #000000;
        }#T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row1_col0{
            background-color:  #9cc9e1;
            color:  #000000;
        }#T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row1_col1{
            background-color:  #4493c7;
            color:  #000000;
        }#T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row1_col2{
            background-color:  #1967ad;
            color:  #f1f1f1;
        }</style><table id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >RSS</th>        <th class="col_heading level0 col1" >R2</th>        <th class="col_heading level0 col2" >MAE</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4level0_row0" class="row_heading level0 row0" >square_reg</th>
                        <td id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row0_col0" class="data row0 col0" >0.710297</td>
                        <td id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row0_col1" class="data row0 col1" >0.818960</td>
                        <td id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row0_col2" class="data row0 col2" >0.131138</td>
            </tr>
            <tr>
                        <th id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4level0_row1" class="row_heading level0 row1" >dt_reg</th>
                        <td id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row1_col0" class="data row1 col0" >0.574310</td>
                        <td id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row1_col1" class="data row1 col1" >0.853621</td>
                        <td id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row1_col2" class="data row1 col2" >0.126859</td>
            </tr>
            <tr>
                        <th id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4level0_row2" class="row_heading level0 row2" >rf_reg</th>
                        <td id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row2_col0" class="data row2 col0" >0.490039</td>
                        <td id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row2_col1" class="data row2 col1" >0.875099</td>
                        <td id="T_3600a125_8ee2_11ed_b68d_5ce42ab500e4row2_col2" class="data row2 col2" >0.111054</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>W efekcie uzyskaliśmy najlepszy z trzech modeli.</p>
</div>
<hr class="docutils" />
<div class="section" id="inne-modele">
<h2>Inne modele<a class="headerlink" href="#inne-modele" title="Permalink to this headline">¶</a></h2>
<div class="section" id="xgboost">
<h3>XGBoost<a class="headerlink" href="#xgboost" title="Permalink to this headline">¶</a></h3>
<p>XGBoost również należy do grupy algorytmów ensemble i także bazuje na drzewach decyzyjnych, jednak działa nieco inaczej niż random forest. Mianowicie, XGBoost na początek generuje wyjściową predykcję (w przypadku regresji jest to z reguły średnia wartość zmiennej objaśnianej z całego zbioru treningowego), następnie tworzy drzewo decyzyjne na resztach z tej predykcji, wyliczając tym samym oczekiwany błąd, zmniejsza ów błąd mnożąc go przez liczbę z przedziału <span class="math notranslate nohighlight">\((0,1)\)</span>, i ostatecznie dodaje pomniejszony błąd do predykcji wyjściowej, tworząc nową predykcję. Jest to proces iteracyjny, potwarzany <span class="math notranslate nohighlight">\(n\)</span> razy. Opisany tu algorytm nosi nazwę Gradient Boosting, zaś XGBoost jest jego implementacją, która wyróżnia się przede wszystkim metodą konstruowania kolejnych drzew decyzyjnych - poziom po poziomie.</p>
</div>
<div class="section" id="lightgbm">
<h3>LightGBM<a class="headerlink" href="#lightgbm" title="Permalink to this headline">¶</a></h3>
<p>LightGBM jest bardzo podobnym algorytmem do XGBoost, czyli również korzysta z Gradient Boostingu. Główna różnica między nimi to wymieniony wyżej sposób konstruowania pomocniczych drzew decyzyjnych - tutaj każdy nowy węzeł jest zawsze tym najlepszym w danym momencie, niezależnie od poziomu głębokości drzewa tego węzła. Poza tym te algorytmy nieco inaczej obsługują zmienne kategoryczne. LightGBM jest też dużo lżejszym algorytmem, co zresztą narzuca sama nazwa - jest szybszy w działaniu i wymaga mniej pamięci, a mimo to daje bardzo zbliżone rezultaty - w dokumentacji można nawet przeczytać, że lepsze :)</p>
</div>
<div class="section" id="sieci-neuronowe">
<h3>Sieci neuronowe<a class="headerlink" href="#sieci-neuronowe" title="Permalink to this headline">¶</a></h3>
<p>Sieci neuronowe to funkcje ideowo oparte o konstrukcję zwierzęcego mózgu. Składają się one z warstw neuronów, które pobierają liczby, transformują je i przekazują do kolejnych warstw. Pierwszą warstwę nazywa się wejściową, ostatnią wyjściową, zaś wszystkie warstwy pomiędzy nazywa się ukrytymi. Z reguły każdy neuron z warstwy <span class="math notranslate nohighlight">\(k\)</span> jest połączony z każdym neuronem z warstwy <span class="math notranslate nohighlight">\(k+1\)</span>.</p>
<p><img alt="title" src="../_images/nn_construction.png" /></p>
<p>Formalnie, sieć neuronową można zdefiniować jako naprzemienne złożenie <span class="math notranslate nohighlight">\(n\)</span> funkcji afinicznych i <span class="math notranslate nohighlight">\(n\)</span> funkcji zwanych aktywacyjnymi, z których każda, poza ostatnią, nie może być wielomianem. Wzór ogólny sieci, która ma <span class="math notranslate nohighlight">\(n-1\)</span> warstw ukrytych, dany jest jako</p>
<div class="math notranslate nohighlight">
\[f_\mathcal{N}(\mathbf{x})=\big(\sigma_n\circ W_n\circ ... \circ\sigma_2\circ W_2\circ\sigma_1\circ W_1\big) (\mathbf{x}),\]</div>
<p>gdzie <span class="math notranslate nohighlight">\(W_I\)</span> to funkcje afiniczne, czyli postaci <span class="math notranslate nohighlight">\(W_i(x)=A_i(x)+B_i\)</span>, gdzie <span class="math notranslate nohighlight">\(A_i\)</span> to funkcja liniowa, a <span class="math notranslate nohighlight">\(B_i\)</span> jest wektorem, zaś <span class="math notranslate nohighlight">\(\sigma_i\)</span> to funkcje aktywacyjne. Wartości funkcji afinicznych nazywa się wagami i to one są dopasowywane w procesie uczenia sieci. W regresji ostatnia funkcja aktywacyjna dana jest wzorem <span class="math notranslate nohighlight">\(\sigma_n(x)=x\)</span>. Fakt, że w warstwach ukrytych funkcje aktywacyjne nie są wielomianami, nadaje sieciom nieliniowość, która jest motorem napędowym ich skuteczności. W szczególności, taka postać tych funkcji sprawia, że sieci neuronowe mają tę samą własność co wielomiany w twierdzeniu Weierstrassa - są gęste w zbiorze funkcji ciągłych. Link do twierdzenia: <a class="reference external" href="https://en.wikipedia.org/wiki/Universal_approximation_theorem">https://en.wikipedia.org/wiki/Universal_approximation_theorem</a>.</p>
<p>Sieci neuronowe uczą się z wykorzystaniem algorytmów minimalizacji straty, takich jak spadek gradientu, oraz przy użyciu algorytmu propagacji wstecznej - strata jest minimalizowana z warstwy do warstwy, rozpoczynając od ostatniej, czyli wyjściowej.</p>
<p>Taka sieć jest jednak dopiero podstawą dla bardziej zaawansowanych i częściej stosowanych sieci. Do takich zalicza się sieci konwolucyjne (CNN), rekurencyjne (RNN) czy grafowe (GNN). Regresja jest tylko jednym z wielu zastosowań sieci. Warto również wspomnieć, że z reguły sieci neuronowe uczą się tym lepiej, im więcej danych mają do dyspozycji.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="bibliografia">
<h2>Bibliografia<a class="headerlink" href="#bibliografia" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/linear_model.html">https://scikit-learn.org/stable/modules/linear_model.html</a></p></li>
<li><p><em>The Elements of Statistical Learning</em> Trevor Hastie, Robert Tibshirani, Jerome Friedman. Second Edition.</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Polynomial_regression">https://en.wikipedia.org/wiki/Polynomial_regression</a></p></li>
<li><p><a class="reference external" href="https://medium.com/analytics-vidhya/regression-trees-decision-tree-for-regression-machine-learning-e4d7525d8047">https://medium.com/analytics-vidhya/regression-trees-decision-tree-for-regression-machine-learning-e4d7525d8047</a></p></li>
<li><p><a class="reference external" href="https://xgboost.readthedocs.io/en/stable/">https://xgboost.readthedocs.io/en/stable/</a></p></li>
<li><p><a class="reference external" href="https://lightgbm.readthedocs.io/en/v3.3.2/">https://lightgbm.readthedocs.io/en/v3.3.2/</a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./11. Regresja"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../12.%20Klasyfikacja/Klasyfikacja.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Klasyfikacja w Python</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../8.%20Wyjasnialnosc/8_Tutorial%20metryki%20statystyczne.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Wyjaśnialność modeli - metryki statystyczne - tutorial</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By codersi<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>